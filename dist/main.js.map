{"version":3,"sources":["webpack://storm-react-diagrams/webpack/universalModuleDefinition","webpack://storm-react-diagrams/webpack/bootstrap","webpack://storm-react-diagrams/external {\"commonjs\":\"lodash\",\"commonjs2\":\"lodash\",\"amd\":\"_\",\"root\":\"_\"}","webpack://storm-react-diagrams/./node_modules/pathfinding/src/core/DiagonalMovement.js","webpack://storm-react-diagrams/external {\"root\":\"React\",\"commonjs2\":\"react\",\"commonjs\":\"react\",\"amd\":\"react\"}","webpack://storm-react-diagrams/./src/widgets/BaseWidget.tsx","webpack://storm-react-diagrams/./node_modules/pathfinding/src/core/Util.js","webpack://storm-react-diagrams/./src/Toolkit.ts","webpack://storm-react-diagrams/./src/models/BaseModel.ts","webpack://storm-react-diagrams/./src/models/PointModel.ts","webpack://storm-react-diagrams/./node_modules/pathfinding/src/core/Heuristic.js","webpack://storm-react-diagrams/./src/models/NodeModel.ts","webpack://storm-react-diagrams/./src/factories/AbstractFactory.ts","webpack://storm-react-diagrams/./src/routing/PathFinding.ts","webpack://storm-react-diagrams/./node_modules/heap/index.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/JumpPointFinderBase.js","webpack://storm-react-diagrams/./src/BaseEntity.ts","webpack://storm-react-diagrams/./src/models/PortModel.ts","webpack://storm-react-diagrams/./src/actions/BaseAction.ts","webpack://storm-react-diagrams/./node_modules/pathfinding/src/core/Node.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/AStarFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/BiAStarFinder.js","webpack://storm-react-diagrams/./src/models/LinkModel.ts","webpack://storm-react-diagrams/./src/defaults/models/DefaultLinkModel.ts","webpack://storm-react-diagrams/./src/defaults/models/DefaultLabelModel.tsx","webpack://storm-react-diagrams/./src/models/LabelModel.ts","webpack://storm-react-diagrams/./src/defaults/models/DefaultPortModel.ts","webpack://storm-react-diagrams/./src/main.ts","webpack://storm-react-diagrams/./src/models/DiagramModel.ts","webpack://storm-react-diagrams/./src/defaults/factories/DefaultPortFactory.tsx","webpack://storm-react-diagrams/./src/factories/AbstractPortFactory.ts","webpack://storm-react-diagrams/./src/defaults/factories/DefaultLabelFactory.tsx","webpack://storm-react-diagrams/./src/factories/AbstractLabelFactory.ts","webpack://storm-react-diagrams/./src/defaults/widgets/DefaultLabelWidget.tsx","webpack://storm-react-diagrams/./src/defaults/models/DefaultNodeModel.ts","webpack://storm-react-diagrams/./src/defaults/widgets/DefaultLinkWidget.tsx","webpack://storm-react-diagrams/./src/factories/AbstractLinkFactory.ts","webpack://storm-react-diagrams/./src/defaults/widgets/DefaultNodeWidget.tsx","webpack://storm-react-diagrams/./src/defaults/widgets/DefaultPortLabelWidget.tsx","webpack://storm-react-diagrams/./src/widgets/PortWidget.tsx","webpack://storm-react-diagrams/./src/factories/AbstractNodeFactory.ts","webpack://storm-react-diagrams/./src/actions/MoveCanvasAction.ts","webpack://storm-react-diagrams/./src/actions/MoveItemsAction.ts","webpack://storm-react-diagrams/./src/actions/SelectingAction.ts","webpack://storm-react-diagrams/./src/widgets/layers/LinkLayerWidget.tsx","webpack://storm-react-diagrams/./src/widgets/LinkWidget.tsx","webpack://storm-react-diagrams/./src/widgets/layers/NodeLayerWidget.tsx","webpack://storm-react-diagrams/./src/widgets/NodeWidget.tsx","webpack://storm-react-diagrams/./node_modules/closest/index.js","webpack://storm-react-diagrams/./node_modules/matches-selector/index.js","webpack://storm-react-diagrams/./node_modules/pathfinding/index.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/PathFinding.js","webpack://storm-react-diagrams/./node_modules/heap/lib/heap.js","webpack://storm-react-diagrams/(webpack)/buildin/module.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/core/Grid.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/BestFirstFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/BreadthFirstFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/DijkstraFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/BiBestFirstFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/BiBreadthFirstFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/BiDijkstraFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/IDAStarFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/JumpPointFinder.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/JPFNeverMoveDiagonally.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/JPFAlwaysMoveDiagonally.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/JPFMoveDiagonallyIfNoObstacles.js","webpack://storm-react-diagrams/./node_modules/pathfinding/src/finders/JPFMoveDiagonallyIfAtMostOneObstacle.js","webpack://storm-react-diagrams/./node_modules/paths-js/path.js","webpack://storm-react-diagrams/./node_modules/paths-js/geom.js","webpack://storm-react-diagrams/./src/DiagramEngine.ts","webpack://storm-react-diagrams/./src/defaults/factories/DefaultLinkFactory.tsx","webpack://storm-react-diagrams/./src/defaults/factories/DefaultNodeFactory.ts","webpack://storm-react-diagrams/./src/widgets/DiagramWidget.tsx"],"names":["webpackUniversalModuleDefinition","root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__2__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","getDefault","getModuleExports","object","property","prototype","hasOwnProperty","p","s","DiagonalMovement","Always","Never","IfAtMostOneObstacle","OnlyWhenNoObstacles","React","BaseWidget","_super","__extends","props","_this","this","className","bem","selector","baseClass","getClassName","getProps","__assign","extraProps","Component","backtrace","node","path","x","y","parent","push","reverse","biBacktrace","nodeA","nodeB","pathA","pathB","concat","pathLength","sum","a","b","dx","dy","length","Math","sqrt","interpolate","x0","y0","x1","y1","abs","line","sx","sy","err","e2","expandPath","expanded","len","coord0","coord1","interpolated","interpolatedLen","j","smoothenPath","grid","ex","ey","newPath","coord","testCoord","blocked","isWalkableAt","lastValidCoord","compressPath","compressed","px","py","lx","ly","ldx","ldy","sq","closest","PathFinding_1","Path","Toolkit","UID","TESTING","TESTING_UID","replace","random","v","toString","element","document","body","generateLinePath","firstPoint","lastPoint","generateCurvePath","curvy","isHorizontal","curvyX","curvyY","generateDynamicPath","pathCoords","moveto","ROUTING_SCALING_FACTOR","slice","forEach","coords","lineto","print","BaseEntity_1","_","BaseModel","type","id","selected","getParent","setParent","getSelectedEntities","isSelected","deSerialize","ob","engine","serialize","merge","getType","getID","setSelected","iterateListeners","listener","event","selectionChanged","remove","entityRemoved","BaseEntity","BaseModel_1","PointModel","link","points","isConnectedToPort","getPortForPoint","getLink","removePoint","updateLocation","getX","getY","isLocked","manhattan","euclidean","octile","F","SQRT2","chebyshev","max","NodeModel","nodeType","extras","ports","setPosition","oldX","oldY","port","getLinks","point","getPointForPort","entities","map","portOb","getPortFactory","getNewInstance","addPort","doClone","lookupTable","clone","getPortFromID","getPort","getPorts","removePort","updateDimensions","_a","width","height","AbstractFactory","PF","pathFinderInstance","JumpPointFinder","heuristic","Heuristic","diagonalMovement","PathFinding","diagramEngine","instance","calculateDirectPath","from","to","matrix","getCanvasMatrix","Grid","findPath","translateRoutingX","floor","translateRoutingY","calculateLinkStartEndCoords","startIndex","findIndex","endIndex","undefined","pathToStart","pathToEnd","start","end","calculateDynamicPath","routingMatrix","dynamicPath","Util","Heap","JumpPointFinderBase","opt","trackJumpRecursion","startX","startY","endX","endY","openList","f","startNode","getNodeAt","endNode","g","opened","empty","pop","closed","_identifySuccessors","neighbors","neighbor","jumpPoint","jx","jy","ng","jumpNode","_findNeighbors","_jump","h","updateItem","Toolkit_1","listeners","locked","clearListeners","data","cb","firing","entity","stopPropagation","removeListener","addListener","uid","setLocked","lockChanged","DefaultLinkModel_1","PortModel","maximumLinks","links","parentNode","getNode","getName","getMaximumLinks","setMaximumLinks","removeLink","addLink","createLinkModel","isFinite","numberOfLinks","size","DefaultLinkModel","updateCoords","canLinkToPort","BaseAction","mouseX","mouseY","ms","Date","getTime","Node","walkable","AStarFinder","allowDiagonal","dontCrossCorners","weight","getNeighbors","BiAStarFinder","cmp","startOpenList","endOpenList","BY_START","BY_END","PointModel_1","LinkModel","linkType","sourcePort","targetPort","labels","label","labelOb","getLabelFactory","addLabel","target","setTargetPort","source","setSourcePort","setPoints","getPoints","isLastPoint","index","getPointIndex","indexOf","getPointModel","getFirstPoint","getLastPoint","sourcePortChanged","getSourcePort","getTargetPort","targetPortChanged","addPoint","generatePoint","pointModel","splice","removePointsBefore","removePointsAfter","removeMiddlePoints","LinkModel_1","DefaultLabelModel_1","LabelModel_1","color","curvyness","LabelModel","DefaultLabelModel","setLabel","setWidth","widthChanged","setColor","colorChanged","offsetY","offsetX","PortModel_1","DefaultPortModel","isInput","in","__export","NodeModel_1","DiagramModel","nodes","zoom","rendered","gridSize","setGridSize","gridUpdated","getGridPosition","pos","deSerializeDiagram","nodeOb","getNodeFactory","addNode","linkOb","getLinkFactory","serializeDiagram","clearSelection","ignore","getSelectedItems","filters","_i","arguments","Array","isArray","items","flatMap","uniq","filter","item","includes","setZoomLevel","zoomUpdated","setOffset","offsetUpdated","setOffsetX","setOffsetY","getOffsetY","getOffsetX","getZoomLevel","addAll","models","model","linksUpdated","isCreated","removeNode","nodesUpdated","getNodes","DefaultPortModel_1","AbstractPortFactory_1","DefaultPortFactory","initialConfig","AbstractPortFactory","AbstractFactory_1","AbstractLabelFactory_1","DefaultLabelWidget_1","DefaultLabelFactory","generateReactWidget","createElement","DefaultLabelWidget","AbstractLabelFactory","BaseWidget_1","render","DefaultNodeModel","addInPort","addOutPort","getInPorts","portModel","getOutPorts","DefaultLinkWidget","addPointToLink","shiftKey","isModelLocked","getMaxNumberPointsPerLink","getRelativeMousePoint","forceUpdate","pointAdded","findPathAndRelativePositionToRenderLabel","lengths","refPaths","getTotalLength","labelPosition","reduce","previousValue","currentValue","pathIndex","position","calculateLabelPosition","refLabels","labelDimensions","offsetWidth","offsetHeight","pathCentre","getPointAtLength","labelCoordinates","setAttribute","state","isSmartRoutingEnabled","pathFinding","default","calculateAllLabelPosition","componentDidUpdate","requestAnimationFrame","componentDidMount","pointIndex","cx","cy","onMouseLeave","setState","onMouseEnter","data-id","data-linkid","opacity","generateLabel","canvas","ref","getFactoryForLabel","generateLink","Bottom","cloneElement","getFactoryForLink","generateLinkSegment","Top","strokeLinecap","strokeOpacity","strokeWidth","onContextMenu","preventDefault","isSmartRoutingApplicable","nodesRendered","paths","directPathCoords","first","last","getRoutingMatrix","smartLink","simplifiedPath","onMouseDown","xOrY","margin","pointLeft","pointRight","this_1","data-point","labelModel","defaultProps","smooth","AbstractLinkFactory","DefaultPortLabelWidget_1","DefaultNodeWidget","generatePort","DefaultPortLabel","style","background","PortWidget_1","PortWidget","data-name","data-nodeid","AbstractNodeFactory","BaseAction_1","MoveCanvasAction","diagramModel","initialOffsetX","initialOffsetY","MoveItemsAction","moved","enableRepaintEntities","getDiagramModel","selectedItems","selectionModels","initialX","initialY","SelectingAction","mouseX2","mouseY2","getBoxDimensions","left","top","right","bottom","containsElement","z","dimensions","LinkWidget_1","LinkLayerWidget","transform","linksThatHaveInitiallyRendered","portCenter","getPortCenter","portCoords","getPortCoords","generatedLink","generateWidgetForLink","Error","LinkWidget","shouldComponentUpdate","canEntityRepaint","children","NodeWidget_1","NodeLayerWidget","updateNodeDimensions","getNodeDimensions","NodeWidget","generateWidgetForNode","matches","checkYoSelf","proto","Element","vendor","matchesSelector","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","match","el","querySelectorAll","BestFirstFinder","BreadthFirstFinder","DijkstraFinder","BiBestFirstFinder","BiBreadthFirstFinder","BiDijkstraFinder","IDAStarFinder","defaultCmp","heapify","heappop","heappush","heappushpop","heapreplace","insort","min","nlargest","nsmallest","_siftdown","_siftup","lo","hi","mid","apply","array","lastelt","returnitem","_ref","_j","_len","_ref1","_results","_results1","elem","result","sort","los","startpos","newitem","parentpos","childpos","endpos","rightpos","pushpop","peek","contains","clear","heap","toArray","insert","front","has","copy","webpackPolyfill","deprecate","width_or_matrix","_buildNodes","isInside","setWalkableAt","s0","d0","s1","d1","s2","d2","s3","d3","thisNodes","newGrid","newNodes","orig","constructor","shift","by","trackRecursion","timeLimit","Infinity","nodesVisited","startTime","cost","search","cutoff","route","depth","k","neighbour","neighbours","retainCount","tested","cutOff","JPFNeverMoveDiagonally","JPFAlwaysMoveDiagonally","JPFMoveDiagonallyIfNoObstacles","JPFMoveDiagonallyIfAtMostOneObstacle","nx","ny","neighborNodes","neighborNode","isNextWalkable","isTopWalkable","isBottomWalkable","isRightWalkable","isLeftWalkable","_slicedToArray","sliceIterator","arr","_arr","_n","_d","_e","iterator","_s","next","done","TypeError","_geom","init","_instructions","areEqualPoints","_ref3","_ref2","a1","b1","_ref32","a2","b2","trimZeros","string","char","charAt","substr","round","number","digits","str","toFixed","printInstrunction","_ref4","command","params","numbers","param","join","_ref5","prev","transformParams","instruction","transformer","V","pts","newPts","matrixTransform","H","A","transformEllipse","sweepFlag","isDegenerate","rx","ry","ax","C","Z","_default","newParams","verbosify","keys","args","plus","hlineto","vlineto","closepath","curveto","x2","y2","smoothcurveto","qcurveto","smoothqcurveto","arc","xrot","largeArcFlag","translate","_ret","newInstructions","rotate","angle","_ret2","rad","PI","cos","sin","scale","_ret3","shearX","_ret4","tan","shearY","_ret5","ps","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","instructions","connect","unshift","distPointToPoint","ay","bx","distPointToParabol","circumCenter","xc","yc","parabolsCrossX","fa","fb","q","doHalflinesCross","sa","sb","approx","hp","vec","det","u","torad","epsilon","ma","J","K","D","JK","L","l1","l2","newAx","newRx","newRy","atan","DiagramModel_1","main_1","DefaultPortFactory_1","DefaultLabelFactory_1","DiagramEngine","canvasMatrix","hAdjustmentFactor","vAdjustmentFactor","calculateMatrixDimensions","allNodesCoords","values","allLinks","allPortsCoords","allPointsCoords","minX","minBy","maxXElement","maxBy","maxX","minY","maxYElement","maxY","ceil","markNodes","markMatrixPoint","markPorts","allElements","nodeFactories","linkFactories","portFactories","labelFactories","paintableWidgets","installDefaultFactories","registerNodeFactory","DefaultNodeFactory","registerLinkFactory","DefaultLinkFactory","registerPortFactory","registerLabelFactory","repaintCanvas","clearRepaintEntities","recalculatePortsVisually","baseModel","setCanvas","setDiagramModel","getNodeFactories","getLinkFactories","getLabelFactories","labelFactoriesUpdated","portFactoriesUpdated","nodeFactoriesUpdated","linkFactoriesUpdated","getFactoryForNode","linkFactory","nodeFactory","getRelativePoint","clientX","clientY","canvasRect","getBoundingClientRect","getNodeElement","querySelector","getNodePortElement","sourceElement","sourceRect","rel","nodeElement","nodeRect","maxNumberPointsPerLink","setMaxNumberPointsPerLink","smartRouting","setSmartRoutingStatus","status","calculateCanvasMatrix","canvasWidth","canvasHeight","matrixWidth","matrixHeight","range","fill","calculateRoutingMatrix","cloneDeep","zoomToFit","xFactor","clientWidth","scrollWidth","yFactor","clientHeight","scrollHeight","zoomFactor","DefaultLinkWidget_1","AbstractLinkFactory_1","widget","stroke","DefaultNodeModel_1","DefaultNodeWidget_1","AbstractNodeFactory_1","LinkLayerWidget_1","NodeLayerWidget_1","MoveCanvasAction_1","MoveItemsAction_1","SelectingAction_1","DiagramWidget","onKeyUpPointer","onMouseMove","onMouseUp","action","wasMoved","renderedNodes","windowListener","diagramEngineListener","componentWillUnmount","removeEventListener","componentWillReceiveProps","nextProps","componentWillUpdate","onKeyUp","addEventListener","focus","getMouseElement","getAttribute","fireAction","actionStillFiring","stopFiringAction","shouldSkipEvent","actionStoppedFiring","startFiringAction","actionStartedFiring","relative","allSelected","amountX_1","amountY_1","amountZoom_1","allowCanvasTranslation","deleteKeys","keyCode","newLink","allowLooseLinks","selectedPoint","some","drawSelectionBox","onWheel","allowCanvasZoom","oldZoomFactor","scrollDelta","inverseZoom","deltaY","ctrlKey","boundingRect","currentTarget","widthDiff","heightDiff","nativeEvent","which"],"mappings":"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","file":"main.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"lodash\"), require(\"react\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"_\", \"react\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"storm-react-diagrams\"] = factory(require(\"lodash\"), require(\"react\"));\n\telse\n\t\troot[\"storm-react-diagrams\"] = factory(root[\"_\"], root[\"React\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__2__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 25);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","var DiagonalMovement = {\r\n    Always: 1,\r\n    Never: 2,\r\n    IfAtMostOneObstacle: 3,\r\n    OnlyWhenNoObstacles: 4\r\n};\r\n\r\nmodule.exports = DiagonalMovement;","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","import * as React from \"react\";\nimport * as _ from \"lodash\";\n\nexport interface BaseWidgetProps {\n\t/**\n\t * Override the base class name\n\t */\n\tbaseClass?: string;\n\t/**\n\t * append additional classes\n\t */\n\tclassName?: string;\n\n\t/**\n\t * Additional props to add\n\t */\n\textraProps?: any;\n}\n\nexport class BaseWidget<P extends BaseWidgetProps = BaseWidgetProps, S = any> extends React.Component<P, S> {\n\tclassName: string;\n\n\tconstructor(name: string, props: P) {\n\t\tsuper(props);\n\t\tthis.className = name;\n\t}\n\n\tbem(selector: string): string {\n\t\treturn (this.props.baseClass || this.className) + selector + \" \";\n\t}\n\n\tgetClassName(): string {\n\t\treturn (\n\t\t\t(this.props.baseClass || this.className) + \" \" + (this.props.className ? this.props.className + \" \" : \"\")\n\t\t);\n\t}\n\n\tgetProps(): any {\n\t\treturn {\n\t\t\t...((this.props.extraProps as any) || {}),\n\t\t\tclassName: this.getClassName()\n\t\t};\n\t}\n}\n","/**\r\n * Backtrace according to the parent records and return the path.\r\n * (including both start and end nodes)\r\n * @param {Node} node End node\r\n * @return {Array<Array<number>>} the path\r\n */\r\nfunction backtrace(node) {\r\n    var path = [[node.x, node.y]];\r\n    while (node.parent) {\r\n        node = node.parent;\r\n        path.push([node.x, node.y]);\r\n    }\r\n    return path.reverse();\r\n}\r\nexports.backtrace = backtrace;\r\n\r\n/**\r\n * Backtrace from start and end node, and return the path.\r\n * (including both start and end nodes)\r\n * @param {Node}\r\n * @param {Node}\r\n */\r\nfunction biBacktrace(nodeA, nodeB) {\r\n    var pathA = backtrace(nodeA),\r\n        pathB = backtrace(nodeB);\r\n    return pathA.concat(pathB.reverse());\r\n}\r\nexports.biBacktrace = biBacktrace;\r\n\r\n/**\r\n * Compute the length of the path.\r\n * @param {Array<Array<number>>} path The path\r\n * @return {number} The length of the path\r\n */\r\nfunction pathLength(path) {\r\n    var i, sum = 0, a, b, dx, dy;\r\n    for (i = 1; i < path.length; ++i) {\r\n        a = path[i - 1];\r\n        b = path[i];\r\n        dx = a[0] - b[0];\r\n        dy = a[1] - b[1];\r\n        sum += Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n    return sum;\r\n}\r\nexports.pathLength = pathLength;\r\n\r\n\r\n/**\r\n * Given the start and end coordinates, return all the coordinates lying\r\n * on the line formed by these coordinates, based on Bresenham's algorithm.\r\n * http://en.wikipedia.org/wiki/Bresenham's_line_algorithm#Simplification\r\n * @param {number} x0 Start x coordinate\r\n * @param {number} y0 Start y coordinate\r\n * @param {number} x1 End x coordinate\r\n * @param {number} y1 End y coordinate\r\n * @return {Array<Array<number>>} The coordinates on the line\r\n */\r\nfunction interpolate(x0, y0, x1, y1) {\r\n    var abs = Math.abs,\r\n        line = [],\r\n        sx, sy, dx, dy, err, e2;\r\n\r\n    dx = abs(x1 - x0);\r\n    dy = abs(y1 - y0);\r\n\r\n    sx = (x0 < x1) ? 1 : -1;\r\n    sy = (y0 < y1) ? 1 : -1;\r\n\r\n    err = dx - dy;\r\n\r\n    while (true) {\r\n        line.push([x0, y0]);\r\n\r\n        if (x0 === x1 && y0 === y1) {\r\n            break;\r\n        }\r\n        \r\n        e2 = 2 * err;\r\n        if (e2 > -dy) {\r\n            err = err - dy;\r\n            x0 = x0 + sx;\r\n        }\r\n        if (e2 < dx) {\r\n            err = err + dx;\r\n            y0 = y0 + sy;\r\n        }\r\n    }\r\n\r\n    return line;\r\n}\r\nexports.interpolate = interpolate;\r\n\r\n\r\n/**\r\n * Given a compressed path, return a new path that has all the segments\r\n * in it interpolated.\r\n * @param {Array<Array<number>>} path The path\r\n * @return {Array<Array<number>>} expanded path\r\n */\r\nfunction expandPath(path) {\r\n    var expanded = [],\r\n        len = path.length,\r\n        coord0, coord1,\r\n        interpolated,\r\n        interpolatedLen,\r\n        i, j;\r\n\r\n    if (len < 2) {\r\n        return expanded;\r\n    }\r\n\r\n    for (i = 0; i < len - 1; ++i) {\r\n        coord0 = path[i];\r\n        coord1 = path[i + 1];\r\n\r\n        interpolated = interpolate(coord0[0], coord0[1], coord1[0], coord1[1]);\r\n        interpolatedLen = interpolated.length;\r\n        for (j = 0; j < interpolatedLen - 1; ++j) {\r\n            expanded.push(interpolated[j]);\r\n        }\r\n    }\r\n    expanded.push(path[len - 1]);\r\n\r\n    return expanded;\r\n}\r\nexports.expandPath = expandPath;\r\n\r\n\r\n/**\r\n * Smoothen the give path.\r\n * The original path will not be modified; a new path will be returned.\r\n * @param {PF.Grid} grid\r\n * @param {Array<Array<number>>} path The path\r\n */\r\nfunction smoothenPath(grid, path) {\r\n    var len = path.length,\r\n        x0 = path[0][0],        // path start x\r\n        y0 = path[0][1],        // path start y\r\n        x1 = path[len - 1][0],  // path end x\r\n        y1 = path[len - 1][1],  // path end y\r\n        sx, sy,                 // current start coordinate\r\n        ex, ey,                 // current end coordinate\r\n        newPath,\r\n        i, j, coord, line, testCoord, blocked;\r\n\r\n    sx = x0;\r\n    sy = y0;\r\n    newPath = [[sx, sy]];\r\n\r\n    for (i = 2; i < len; ++i) {\r\n        coord = path[i];\r\n        ex = coord[0];\r\n        ey = coord[1];\r\n        line = interpolate(sx, sy, ex, ey);\r\n\r\n        blocked = false;\r\n        for (j = 1; j < line.length; ++j) {\r\n            testCoord = line[j];\r\n\r\n            if (!grid.isWalkableAt(testCoord[0], testCoord[1])) {\r\n                blocked = true;\r\n                break;\r\n            }\r\n        }\r\n        if (blocked) {\r\n            lastValidCoord = path[i - 1];\r\n            newPath.push(lastValidCoord);\r\n            sx = lastValidCoord[0];\r\n            sy = lastValidCoord[1];\r\n        }\r\n    }\r\n    newPath.push([x1, y1]);\r\n\r\n    return newPath;\r\n}\r\nexports.smoothenPath = smoothenPath;\r\n\r\n\r\n/**\r\n * Compress a path, remove redundant nodes without altering the shape\r\n * The original path is not modified\r\n * @param {Array<Array<number>>} path The path\r\n * @return {Array<Array<number>>} The compressed path\r\n */\r\nfunction compressPath(path) {\r\n\r\n    // nothing to compress\r\n    if(path.length < 3) {\r\n        return path;\r\n    }\r\n\r\n    var compressed = [],\r\n        sx = path[0][0], // start x\r\n        sy = path[0][1], // start y\r\n        px = path[1][0], // second point x\r\n        py = path[1][1], // second point y\r\n        dx = px - sx, // direction between the two points\r\n        dy = py - sy, // direction between the two points\r\n        lx, ly,\r\n        ldx, ldy,\r\n        sq, i;\r\n\r\n    // normalize the direction\r\n    sq = Math.sqrt(dx*dx + dy*dy);\r\n    dx /= sq;\r\n    dy /= sq;\r\n\r\n    // start the new path\r\n    compressed.push([sx,sy]);\r\n\r\n    for(i = 2; i < path.length; i++) {\r\n\r\n        // store the last point\r\n        lx = px;\r\n        ly = py;\r\n\r\n        // store the last direction\r\n        ldx = dx;\r\n        ldy = dy;\r\n\r\n        // next point\r\n        px = path[i][0];\r\n        py = path[i][1];\r\n\r\n        // next direction\r\n        dx = px - lx;\r\n        dy = py - ly;\r\n\r\n        // normalize\r\n        sq = Math.sqrt(dx*dx + dy*dy);\r\n        dx /= sq;\r\n        dy /= sq;\r\n\r\n        // if the direction has changed, store the point\r\n        if ( dx !== ldx || dy !== ldy ) {\r\n            compressed.push([lx,ly]);\r\n        }\r\n    }\r\n\r\n    // store the last point\r\n    compressed.push([px,py]);\r\n\r\n    return compressed;\r\n}\r\nexports.compressPath = compressPath;\r\n","// tslint:disable no-bitwise\nimport closest = require(\"closest\");\nimport { PointModel } from \"./models/PointModel\";\nimport { ROUTING_SCALING_FACTOR } from \"./routing/PathFinding\";\nimport * as Path from \"paths-js/path\";\n/**\n * @author Dylan Vorster\n */\nexport class Toolkit {\n\tstatic TESTING: boolean = false;\n\tstatic TESTING_UID = 0;\n\n\t/**\n\t * Generats a unique ID (thanks Stack overflow :3)\n\t * @returns {String}\n\t */\n\tpublic static UID(): string {\n\t\tif (Toolkit.TESTING) {\n\t\t\tToolkit.TESTING_UID++;\n\t\t\treturn \"\" + Toolkit.TESTING_UID;\n\t\t}\n\t\treturn \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, c => {\n\t\t\tconst r = (Math.random() * 16) | 0;\n\t\t\tconst v = c === \"x\" ? r : (r & 0x3) | 0x8;\n\t\t\treturn v.toString(16);\n\t\t});\n\t}\n\n\t/**\n\t * Finds the closest element as a polyfill\n\t *\n\t * @param  {Element} element  [description]\n\t * @param  {string}  selector [description]\n\t */\n\tpublic static closest(element: Element, selector: string) {\n\t\tif (document.body.closest) {\n\t\t\treturn element.closest(selector);\n\t\t}\n\t\treturn closest(element, selector);\n\t}\n\n\tpublic static generateLinePath(firstPoint: PointModel, lastPoint: PointModel): string {\n\t\treturn `M${firstPoint.x},${firstPoint.y} L ${lastPoint.x},${lastPoint.y}`;\n\t}\n\n\tpublic static generateCurvePath(firstPoint: PointModel, lastPoint: PointModel, curvy: number = 0): string {\n\t\tvar isHorizontal = Math.abs(firstPoint.x - lastPoint.x) > Math.abs(firstPoint.y - lastPoint.y);\n\t\tvar curvyX = isHorizontal ? curvy : 0;\n\t\tvar curvyY = isHorizontal ? 0 : curvy;\n\n\t\treturn `M${firstPoint.x},${firstPoint.y} C ${firstPoint.x + curvyX},${firstPoint.y + curvyY}\n    ${lastPoint.x - curvyX},${lastPoint.y - curvyY} ${lastPoint.x},${lastPoint.y}`;\n\t}\n\n\tpublic static generateDynamicPath(pathCoords: number[][]) {\n\t\tlet path = Path();\n\t\tpath = path.moveto(pathCoords[0][0] * ROUTING_SCALING_FACTOR, pathCoords[0][1] * ROUTING_SCALING_FACTOR);\n\t\tpathCoords.slice(1).forEach(coords => {\n\t\t\tpath = path.lineto(coords[0] * ROUTING_SCALING_FACTOR, coords[1] * ROUTING_SCALING_FACTOR);\n\t\t});\n\t\treturn path.print();\n\t}\n}\n","import { BaseEntity, BaseListener } from \"../BaseEntity\";\nimport * as _ from \"lodash\";\nimport { BaseEvent } from \"../BaseEntity\";\nimport { DiagramEngine } from \"../DiagramEngine\";\n\nexport interface BaseModelListener extends BaseListener {\n\tselectionChanged?(event: BaseEvent<BaseModel> & { isSelected: boolean }): void;\n\n\tentityRemoved?(event: BaseEvent<BaseModel>): void;\n}\n\n/**\n * @author Dylan Vorster\n */\nexport class BaseModel<\n\tX extends BaseEntity = BaseEntity,\n\tT extends BaseModelListener = BaseModelListener\n> extends BaseEntity<T> {\n\ttype: string;\n\tselected: boolean;\n\tparent: X;\n\n\tconstructor(type?: string, id?: string) {\n\t\tsuper(id);\n\t\tthis.type = type;\n\t\tthis.selected = false;\n\t}\n\n\tpublic getParent(): X {\n\t\treturn this.parent;\n\t}\n\n\tpublic setParent(parent: X) {\n\t\tthis.parent = parent;\n\t}\n\n\tpublic getSelectedEntities(): BaseModel<any, T>[] {\n\t\tif (this.isSelected()) {\n\t\t\treturn [this];\n\t\t}\n\t\treturn [];\n\t}\n\n\tpublic deSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.type = ob.type;\n\t\tthis.selected = ob.selected;\n\t}\n\n\tpublic serialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\ttype: this.type,\n\t\t\tselected: this.selected\n\t\t});\n\t}\n\n\tpublic getType(): string {\n\t\treturn this.type;\n\t}\n\n\tpublic getID(): string {\n\t\treturn this.id;\n\t}\n\n\tpublic isSelected(): boolean {\n\t\treturn this.selected;\n\t}\n\n\tpublic setSelected(selected: boolean = true) {\n\t\tthis.selected = selected;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.selectionChanged) {\n\t\t\t\tlistener.selectionChanged({ ...event, isSelected: selected });\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic remove() {\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.entityRemoved) {\n\t\t\t\tlistener.entityRemoved(event);\n\t\t\t}\n\t\t});\n\t}\n}\n","import { BaseModel, BaseModelListener } from \"./BaseModel\";\nimport { LinkModel } from \"./LinkModel\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"../DiagramEngine\";\n\nexport class PointModel extends BaseModel<LinkModel, BaseModelListener> {\n\tx: number;\n\ty: number;\n\n\tconstructor(link: LinkModel, points: { x: number; y: number }) {\n\t\tsuper();\n\t\tthis.x = points.x;\n\t\tthis.y = points.y;\n\t\tthis.parent = link;\n\t}\n\n\tgetSelectedEntities() {\n\t\tif (super.isSelected() && !this.isConnectedToPort()) {\n\t\t\treturn [this];\n\t\t}\n\t\treturn [];\n\t}\n\n\tisConnectedToPort(): boolean {\n\t\treturn this.parent.getPortForPoint(this) !== null;\n\t}\n\n\tgetLink(): LinkModel {\n\t\treturn this.getParent();\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.x = ob.x;\n\t\tthis.y = ob.y;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tx: this.x,\n\t\t\ty: this.y\n\t\t});\n\t}\n\n\tremove() {\n\t\t//clear references\n\t\tif (this.parent) {\n\t\t\tthis.parent.removePoint(this);\n\t\t}\n\t\tsuper.remove();\n\t}\n\n\tupdateLocation(points: { x: number; y: number }) {\n\t\tthis.x = points.x;\n\t\tthis.y = points.y;\n\t}\n\n\tgetX(): number {\n\t\treturn this.x;\n\t}\n\n\tgetY(): number {\n\t\treturn this.y;\n\t}\n\n\tisLocked() {\n\t\treturn super.isLocked() || this.getParent().isLocked();\n\t}\n}\n","/**\r\n * @namespace PF.Heuristic\r\n * @description A collection of heuristic functions.\r\n */\r\nmodule.exports = {\r\n\r\n  /**\r\n   * Manhattan distance.\r\n   * @param {number} dx - Difference in x.\r\n   * @param {number} dy - Difference in y.\r\n   * @return {number} dx + dy\r\n   */\r\n  manhattan: function(dx, dy) {\r\n      return dx + dy;\r\n  },\r\n\r\n  /**\r\n   * Euclidean distance.\r\n   * @param {number} dx - Difference in x.\r\n   * @param {number} dy - Difference in y.\r\n   * @return {number} sqrt(dx * dx + dy * dy)\r\n   */\r\n  euclidean: function(dx, dy) {\r\n      return Math.sqrt(dx * dx + dy * dy);\r\n  },\r\n\r\n  /**\r\n   * Octile distance.\r\n   * @param {number} dx - Difference in x.\r\n   * @param {number} dy - Difference in y.\r\n   * @return {number} sqrt(dx * dx + dy * dy) for grids\r\n   */\r\n  octile: function(dx, dy) {\r\n      var F = Math.SQRT2 - 1;\r\n      return (dx < dy) ? F * dx + dy : F * dy + dx;\r\n  },\r\n\r\n  /**\r\n   * Chebyshev distance.\r\n   * @param {number} dx - Difference in x.\r\n   * @param {number} dy - Difference in y.\r\n   * @return {number} max(dx, dy)\r\n   */\r\n  chebyshev: function(dx, dy) {\r\n      return Math.max(dx, dy);\r\n  }\r\n\r\n};\r\n","import { BaseModel, BaseModelListener } from \"./BaseModel\";\nimport { PortModel } from \"./PortModel\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { DiagramModel } from \"./DiagramModel\";\n\nexport class NodeModel extends BaseModel<DiagramModel, BaseModelListener> {\n\tx: number;\n\ty: number;\n\textras: any;\n\tports: { [s: string]: PortModel };\n\n\t// calculated post rendering so routing can be done correctly\n\twidth: number;\n\theight: number;\n\n\tconstructor(nodeType: string = \"default\", id?: string) {\n\t\tsuper(nodeType, id);\n\t\tthis.x = 0;\n\t\tthis.y = 0;\n\t\tthis.extras = {};\n\t\tthis.ports = {};\n\t}\n\n\tsetPosition(x, y) {\n\t\t//store position\n\t\tlet oldX = this.x;\n\t\tlet oldY = this.y;\n\t\t_.forEach(this.ports, port => {\n\t\t\t_.forEach(port.getLinks(), link => {\n\t\t\t\tlet point = link.getPointForPort(port);\n\t\t\t\tpoint.x = point.x + x - oldX;\n\t\t\t\tpoint.y = point.y + y - oldY;\n\t\t\t});\n\t\t});\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\n\tgetSelectedEntities() {\n\t\tlet entities = super.getSelectedEntities();\n\n\t\t// add the points of each link that are selected here\n\t\tif (this.isSelected()) {\n\t\t\t_.forEach(this.ports, port => {\n\t\t\t\tentities = entities.concat(\n\t\t\t\t\t_.map(port.getLinks(), link => {\n\t\t\t\t\t\treturn link.getPointForPort(port);\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\treturn entities;\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.x = ob.x;\n\t\tthis.y = ob.y;\n\t\tthis.extras = ob.extras;\n\n\t\t//deserialize ports\n\t\t_.forEach(ob.ports, (port: any) => {\n\t\t\tlet portOb = engine.getPortFactory(port.type).getNewInstance();\n\t\t\tportOb.deSerialize(port, engine);\n\t\t\tthis.addPort(portOb);\n\t\t});\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tx: this.x,\n\t\t\ty: this.y,\n\t\t\textras: this.extras,\n\t\t\tports: _.map(this.ports, port => {\n\t\t\t\treturn port.serialize();\n\t\t\t})\n\t\t});\n\t}\n\n\tdoClone(lookupTable = {}, clone) {\n\t\t// also clone the ports\n\t\tclone.ports = {};\n\t\t_.forEach(this.ports, port => {\n\t\t\tclone.addPort(port.clone(lookupTable));\n\t\t});\n\t}\n\n\tremove() {\n\t\tsuper.remove();\n\t\t_.forEach(this.ports, port => {\n\t\t\t_.forEach(port.getLinks(), link => {\n\t\t\t\tlink.remove();\n\t\t\t});\n\t\t});\n\t}\n\n\tgetPortFromID(id): PortModel | null {\n\t\tfor (var i in this.ports) {\n\t\t\tif (this.ports[i].id === id) {\n\t\t\t\treturn this.ports[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetPort(name: string): PortModel | null {\n\t\treturn this.ports[name];\n\t}\n\n\tgetPorts(): { [s: string]: PortModel } {\n\t\treturn this.ports;\n\t}\n\n\tremovePort(port: PortModel) {\n\t\t//clear the parent node reference\n\t\tif (this.ports[port.name]) {\n\t\t\tthis.ports[port.name].setParent(null);\n\t\t\tdelete this.ports[port.name];\n\t\t}\n\t}\n\n\taddPort<T extends PortModel>(port: T): T {\n\t\tport.setParent(this);\n\t\tthis.ports[port.name] = port;\n\t\treturn port;\n\t}\n\n\tupdateDimensions({ width, height }: { width: number; height: number }) {\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t}\n}\n","import { BaseModel } from \"../models/BaseModel\";\n\nexport abstract class AbstractFactory<T extends BaseModel> {\n\ttype: string;\n\n\tconstructor(name: string) {\n\t\tthis.type = name;\n\t}\n\n\tgetType(): string {\n\t\treturn this.type;\n\t}\n\n\tabstract getNewInstance(initialConfig?: any): T;\n}\n","import * as PF from \"pathfinding\";\nimport { DiagramEngine } from \"../main\";\n\n/*\nit can be very expensive to calculate routes when every single pixel on the canvas\nis individually represented. Using the factor below, we combine values in order\nto achieve the best trade-off between accuracy and performance.\n*/\nexport const ROUTING_SCALING_FACTOR = 5;\n\nconst pathFinderInstance = new PF.JumpPointFinder({\n\theuristic: PF.Heuristic.manhattan,\n\tdiagonalMovement: PF.DiagonalMovement.Never\n});\n\nexport default class PathFinding {\n\tinstance: any;\n\tdiagramEngine: DiagramEngine;\n\n\tconstructor(diagramEngine: DiagramEngine) {\n\t\tthis.instance = pathFinderInstance;\n\t\tthis.diagramEngine = diagramEngine;\n\t}\n\n\t/**\n\t * Taking as argument a fully unblocked walking matrix, this method\n\t * finds a direct path from point A to B.\n\t */\n\tcalculateDirectPath(\n\t\tfrom: {\n\t\t\tx: number;\n\t\t\ty: number;\n\t\t},\n\t\tto: {\n\t\t\tx: number;\n\t\t\ty: number;\n\t\t}\n\t): number[][] {\n\t\tconst matrix = this.diagramEngine.getCanvasMatrix();\n\t\tconst grid = new PF.Grid(matrix);\n\n\t\treturn pathFinderInstance.findPath(\n\t\t\tthis.diagramEngine.translateRoutingX(Math.floor(from.x / ROUTING_SCALING_FACTOR)),\n\t\t\tthis.diagramEngine.translateRoutingY(Math.floor(from.y / ROUTING_SCALING_FACTOR)),\n\t\t\tthis.diagramEngine.translateRoutingX(Math.floor(to.x / ROUTING_SCALING_FACTOR)),\n\t\t\tthis.diagramEngine.translateRoutingY(Math.floor(to.y / ROUTING_SCALING_FACTOR)),\n\t\t\tgrid\n\t\t);\n\t}\n\n\t/**\n\t * Using @link{#calculateDirectPath}'s result as input, we here\n\t * determine the first walkable point found in the matrix that includes\n\t * blocked paths.\n\t */\n\tcalculateLinkStartEndCoords(\n\t\tmatrix: number[][],\n\t\tpath: number[][]\n\t): {\n\t\tstart: {\n\t\t\tx: number;\n\t\t\ty: number;\n\t\t};\n\t\tend: {\n\t\t\tx: number;\n\t\t\ty: number;\n\t\t};\n\t\tpathToStart: number[][];\n\t\tpathToEnd: number[][];\n\t} {\n\t\tconst startIndex = path.findIndex(point => matrix[point[1]][point[0]] === 0);\n\t\tconst endIndex =\n\t\t\tpath.length -\n\t\t\t1 -\n\t\t\tpath\n\t\t\t\t.slice()\n\t\t\t\t.reverse()\n\t\t\t\t.findIndex(point => matrix[point[1]][point[0]] === 0);\n\n\t\t// are we trying to create a path exclusively through blocked areas?\n\t\t// if so, let's fallback to the linear routing\n\t\tif (startIndex === -1 || endIndex === -1) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst pathToStart = path.slice(0, startIndex);\n\t\tconst pathToEnd = path.slice(endIndex);\n\n\t\treturn {\n\t\t\tstart: {\n\t\t\t\tx: path[startIndex][0],\n\t\t\t\ty: path[startIndex][1]\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tx: path[endIndex][0],\n\t\t\t\ty: path[endIndex][1]\n\t\t\t},\n\t\t\tpathToStart,\n\t\t\tpathToEnd\n\t\t};\n\t}\n\n\t/**\n\t * Puts everything together: merges the paths from/to the centre of the ports,\n\t * with the path calculated around other elements.\n\t */\n\tcalculateDynamicPath(\n\t\troutingMatrix: number[][],\n\t\tstart: {\n\t\t\tx: number;\n\t\t\ty: number;\n\t\t},\n\t\tend: {\n\t\t\tx: number;\n\t\t\ty: number;\n\t\t},\n\t\tpathToStart: number[][],\n\t\tpathToEnd: number[][]\n\t) {\n\t\t// generate the path based on the matrix with obstacles\n\t\tconst grid = new PF.Grid(routingMatrix);\n\t\tconst dynamicPath = pathFinderInstance.findPath(start.x, start.y, end.x, end.y, grid);\n\n\t\t// aggregate everything to have the calculated path ready for rendering\n\t\tconst pathCoords = pathToStart\n\t\t\t.concat(dynamicPath, pathToEnd)\n\t\t\t.map(coords => [\n\t\t\t\tthis.diagramEngine.translateRoutingX(coords[0], true),\n\t\t\t\tthis.diagramEngine.translateRoutingY(coords[1], true)\n\t\t\t]);\n\t\treturn PF.Util.compressPath(pathCoords);\n\t}\n}\n","module.exports = require('./lib/heap');\n","/**\r\n * @author imor / https://github.com/imor\r\n */\r\nvar Heap       = require('heap');\r\nvar Util       = require('../core/Util');\r\nvar Heuristic  = require('../core/Heuristic');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Base class for the Jump Point Search algorithm\r\n * @param {object} opt\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n */\r\nfunction JumpPointFinderBase(opt) {\r\n    opt = opt || {};\r\n    this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    this.trackJumpRecursion = opt.trackJumpRecursion || false;\r\n}\r\n\r\n/**\r\n * Find and return the path.\r\n * @return {Array<Array<number>>} The path, including both start and\r\n *     end positions.\r\n */\r\nJumpPointFinderBase.prototype.findPath = function(startX, startY, endX, endY, grid) {\r\n    var openList = this.openList = new Heap(function(nodeA, nodeB) {\r\n            return nodeA.f - nodeB.f;\r\n        }),\r\n        startNode = this.startNode = grid.getNodeAt(startX, startY),\r\n        endNode = this.endNode = grid.getNodeAt(endX, endY), node;\r\n\r\n    this.grid = grid;\r\n\r\n\r\n    // set the `g` and `f` value of the start node to be 0\r\n    startNode.g = 0;\r\n    startNode.f = 0;\r\n\r\n    // push the start node into the open list\r\n    openList.push(startNode);\r\n    startNode.opened = true;\r\n\r\n    // while the open list is not empty\r\n    while (!openList.empty()) {\r\n        // pop the position of node which has the minimum `f` value.\r\n        node = openList.pop();\r\n        node.closed = true;\r\n\r\n        if (node === endNode) {\r\n            return Util.expandPath(Util.backtrace(endNode));\r\n        }\r\n\r\n        this._identifySuccessors(node);\r\n    }\r\n\r\n    // fail to find the path\r\n    return [];\r\n};\r\n\r\n/**\r\n * Identify successors for the given node. Runs a jump point search in the\r\n * direction of each available neighbor, adding any points found to the open\r\n * list.\r\n * @protected\r\n */\r\nJumpPointFinderBase.prototype._identifySuccessors = function(node) {\r\n    var grid = this.grid,\r\n        heuristic = this.heuristic,\r\n        openList = this.openList,\r\n        endX = this.endNode.x,\r\n        endY = this.endNode.y,\r\n        neighbors, neighbor,\r\n        jumpPoint, i, l,\r\n        x = node.x, y = node.y,\r\n        jx, jy, dx, dy, d, ng, jumpNode,\r\n        abs = Math.abs, max = Math.max;\r\n\r\n    neighbors = this._findNeighbors(node);\r\n    for(i = 0, l = neighbors.length; i < l; ++i) {\r\n        neighbor = neighbors[i];\r\n        jumpPoint = this._jump(neighbor[0], neighbor[1], x, y);\r\n        if (jumpPoint) {\r\n\r\n            jx = jumpPoint[0];\r\n            jy = jumpPoint[1];\r\n            jumpNode = grid.getNodeAt(jx, jy);\r\n\r\n            if (jumpNode.closed) {\r\n                continue;\r\n            }\r\n\r\n            // include distance, as parent may not be immediately adjacent:\r\n            d = Heuristic.octile(abs(jx - x), abs(jy - y));\r\n            ng = node.g + d; // next `g` value\r\n\r\n            if (!jumpNode.opened || ng < jumpNode.g) {\r\n                jumpNode.g = ng;\r\n                jumpNode.h = jumpNode.h || heuristic(abs(jx - endX), abs(jy - endY));\r\n                jumpNode.f = jumpNode.g + jumpNode.h;\r\n                jumpNode.parent = node;\r\n\r\n                if (!jumpNode.opened) {\r\n                    openList.push(jumpNode);\r\n                    jumpNode.opened = true;\r\n                } else {\r\n                    openList.updateItem(jumpNode);\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n\r\nmodule.exports = JumpPointFinderBase;\r\n","import { Toolkit } from \"./Toolkit\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"./DiagramEngine\";\n\n/**\n * @author Dylan Vorster\n */\nexport interface BaseEvent<T extends BaseEntity = any> {\n\tentity: BaseEntity<BaseListener>;\n\tstopPropagation: () => any;\n\tfiring: boolean;\n\tid: string;\n}\n\nexport interface BaseListener<T extends BaseEntity = any> {\n\tlockChanged?(event: BaseEvent<T> & { locked: boolean }): void;\n}\n\nexport type BaseEntityType = \"node\" | \"link\" | \"port\" | \"point\";\n\nexport class BaseEntity<T extends BaseListener = BaseListener> {\n\tpublic listeners: { [s: string]: T };\n\tpublic id: string;\n\tpublic locked: boolean;\n\n\tconstructor(id?: string) {\n\t\tthis.listeners = {};\n\t\tthis.id = id || Toolkit.UID();\n\t\tthis.locked = false;\n\t}\n\n\tgetID() {\n\t\treturn this.id;\n\t}\n\n\tdoClone(lookupTable: { [s: string]: any } = {}, clone: any) {\n\t\t/*noop*/\n\t}\n\n\tclone(lookupTable: { [s: string]: any } = {}) {\n\t\t// try and use an existing clone first\n\t\tif (lookupTable[this.id]) {\n\t\t\treturn lookupTable[this.id];\n\t\t}\n\t\tlet clone = _.clone(this);\n\t\tclone.id = Toolkit.UID();\n\t\tclone.clearListeners();\n\t\tlookupTable[this.id] = clone;\n\n\t\tthis.doClone(lookupTable, clone);\n\t\treturn clone;\n\t}\n\n\tclearListeners() {\n\t\tthis.listeners = {};\n\t}\n\n\tpublic deSerialize(data: { [s: string]: any }, engine: DiagramEngine) {\n\t\tthis.id = data.id;\n\t}\n\n\tpublic serialize() {\n\t\treturn {\n\t\t\tid: this.id\n\t\t};\n\t}\n\n\tpublic iterateListeners(cb: (t: T, event: BaseEvent) => any) {\n\t\tlet event: BaseEvent = {\n\t\t\tid: Toolkit.UID(),\n\t\t\tfiring: true,\n\t\t\tentity: this,\n\t\t\tstopPropagation: () => {\n\t\t\t\tevent.firing = false;\n\t\t\t}\n\t\t};\n\n\t\tfor (var i in this.listeners) {\n\t\t\tif (this.listeners.hasOwnProperty(i)) {\n\t\t\t\t// propagation stopped\n\t\t\t\tif (!event.firing) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcb(this.listeners[i], event);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic removeListener(listener: string) {\n\t\tif (this.listeners[listener]) {\n\t\t\tdelete this.listeners[listener];\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tpublic addListener(listener: T): string {\n\t\tvar uid = Toolkit.UID();\n\t\tthis.listeners[uid] = listener;\n\t\treturn uid;\n\t}\n\n\tpublic isLocked(): boolean {\n\t\treturn this.locked;\n\t}\n\n\tpublic setLocked(locked: boolean = true) {\n\t\tthis.locked = locked;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.lockChanged) {\n\t\t\t\tlistener.lockChanged({ ...event, locked: locked });\n\t\t\t}\n\t\t});\n\t}\n}\n","import { BaseModel, BaseModelListener } from \"./BaseModel\";\nimport { NodeModel } from \"./NodeModel\";\nimport { LinkModel } from \"./LinkModel\";\nimport { DefaultLinkModel } from \"../defaults/models/DefaultLinkModel\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"../DiagramEngine\";\n\nexport class PortModel extends BaseModel<NodeModel, BaseModelListener> {\n\tname: string;\n\tlinks: { [id: string]: LinkModel };\n\tmaximumLinks: number;\n\n\t// calculated post rendering so routing can be done correctly\n\tx: number;\n\ty: number;\n\twidth: number;\n\theight: number;\n\n\tconstructor(name: string, type?: string, id?: string, maximumLinks?: number) {\n\t\tsuper(type, id);\n\t\tthis.name = name;\n\t\tthis.links = {};\n\t\tthis.maximumLinks = maximumLinks;\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.name = ob.name;\n\t\tthis.maximumLinks = ob.maximumLinks;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tname: this.name,\n\t\t\tparentNode: this.parent.id,\n\t\t\tlinks: _.map(this.links, link => {\n\t\t\t\treturn link.id;\n\t\t\t}),\n\t\t\tmaximumLinks: this.maximumLinks\n\t\t});\n\t}\n\n\tdoClone(lookupTable = {}, clone) {\n\t\tclone.links = {};\n\t\tclone.parentNode = this.getParent().clone(lookupTable);\n\t}\n\n\tgetNode(): NodeModel {\n\t\treturn this.getParent();\n\t}\n\n\tgetName(): string {\n\t\treturn this.name;\n\t}\n\n\tgetMaximumLinks(): number {\n\t\treturn this.maximumLinks;\n\t}\n\n\tsetMaximumLinks(maximumLinks: number) {\n\t\tthis.maximumLinks = maximumLinks;\n\t}\n\n\tremoveLink(link: LinkModel) {\n\t\tdelete this.links[link.getID()];\n\t}\n\n\taddLink(link: LinkModel) {\n\t\tthis.links[link.getID()] = link;\n\t}\n\n\tgetLinks(): { [id: string]: LinkModel } {\n\t\treturn this.links;\n\t}\n\n\tpublic createLinkModel(): LinkModel | null {\n\t\tif (_.isFinite(this.maximumLinks)) {\n\t\t\tvar numberOfLinks: number = _.size(this.links);\n\t\t\tif (numberOfLinks >= this.maximumLinks) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t};\n\t\treturn new DefaultLinkModel();\n\t}\n\n\tupdateCoords({ x, y, width, height }: { x: number; y: number; width: number; height: number }) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.width = width;\n\t\tthis.height = height;\n\t}\n\n\tcanLinkToPort(port: PortModel): boolean {\n\t\treturn true;\n\t}\n\n\tisLocked() {\n\t\treturn super.isLocked() || this.getParent().isLocked();\n\t}\n}\n","export class BaseAction {\n\tmouseX: number;\n\tmouseY: number;\n\tms: number;\n\n\tconstructor(mouseX: number, mouseY: number) {\n\t\tthis.mouseX = mouseX;\n\t\tthis.mouseY = mouseY;\n\t\tthis.ms = new Date().getTime();\n\t}\n}\n","/**\r\n * A node in grid. \r\n * This class holds some basic information about a node and custom \r\n * attributes may be added, depending on the algorithms' needs.\r\n * @constructor\r\n * @param {number} x - The x coordinate of the node on the grid.\r\n * @param {number} y - The y coordinate of the node on the grid.\r\n * @param {boolean} [walkable] - Whether this node is walkable.\r\n */\r\nfunction Node(x, y, walkable) {\r\n    /**\r\n     * The x coordinate of the node on the grid.\r\n     * @type number\r\n     */\r\n    this.x = x;\r\n    /**\r\n     * The y coordinate of the node on the grid.\r\n     * @type number\r\n     */\r\n    this.y = y;\r\n    /**\r\n     * Whether this node can be walked through.\r\n     * @type boolean\r\n     */\r\n    this.walkable = (walkable === undefined ? true : walkable);\r\n}\r\n\r\nmodule.exports = Node;\r\n","var Heap       = require('heap');\r\nvar Util       = require('../core/Util');\r\nvar Heuristic  = require('../core/Heuristic');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * A* path-finder. Based upon https://github.com/bgrins/javascript-astar\r\n * @constructor\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching \r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n * @param {number} opt.weight Weight to apply to the heuristic to allow for\r\n *     suboptimal paths, in order to speed up the search.\r\n */\r\nfunction AStarFinder(opt) {\r\n    opt = opt || {};\r\n    this.allowDiagonal = opt.allowDiagonal;\r\n    this.dontCrossCorners = opt.dontCrossCorners;\r\n    this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    this.weight = opt.weight || 1;\r\n    this.diagonalMovement = opt.diagonalMovement;\r\n\r\n    if (!this.diagonalMovement) {\r\n        if (!this.allowDiagonal) {\r\n            this.diagonalMovement = DiagonalMovement.Never;\r\n        } else {\r\n            if (this.dontCrossCorners) {\r\n                this.diagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;\r\n            } else {\r\n                this.diagonalMovement = DiagonalMovement.IfAtMostOneObstacle;\r\n            }\r\n        }\r\n    }\r\n\r\n    // When diagonal movement is allowed the manhattan heuristic is not\r\n    //admissible. It should be octile instead\r\n    if (this.diagonalMovement === DiagonalMovement.Never) {\r\n        this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    } else {\r\n        this.heuristic = opt.heuristic || Heuristic.octile;\r\n    }\r\n}\r\n\r\n/**\r\n * Find and return the the path.\r\n * @return {Array<Array<number>>} The path, including both start and\r\n *     end positions.\r\n */\r\nAStarFinder.prototype.findPath = function(startX, startY, endX, endY, grid) {\r\n    var openList = new Heap(function(nodeA, nodeB) {\r\n            return nodeA.f - nodeB.f;\r\n        }),\r\n        startNode = grid.getNodeAt(startX, startY),\r\n        endNode = grid.getNodeAt(endX, endY),\r\n        heuristic = this.heuristic,\r\n        diagonalMovement = this.diagonalMovement,\r\n        weight = this.weight,\r\n        abs = Math.abs, SQRT2 = Math.SQRT2,\r\n        node, neighbors, neighbor, i, l, x, y, ng;\r\n\r\n    // set the `g` and `f` value of the start node to be 0\r\n    startNode.g = 0;\r\n    startNode.f = 0;\r\n\r\n    // push the start node into the open list\r\n    openList.push(startNode);\r\n    startNode.opened = true;\r\n\r\n    // while the open list is not empty\r\n    while (!openList.empty()) {\r\n        // pop the position of node which has the minimum `f` value.\r\n        node = openList.pop();\r\n        node.closed = true;\r\n\r\n        // if reached the end position, construct the path and return it\r\n        if (node === endNode) {\r\n            return Util.backtrace(endNode);\r\n        }\r\n\r\n        // get neigbours of the current node\r\n        neighbors = grid.getNeighbors(node, diagonalMovement);\r\n        for (i = 0, l = neighbors.length; i < l; ++i) {\r\n            neighbor = neighbors[i];\r\n\r\n            if (neighbor.closed) {\r\n                continue;\r\n            }\r\n\r\n            x = neighbor.x;\r\n            y = neighbor.y;\r\n\r\n            // get the distance between current node and the neighbor\r\n            // and calculate the next g score\r\n            ng = node.g + ((x - node.x === 0 || y - node.y === 0) ? 1 : SQRT2);\r\n\r\n            // check if the neighbor has not been inspected yet, or\r\n            // can be reached with smaller cost from the current node\r\n            if (!neighbor.opened || ng < neighbor.g) {\r\n                neighbor.g = ng;\r\n                neighbor.h = neighbor.h || weight * heuristic(abs(x - endX), abs(y - endY));\r\n                neighbor.f = neighbor.g + neighbor.h;\r\n                neighbor.parent = node;\r\n\r\n                if (!neighbor.opened) {\r\n                    openList.push(neighbor);\r\n                    neighbor.opened = true;\r\n                } else {\r\n                    // the neighbor can be reached with smaller cost.\r\n                    // Since its f value has been updated, we have to\r\n                    // update its position in the open list\r\n                    openList.updateItem(neighbor);\r\n                }\r\n            }\r\n        } // end for each neighbor\r\n    } // end while not open list empty\r\n\r\n    // fail to find the path\r\n    return [];\r\n};\r\n\r\nmodule.exports = AStarFinder;\r\n","var Heap       = require('heap');\r\nvar Util       = require('../core/Util');\r\nvar Heuristic  = require('../core/Heuristic');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * A* path-finder.\r\n * based upon https://github.com/bgrins/javascript-astar\r\n * @constructor\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n * @param {number} opt.weight Weight to apply to the heuristic to allow for\r\n *     suboptimal paths, in order to speed up the search.\r\n */\r\nfunction BiAStarFinder(opt) {\r\n    opt = opt || {};\r\n    this.allowDiagonal = opt.allowDiagonal;\r\n    this.dontCrossCorners = opt.dontCrossCorners;\r\n    this.diagonalMovement = opt.diagonalMovement;\r\n    this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    this.weight = opt.weight || 1;\r\n\r\n    if (!this.diagonalMovement) {\r\n        if (!this.allowDiagonal) {\r\n            this.diagonalMovement = DiagonalMovement.Never;\r\n        } else {\r\n            if (this.dontCrossCorners) {\r\n                this.diagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;\r\n            } else {\r\n                this.diagonalMovement = DiagonalMovement.IfAtMostOneObstacle;\r\n            }\r\n        }\r\n    }\r\n\r\n    //When diagonal movement is allowed the manhattan heuristic is not admissible\r\n    //It should be octile instead\r\n    if (this.diagonalMovement === DiagonalMovement.Never) {\r\n        this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    } else {\r\n        this.heuristic = opt.heuristic || Heuristic.octile;\r\n    }\r\n}\r\n\r\n/**\r\n * Find and return the the path.\r\n * @return {Array<Array<number>>} The path, including both start and\r\n *     end positions.\r\n */\r\nBiAStarFinder.prototype.findPath = function(startX, startY, endX, endY, grid) {\r\n    var cmp = function(nodeA, nodeB) {\r\n            return nodeA.f - nodeB.f;\r\n        },\r\n        startOpenList = new Heap(cmp),\r\n        endOpenList = new Heap(cmp),\r\n        startNode = grid.getNodeAt(startX, startY),\r\n        endNode = grid.getNodeAt(endX, endY),\r\n        heuristic = this.heuristic,\r\n        diagonalMovement = this.diagonalMovement,\r\n        weight = this.weight,\r\n        abs = Math.abs, SQRT2 = Math.SQRT2,\r\n        node, neighbors, neighbor, i, l, x, y, ng,\r\n        BY_START = 1, BY_END = 2;\r\n\r\n    // set the `g` and `f` value of the start node to be 0\r\n    // and push it into the start open list\r\n    startNode.g = 0;\r\n    startNode.f = 0;\r\n    startOpenList.push(startNode);\r\n    startNode.opened = BY_START;\r\n\r\n    // set the `g` and `f` value of the end node to be 0\r\n    // and push it into the open open list\r\n    endNode.g = 0;\r\n    endNode.f = 0;\r\n    endOpenList.push(endNode);\r\n    endNode.opened = BY_END;\r\n\r\n    // while both the open lists are not empty\r\n    while (!startOpenList.empty() && !endOpenList.empty()) {\r\n\r\n        // pop the position of start node which has the minimum `f` value.\r\n        node = startOpenList.pop();\r\n        node.closed = true;\r\n\r\n        // get neigbours of the current node\r\n        neighbors = grid.getNeighbors(node, diagonalMovement);\r\n        for (i = 0, l = neighbors.length; i < l; ++i) {\r\n            neighbor = neighbors[i];\r\n\r\n            if (neighbor.closed) {\r\n                continue;\r\n            }\r\n            if (neighbor.opened === BY_END) {\r\n                return Util.biBacktrace(node, neighbor);\r\n            }\r\n\r\n            x = neighbor.x;\r\n            y = neighbor.y;\r\n\r\n            // get the distance between current node and the neighbor\r\n            // and calculate the next g score\r\n            ng = node.g + ((x - node.x === 0 || y - node.y === 0) ? 1 : SQRT2);\r\n\r\n            // check if the neighbor has not been inspected yet, or\r\n            // can be reached with smaller cost from the current node\r\n            if (!neighbor.opened || ng < neighbor.g) {\r\n                neighbor.g = ng;\r\n                neighbor.h = neighbor.h ||\r\n                    weight * heuristic(abs(x - endX), abs(y - endY));\r\n                neighbor.f = neighbor.g + neighbor.h;\r\n                neighbor.parent = node;\r\n\r\n                if (!neighbor.opened) {\r\n                    startOpenList.push(neighbor);\r\n                    neighbor.opened = BY_START;\r\n                } else {\r\n                    // the neighbor can be reached with smaller cost.\r\n                    // Since its f value has been updated, we have to\r\n                    // update its position in the open list\r\n                    startOpenList.updateItem(neighbor);\r\n                }\r\n            }\r\n        } // end for each neighbor\r\n\r\n\r\n        // pop the position of end node which has the minimum `f` value.\r\n        node = endOpenList.pop();\r\n        node.closed = true;\r\n\r\n        // get neigbours of the current node\r\n        neighbors = grid.getNeighbors(node, diagonalMovement);\r\n        for (i = 0, l = neighbors.length; i < l; ++i) {\r\n            neighbor = neighbors[i];\r\n\r\n            if (neighbor.closed) {\r\n                continue;\r\n            }\r\n            if (neighbor.opened === BY_START) {\r\n                return Util.biBacktrace(neighbor, node);\r\n            }\r\n\r\n            x = neighbor.x;\r\n            y = neighbor.y;\r\n\r\n            // get the distance between current node and the neighbor\r\n            // and calculate the next g score\r\n            ng = node.g + ((x - node.x === 0 || y - node.y === 0) ? 1 : SQRT2);\r\n\r\n            // check if the neighbor has not been inspected yet, or\r\n            // can be reached with smaller cost from the current node\r\n            if (!neighbor.opened || ng < neighbor.g) {\r\n                neighbor.g = ng;\r\n                neighbor.h = neighbor.h ||\r\n                    weight * heuristic(abs(x - startX), abs(y - startY));\r\n                neighbor.f = neighbor.g + neighbor.h;\r\n                neighbor.parent = node;\r\n\r\n                if (!neighbor.opened) {\r\n                    endOpenList.push(neighbor);\r\n                    neighbor.opened = BY_END;\r\n                } else {\r\n                    // the neighbor can be reached with smaller cost.\r\n                    // Since its f value has been updated, we have to\r\n                    // update its position in the open list\r\n                    endOpenList.updateItem(neighbor);\r\n                }\r\n            }\r\n        } // end for each neighbor\r\n    } // end while not open list empty\r\n\r\n    // fail to find the path\r\n    return [];\r\n};\r\n\r\nmodule.exports = BiAStarFinder;\r\n","import { BaseModel, BaseModelListener } from \"./BaseModel\";\nimport { PortModel } from \"./PortModel\";\nimport { PointModel } from \"./PointModel\";\nimport * as _ from \"lodash\";\nimport { BaseEvent } from \"../BaseEntity\";\nimport { LabelModel } from \"./LabelModel\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { DiagramModel } from \"./DiagramModel\";\n\nexport interface LinkModelListener extends BaseModelListener {\n\tsourcePortChanged?(event: BaseEvent<LinkModel> & { port: null | PortModel }): void;\n\n\ttargetPortChanged?(event: BaseEvent<LinkModel> & { port: null | PortModel }): void;\n}\n\nexport class LinkModel<T extends LinkModelListener = LinkModelListener> extends BaseModel<DiagramModel, T> {\n\tsourcePort: PortModel | null;\n\ttargetPort: PortModel | null;\n\tlabels: LabelModel[];\n\tpoints: PointModel[];\n\textras: {};\n\n\tconstructor(linkType: string = \"default\", id?: string) {\n\t\tsuper(linkType, id);\n\t\tthis.points = [new PointModel(this, { x: 0, y: 0 }), new PointModel(this, { x: 0, y: 0 })];\n\t\tthis.extras = {};\n\t\tthis.sourcePort = null;\n\t\tthis.targetPort = null;\n\t\tthis.labels = [];\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.extras = ob.extras;\n\t\tthis.points = _.map(ob.points || [], (point: { x; y }) => {\n\t\t\tvar p = new PointModel(this, { x: point.x, y: point.y });\n\t\t\tp.deSerialize(point, engine);\n\t\t\treturn p;\n\t\t});\n\n\t\t//deserialize labels\n\t\t_.forEach(ob.labels || [], (label: any) => {\n\t\t\tlet labelOb = engine.getLabelFactory(label.type).getNewInstance();\n\t\t\tlabelOb.deSerialize(label, engine);\n\t\t\tthis.addLabel(labelOb);\n\t\t});\n\n\t\tif (ob.target) {\n\t\t\tthis.setTargetPort(\n\t\t\t\tthis.getParent()\n\t\t\t\t\t.getNode(ob.target)\n\t\t\t\t\t.getPortFromID(ob.targetPort)\n\t\t\t);\n\t\t}\n\n\t\tif (ob.source) {\n\t\t\tthis.setSourcePort(\n\t\t\t\tthis.getParent()\n\t\t\t\t\t.getNode(ob.source)\n\t\t\t\t\t.getPortFromID(ob.sourcePort)\n\t\t\t);\n\t\t}\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tsource: this.sourcePort ? this.sourcePort.getParent().id : null,\n\t\t\tsourcePort: this.sourcePort ? this.sourcePort.id : null,\n\t\t\ttarget: this.targetPort ? this.targetPort.getParent().id : null,\n\t\t\ttargetPort: this.targetPort ? this.targetPort.id : null,\n\t\t\tpoints: _.map(this.points, point => {\n\t\t\t\treturn point.serialize();\n\t\t\t}),\n\t\t\textras: this.extras,\n\t\t\tlabels: _.map(this.labels, label => {\n\t\t\t\treturn label.serialize();\n\t\t\t})\n\t\t});\n\t}\n\n\tdoClone(lookupTable = {}, clone) {\n\t\tclone.setPoints(\n\t\t\t_.map(this.getPoints(), (point: PointModel) => {\n\t\t\t\treturn point.clone(lookupTable);\n\t\t\t})\n\t\t);\n\t\tif (this.sourcePort) {\n\t\t\tclone.setSourcePort(this.sourcePort.clone(lookupTable));\n\t\t}\n\t\tif (this.targetPort) {\n\t\t\tclone.setTargetPort(this.targetPort.clone(lookupTable));\n\t\t}\n\t}\n\n\tremove() {\n\t\tif (this.sourcePort) {\n\t\t\tthis.sourcePort.removeLink(this);\n\t\t}\n\t\tif (this.targetPort) {\n\t\t\tthis.targetPort.removeLink(this);\n\t\t}\n\t\tsuper.remove();\n\t}\n\n\tisLastPoint(point: PointModel) {\n\t\tvar index = this.getPointIndex(point);\n\t\treturn index === this.points.length - 1;\n\t}\n\n\tgetPointIndex(point: PointModel) {\n\t\treturn this.points.indexOf(point);\n\t}\n\n\tgetPointModel(id: string): PointModel | null {\n\t\tfor (var i = 0; i < this.points.length; i++) {\n\t\t\tif (this.points[i].id === id) {\n\t\t\t\treturn this.points[i];\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetPortForPoint(point: PointModel): PortModel {\n\t\tif (this.sourcePort !== null && this.getFirstPoint().getID() === point.getID()) {\n\t\t\treturn this.sourcePort;\n\t\t}\n\t\tif (this.targetPort !== null && this.getLastPoint().getID() === point.getID()) {\n\t\t\treturn this.targetPort;\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetPointForPort(port: PortModel): PointModel {\n\t\tif (this.sourcePort !== null && this.sourcePort.getID() === port.getID()) {\n\t\t\treturn this.getFirstPoint();\n\t\t}\n\t\tif (this.targetPort !== null && this.targetPort.getID() === port.getID()) {\n\t\t\treturn this.getLastPoint();\n\t\t}\n\t\treturn null;\n\t}\n\n\tgetFirstPoint(): PointModel {\n\t\treturn this.points[0];\n\t}\n\n\tgetLastPoint(): PointModel {\n\t\treturn this.points[this.points.length - 1];\n\t}\n\n\tsetSourcePort(port: PortModel) {\n\t\tif (port !== null) {\n\t\t\tport.addLink(this);\n\t\t}\n\t\tif (this.sourcePort !== null) {\n\t\t\tthis.sourcePort.removeLink(this);\n\t\t}\n\t\tthis.sourcePort = port;\n\t\tthis.iterateListeners((listener: LinkModelListener, event) => {\n\t\t\tif (listener.sourcePortChanged) {\n\t\t\t\tlistener.sourcePortChanged({ ...event, port: port });\n\t\t\t}\n\t\t});\n\t}\n\n\tgetSourcePort(): PortModel {\n\t\treturn this.sourcePort;\n\t}\n\n\tgetTargetPort(): PortModel {\n\t\treturn this.targetPort;\n\t}\n\n\tsetTargetPort(port: PortModel) {\n\t\tif (port !== null) {\n\t\t\tport.addLink(this);\n\t\t}\n\t\tif (this.targetPort !== null) {\n\t\t\tthis.targetPort.removeLink(this);\n\t\t}\n\t\tthis.targetPort = port;\n\t\tthis.iterateListeners((listener: LinkModelListener, event) => {\n\t\t\tif (listener.targetPortChanged) {\n\t\t\t\tlistener.targetPortChanged({ ...event, port: port });\n\t\t\t}\n\t\t});\n\t}\n\n\tpoint(x: number, y: number): PointModel {\n\t\treturn this.addPoint(this.generatePoint(x, y));\n\t}\n\n\taddLabel(label: LabelModel) {\n\t\tlabel.setParent(this);\n\t\tthis.labels.push(label);\n\t}\n\n\tgetPoints(): PointModel[] {\n\t\treturn this.points;\n\t}\n\n\tsetPoints(points: PointModel[]) {\n\t\t_.forEach(points, point => {\n\t\t\tpoint.setParent(this);\n\t\t});\n\t\tthis.points = points;\n\t}\n\n\tremovePoint(pointModel: PointModel) {\n\t\tthis.points.splice(this.getPointIndex(pointModel), 1);\n\t}\n\n\tremovePointsBefore(pointModel: PointModel) {\n\t\tthis.points.splice(0, this.getPointIndex(pointModel));\n\t}\n\n\tremovePointsAfter(pointModel: PointModel) {\n\t\tthis.points.splice(this.getPointIndex(pointModel) + 1);\n\t}\n\n\tremoveMiddlePoints() {\n\t\tif (this.points.length > 2) {\n\t\t\tthis.points.splice(0, this.points.length - 2);\n\t\t}\n\t}\n\n\taddPoint<P extends PointModel>(pointModel: P, index = 1): P {\n\t\tpointModel.setParent(this);\n\t\tthis.points.splice(index, 0, pointModel);\n\t\treturn pointModel;\n\t}\n\n\tgeneratePoint(x: number = 0, y: number = 0): PointModel {\n\t\treturn new PointModel(this, { x: x, y: y });\n\t}\n}\n","/**\n * @author Dylan Vorster\n */\nimport { LinkModel, LinkModelListener } from \"../../models/LinkModel\";\nimport { BaseEvent } from \"../../BaseEntity\";\nimport * as _ from \"lodash\";\nimport { PointModel } from \"../../models/PointModel\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { DefaultLabelModel } from \"./DefaultLabelModel\";\nimport { LabelModel } from \"../../models/LabelModel\";\n\nexport interface DefaultLinkModelListener extends LinkModelListener {\n\tcolorChanged?(event: BaseEvent<DefaultLinkModel> & { color: null | string }): void;\n\n\twidthChanged?(event: BaseEvent<DefaultLinkModel> & { width: 0 | number }): void;\n}\n\nexport class DefaultLinkModel extends LinkModel<DefaultLinkModelListener> {\n\twidth: number;\n\tcolor: string;\n\tcurvyness: number;\n\n\tconstructor(type: string = \"default\") {\n\t\tsuper(type);\n\t\tthis.color = \"rgba(255,255,255,0.5)\";\n\t\tthis.width = 3;\n\t\tthis.curvyness = 50;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\twidth: this.width,\n\t\t\tcolor: this.color,\n\t\t\tcurvyness: this.curvyness\n\t\t});\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.color = ob.color;\n\t\tthis.width = ob.width;\n\t\tthis.curvyness = ob.curvyness;\n\t}\n\n\taddLabel(label: LabelModel | string) {\n\t\tif (label instanceof LabelModel) {\n\t\t\treturn super.addLabel(label);\n\t\t}\n\t\tlet labelOb = new DefaultLabelModel();\n\t\tlabelOb.setLabel(label);\n\t\treturn super.addLabel(labelOb);\n\t}\n\n\tsetWidth(width: number) {\n\t\tthis.width = width;\n\t\tthis.iterateListeners((listener: DefaultLinkModelListener, event: BaseEvent) => {\n\t\t\tif (listener.widthChanged) {\n\t\t\t\tlistener.widthChanged({ ...event, width: width });\n\t\t\t}\n\t\t});\n\t}\n\n\tsetColor(color: string) {\n\t\tthis.color = color;\n\t\tthis.iterateListeners((listener: DefaultLinkModelListener, event: BaseEvent) => {\n\t\t\tif (listener.colorChanged) {\n\t\t\t\tlistener.colorChanged({ ...event, color: color });\n\t\t\t}\n\t\t});\n\t}\n}\n","import { LabelModel } from \"../../models/LabelModel\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\n\nexport class DefaultLabelModel extends LabelModel {\n\tlabel: string;\n\n\tconstructor() {\n\t\tsuper(\"default\");\n\t\tthis.offsetY = -23;\n\t}\n\n\tsetLabel(label: string) {\n\t\tthis.label = label;\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.label = ob.label;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tlabel: this.label\n\t\t});\n\t}\n}\n","import { BaseModel } from \"./BaseModel\";\nimport { LinkModel } from \"./LinkModel\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"../DiagramEngine\";\n\nexport class LabelModel extends BaseModel<LinkModel> {\n\toffsetX: number;\n\toffsetY: number;\n\n\tconstructor(type?: string, id?: string) {\n\t\tsuper(type, id);\n\t\tthis.offsetX = 0;\n\t\tthis.offsetY = 0;\n\t}\n\n\tdeSerialize(ob, engine: DiagramEngine) {\n\t\tsuper.deSerialize(ob, engine);\n\t\tthis.offsetX = ob.offsetX;\n\t\tthis.offsetY = ob.offsetY;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\toffsetX: this.offsetX,\n\t\t\toffsetY: this.offsetY\n\t\t});\n\t}\n}\n","import * as _ from \"lodash\";\nimport { PortModel } from \"../../models/PortModel\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { DefaultLinkModel } from \"./DefaultLinkModel\";\nimport { LinkModel } from \"../../models/LinkModel\";\n\nexport class DefaultPortModel extends PortModel {\n\tin: boolean;\n\tlabel: string;\n\tlinks: { [id: string]: DefaultLinkModel };\n\n\tconstructor(isInput: boolean, name: string, label: string = null, id?: string) {\n\t\tsuper(name, \"default\", id);\n\t\tthis.in = isInput;\n\t\tthis.label = label || name;\n\t}\n\n\tdeSerialize(object, engine: DiagramEngine) {\n\t\tsuper.deSerialize(object, engine);\n\t\tthis.in = object.in;\n\t\tthis.label = object.label;\n\t}\n\n\tserialize() {\n\t\treturn _.merge(super.serialize(), {\n\t\t\tin: this.in,\n\t\t\tlabel: this.label\n\t\t});\n\t}\n\n\tlink(port: PortModel): LinkModel | null {\n\t\tlet link = this.createLinkModel();\n\t\tif (!link) { return link; }\n\t\tlink.setSourcePort(this);\n\t\tlink.setTargetPort(port);\n\t\treturn link;\n\t}\n\n\tcanLinkToPort(port: PortModel): boolean {\n\t\tif (port instanceof DefaultPortModel) {\n\t\t\treturn this.in !== port.in;\n\t\t}\n\t\treturn true;\n\t}\n\n\tcreateLinkModel(): LinkModel | null {\n\t\treturn super.createLinkModel();\n\t}\n}\n","/**\n * @author Dylan Vorster\n */\n\nexport * from \"./Toolkit\";\nexport * from \"./BaseEntity\";\nexport * from \"./DiagramEngine\";\n\nexport * from \"./defaults/models/DefaultNodeModel\";\nexport * from \"./defaults/models/DefaultPortModel\";\nexport * from \"./defaults/models/DefaultLinkModel\";\nexport * from \"./defaults/models/DefaultLabelModel\";\n\nexport * from \"./defaults/factories/DefaultLinkFactory\";\nexport * from \"./defaults/factories/DefaultNodeFactory\";\nexport * from \"./defaults/factories/DefaultPortFactory\";\nexport * from \"./defaults/factories/DefaultLabelFactory\";\n\nexport * from \"./defaults/widgets/DefaultLinkWidget\";\nexport * from \"./defaults/widgets/DefaultLabelWidget\";\nexport * from \"./defaults/widgets/DefaultNodeWidget\";\nexport * from \"./defaults/widgets/DefaultPortLabelWidget\";\n\nexport * from \"./factories/AbstractFactory\";\nexport * from \"./factories/AbstractLabelFactory\";\nexport * from \"./factories/AbstractLinkFactory\";\nexport * from \"./factories/AbstractNodeFactory\";\nexport * from \"./factories/AbstractPortFactory\";\n\nexport * from \"./routing/PathFinding\";\n\nexport * from \"./actions/BaseAction\";\nexport * from \"./actions/MoveCanvasAction\";\nexport * from \"./actions/MoveItemsAction\";\nexport * from \"./actions/SelectingAction\";\n\nexport * from \"./models/SelectionModel\";\nexport * from \"./models/BaseModel\";\nexport * from \"./models/DiagramModel\";\nexport * from \"./models/LinkModel\";\nexport * from \"./models/NodeModel\";\nexport * from \"./models/PointModel\";\nexport * from \"./models/PortModel\";\nexport * from \"./models/LabelModel\";\n\nexport * from \"./widgets/DiagramWidget\";\nexport * from \"./widgets/LinkWidget\";\nexport * from \"./widgets/NodeWidget\";\nexport * from \"./widgets/PortWidget\";\nexport * from \"./widgets/BaseWidget\";\n\nexport * from \"./widgets/layers/LinkLayerWidget\";\nexport * from \"./widgets/layers/NodeLayerWidget\";\n","import { BaseListener, BaseEntity, BaseEvent, BaseEntityType } from \"../BaseEntity\";\nimport * as _ from \"lodash\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { LinkModel } from \"./LinkModel\";\nimport { NodeModel } from \"./NodeModel\";\nimport { PortModel } from \"./PortModel\";\nimport { BaseModel, BaseModelListener } from \"./BaseModel\";\nimport { PointModel } from \"./PointModel\";\n/**\n * @author Dylan Vorster\n *\n */\nexport interface DiagramListener extends BaseListener {\n\tnodesUpdated?(event: BaseEvent & { node: NodeModel; isCreated: boolean }): void;\n\n\tlinksUpdated?(event: BaseEvent & { link: LinkModel; isCreated: boolean }): void;\n\n\toffsetUpdated?(event: BaseEvent<DiagramModel> & { offsetX: number; offsetY: number }): void;\n\n\tzoomUpdated?(event: BaseEvent<DiagramModel> & { zoom: number }): void;\n\n\tgridUpdated?(event: BaseEvent<DiagramModel> & { size: number }): void;\n}\n\n/**\n *\n */\nexport class DiagramModel extends BaseEntity<DiagramListener> {\n\t//models\n\tlinks: { [s: string]: LinkModel };\n\tnodes: { [s: string]: NodeModel };\n\n\t//control variables\n\toffsetX: number;\n\toffsetY: number;\n\tzoom: number;\n\trendered: boolean;\n\tgridSize: number;\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.links = {};\n\t\tthis.nodes = {};\n\n\t\tthis.offsetX = 0;\n\t\tthis.offsetY = 0;\n\t\tthis.zoom = 100;\n\t\tthis.rendered = false;\n\t\tthis.gridSize = 0;\n\t}\n\n\tsetGridSize(size: number = 0) {\n\t\tthis.gridSize = size;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.gridUpdated) {\n\t\t\t\tlistener.gridUpdated({ ...event, size: size });\n\t\t\t}\n\t\t});\n\t}\n\n\tgetGridPosition(pos) {\n\t\tif (this.gridSize === 0) {\n\t\t\treturn pos;\n\t\t}\n\t\treturn this.gridSize * Math.floor((pos + this.gridSize / 2) / this.gridSize);\n\t}\n\n\tdeSerializeDiagram(object: any, diagramEngine: DiagramEngine) {\n\t\tthis.deSerialize(object, diagramEngine);\n\n\t\tthis.offsetX = object.offsetX;\n\t\tthis.offsetY = object.offsetY;\n\t\tthis.zoom = object.zoom;\n\t\tthis.gridSize = object.gridSize;\n\n\t\t// deserialize nodes\n\t\t_.forEach(object.nodes, (node: any) => {\n\t\t\tlet nodeOb = diagramEngine.getNodeFactory(node.type).getNewInstance(node);\n\t\t\tnodeOb.setParent(this);\n\t\t\tnodeOb.deSerialize(node, diagramEngine);\n\t\t\tthis.addNode(nodeOb);\n\t\t});\n\n\t\t// deserialze links\n\t\t_.forEach(object.links, (link: any) => {\n\t\t\tlet linkOb = diagramEngine.getLinkFactory(link.type).getNewInstance();\n\t\t\tlinkOb.setParent(this);\n\t\t\tlinkOb.deSerialize(link, diagramEngine);\n\t\t\tthis.addLink(linkOb);\n\t\t});\n\t}\n\n\tserializeDiagram() {\n\t\treturn _.merge(this.serialize(), {\n\t\t\toffsetX: this.offsetX,\n\t\t\toffsetY: this.offsetY,\n\t\t\tzoom: this.zoom,\n\t\t\tgridSize: this.gridSize,\n\t\t\tlinks: _.map(this.links, link => {\n\t\t\t\treturn link.serialize();\n\t\t\t}),\n\t\t\tnodes: _.map(this.nodes, node => {\n\t\t\t\treturn node.serialize();\n\t\t\t})\n\t\t});\n\t}\n\n\tclearSelection(ignore: BaseModel<BaseEntity, BaseModelListener> | null = null) {\n\t\t_.forEach(this.getSelectedItems(), element => {\n\t\t\tif (ignore && ignore.getID() === element.getID()) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telement.setSelected(false); //TODO dont fire the listener\n\t\t});\n\t}\n\n\tgetSelectedItems(...filters: BaseEntityType[]): BaseModel<BaseEntity, BaseModelListener>[] {\n\t\tif (!Array.isArray(filters)) {\n\t\t\tfilters = [filters];\n\t\t}\n\t\tvar items = [];\n\n\t\t// run through nodes\n\t\titems = items.concat(\n\t\t\t_.flatMap(this.nodes, node => {\n\t\t\t\treturn node.getSelectedEntities();\n\t\t\t})\n\t\t);\n\n\t\t// find all the links\n\t\titems = items.concat(\n\t\t\t_.flatMap(this.links, link => {\n\t\t\t\treturn link.getSelectedEntities();\n\t\t\t})\n\t\t);\n\n\t\t//find all points\n\t\titems = items.concat(\n\t\t\t_.flatMap(this.links, link => {\n\t\t\t\treturn _.flatMap(link.points, point => {\n\t\t\t\t\treturn point.getSelectedEntities();\n\t\t\t\t});\n\t\t\t})\n\t\t);\n\n\t\titems = _.uniq(items);\n\n\t\tif (filters.length > 0) {\n\t\t\titems = _.filter(_.uniq(items), (item: BaseModel<any>) => {\n\t\t\t\tif (_.includes(filters, \"node\") && item instanceof NodeModel) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (_.includes(filters, \"link\") && item instanceof LinkModel) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (_.includes(filters, \"port\") && item instanceof PortModel) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tif (_.includes(filters, \"point\") && item instanceof PointModel) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t});\n\t\t}\n\n\t\treturn items;\n\t}\n\n\tsetZoomLevel(zoom: number) {\n\t\tthis.zoom = zoom;\n\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.zoomUpdated) {\n\t\t\t\tlistener.zoomUpdated({ ...event, zoom: zoom });\n\t\t\t}\n\t\t});\n\t}\n\n\tsetOffset(offsetX: number, offsetY: number) {\n\t\tthis.offsetX = offsetX;\n\t\tthis.offsetY = offsetY;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.offsetUpdated) {\n\t\t\t\tlistener.offsetUpdated({ ...event, offsetX: offsetX, offsetY: offsetY });\n\t\t\t}\n\t\t});\n\t}\n\n\tsetOffsetX(offsetX: number) {\n\t\tthis.offsetX = offsetX;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.offsetUpdated) {\n\t\t\t\tlistener.offsetUpdated({ ...event, offsetX: offsetX, offsetY: this.offsetY });\n\t\t\t}\n\t\t});\n\t}\n\tsetOffsetY(offsetY: number) {\n\t\tthis.offsetY = offsetY;\n\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.offsetUpdated) {\n\t\t\t\tlistener.offsetUpdated({ ...event, offsetX: this.offsetX, offsetY: this.offsetY });\n\t\t\t}\n\t\t});\n\t}\n\n\tgetOffsetY() {\n\t\treturn this.offsetY;\n\t}\n\n\tgetOffsetX() {\n\t\treturn this.offsetX;\n\t}\n\n\tgetZoomLevel() {\n\t\treturn this.zoom;\n\t}\n\n\tgetNode(node: string | NodeModel): NodeModel | null {\n\t\tif (node instanceof NodeModel) {\n\t\t\treturn node;\n\t\t}\n\t\tif (!this.nodes[node]) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.nodes[node];\n\t}\n\n\tgetLink(link: string | LinkModel): LinkModel | null {\n\t\tif (link instanceof LinkModel) {\n\t\t\treturn link;\n\t\t}\n\t\tif (!this.links[link]) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this.links[link];\n\t}\n\n\taddAll(...models: BaseModel[]): BaseModel[] {\n\t\t_.forEach(models, model => {\n\t\t\tif (model instanceof LinkModel) {\n\t\t\t\tthis.addLink(model);\n\t\t\t} else if (model instanceof NodeModel) {\n\t\t\t\tthis.addNode(model);\n\t\t\t}\n\t\t});\n\t\treturn models;\n\t}\n\n\taddLink(link: LinkModel): LinkModel {\n\t\tlink.addListener({\n\t\t\tentityRemoved: () => {\n\t\t\t\tthis.removeLink(link);\n\t\t\t}\n\t\t});\n\t\tthis.links[link.getID()] = link;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.linksUpdated) {\n\t\t\t\tlistener.linksUpdated({ ...event, link: link, isCreated: true });\n\t\t\t}\n\t\t});\n\t\treturn link;\n\t}\n\n\taddNode(node: NodeModel): NodeModel {\n\t\tnode.addListener({\n\t\t\tentityRemoved: () => {\n\t\t\t\tthis.removeNode(node);\n\t\t\t}\n\t\t});\n\t\tthis.nodes[node.getID()] = node;\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.nodesUpdated) {\n\t\t\t\tlistener.nodesUpdated({ ...event, node: node, isCreated: true });\n\t\t\t}\n\t\t});\n\t\treturn node;\n\t}\n\n\tremoveLink(link: LinkModel | string) {\n\t\tlink = this.getLink(link);\n\t\tdelete this.links[link.getID()];\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.linksUpdated) {\n\t\t\t\tlistener.linksUpdated({ ...event, link: link as LinkModel, isCreated: false });\n\t\t\t}\n\t\t});\n\t}\n\n\tremoveNode(node: NodeModel | string) {\n\t\tnode = this.getNode(node);\n\t\tdelete this.nodes[node.getID()];\n\t\tthis.iterateListeners((listener, event) => {\n\t\t\tif (listener.nodesUpdated) {\n\t\t\t\tlistener.nodesUpdated({ ...event, node: node as NodeModel, isCreated: false });\n\t\t\t}\n\t\t});\n\t}\n\n\tgetLinks(): { [s: string]: LinkModel } {\n\t\treturn this.links;\n\t}\n\n\tgetNodes(): { [s: string]: NodeModel } {\n\t\treturn this.nodes;\n\t}\n}\n","import { DefaultPortModel } from \"../models/DefaultPortModel\";\nimport { AbstractPortFactory } from \"../../factories/AbstractPortFactory\";\n\nexport class DefaultPortFactory extends AbstractPortFactory<DefaultPortModel> {\n\tconstructor() {\n\t\tsuper(\"default\");\n\t}\n\n\tgetNewInstance(initialConfig?: any): DefaultPortModel {\n\t\treturn new DefaultPortModel(true, \"unknown\");\n\t}\n}\n","import { PortModel } from \"../models/PortModel\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { AbstractFactory } from \"./AbstractFactory\";\n\nexport abstract class AbstractPortFactory<T extends PortModel = PortModel> extends AbstractFactory<T> {}\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { AbstractLabelFactory } from \"../../factories/AbstractLabelFactory\";\nimport { DefaultLabelModel } from \"../models/DefaultLabelModel\";\nimport { DefaultLabelWidget } from \"../widgets/DefaultLabelWidget\";\n\n/**\n * @author Dylan Vorster\n */\nexport class DefaultLabelFactory extends AbstractLabelFactory<DefaultLabelModel> {\n\tconstructor() {\n\t\tsuper(\"default\");\n\t}\n\n\tgenerateReactWidget(diagramEngine: DiagramEngine, label: DefaultLabelModel): JSX.Element {\n\t\treturn <DefaultLabelWidget model={label} />;\n\t}\n\n\tgetNewInstance(initialConfig?: any): DefaultLabelModel {\n\t\treturn new DefaultLabelModel();\n\t}\n}\n","import { LabelModel } from \"../models/LabelModel\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { AbstractFactory } from \"./AbstractFactory\";\n\nexport abstract class AbstractLabelFactory<T extends LabelModel = LabelModel> extends AbstractFactory<T> {\n\tabstract generateReactWidget(diagramEngine: DiagramEngine, link: T): JSX.Element;\n}\n","import * as React from \"react\";\nimport { DefaultLabelModel } from \"../models/DefaultLabelModel\";\nimport { BaseWidget, BaseWidgetProps } from \"../../widgets/BaseWidget\";\n\nexport interface DefaultLabelWidgetProps extends BaseWidgetProps {\n\tmodel: DefaultLabelModel;\n}\n\nexport class DefaultLabelWidget extends BaseWidget<DefaultLabelWidgetProps> {\n\tconstructor(props) {\n\t\tsuper(\"srd-default-label\", props);\n\t}\n\n\trender() {\n\t\treturn <div {...this.getProps()}>{this.props.model.label}</div>;\n\t}\n}\n","import { DefaultPortModel } from \"./DefaultPortModel\";\r\nimport * as _ from \"lodash\";\r\n\r\nimport { NodeModel } from \"../../models/NodeModel\";\r\nimport { Toolkit } from \"../../Toolkit\";\r\nimport { DiagramEngine } from \"../../DiagramEngine\";\r\n\r\n/**\r\n * @author Dylan Vorster\r\n */\r\nexport class DefaultNodeModel extends NodeModel {\r\n\tname: string;\r\n\tcolor: string;\r\n\tdata: object;\r\n\tports: { [s: string]: DefaultPortModel };\r\n\r\n\tconstructor(\r\n\t\tname: string = \"Untitled\",\r\n\t\tcolor: string = \"rgb(0,192,255)\",\r\n\t\tdata?: object\r\n\t) {\r\n\t\tsuper(\"default\");\r\n\t\tthis.name = name;\r\n\t\tthis.color = color;\r\n\t\tthis.data = data;\r\n\t}\r\n\r\n\taddInPort(label: string): DefaultPortModel {\r\n\t\treturn this.addPort(new DefaultPortModel(true, Toolkit.UID(), label));\r\n\t}\r\n\r\n\taddOutPort(label: string): DefaultPortModel {\r\n\t\treturn this.addPort(new DefaultPortModel(false, Toolkit.UID(), label));\r\n\t}\r\n\r\n\tdeSerialize(object, engine: DiagramEngine) {\r\n\t\tsuper.deSerialize(object, engine);\r\n\t\tthis.name = object.name;\r\n\t\tthis.color = object.color;\r\n\t\tthis.data = object.data;\r\n\t}\r\n\r\n\tserialize() {\r\n\t\treturn _.merge(super.serialize(), {\r\n\t\t\tname: this.name,\r\n\t\t\tcolor: this.color,\r\n\t\t\tdata: this.data,\r\n\t\t});\r\n\t}\r\n\r\n\tgetInPorts(): DefaultPortModel[] {\r\n\t\treturn _.filter(this.ports, portModel => {\r\n\t\t\treturn portModel.in;\r\n\t\t});\r\n\t}\r\n\r\n\tgetOutPorts(): DefaultPortModel[] {\r\n\t\treturn _.filter(this.ports, portModel => {\r\n\t\t\treturn !portModel.in;\r\n\t\t});\r\n\t}\r\n}\r\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { PointModel } from \"../../models/PointModel\";\nimport { Toolkit } from \"../../Toolkit\";\nimport { DefaultLinkFactory } from \"../factories/DefaultLinkFactory\";\nimport { DefaultLinkModel } from \"../models/DefaultLinkModel\";\nimport PathFinding from \"../../routing/PathFinding\";\nimport * as _ from \"lodash\";\nimport { LabelModel } from \"../../models/LabelModel\";\nimport { BaseWidget, BaseWidgetProps } from \"../../widgets/BaseWidget\";\n\nexport interface DefaultLinkProps extends BaseWidgetProps {\n\tcolor?: string;\n\twidth?: number;\n\tsmooth?: boolean;\n\tlink: DefaultLinkModel;\n\tdiagramEngine: DiagramEngine;\n\tpointAdded?: (point: PointModel, event: MouseEvent) => any;\n}\n\nexport interface DefaultLinkState {\n\tselected: boolean;\n}\n\nexport class DefaultLinkWidget extends BaseWidget<DefaultLinkProps, DefaultLinkState> {\n\tpublic static defaultProps: DefaultLinkProps = {\n\t\tcolor: \"black\",\n\t\twidth: 3,\n\t\tlink: null,\n\t\tengine: null,\n\t\tsmooth: false,\n\t\tdiagramEngine: null\n\t};\n\n\t// DOM references to the label and paths (if label is given), used to calculate dynamic positioning\n\trefLabels: { [id: string]: HTMLElement };\n\trefPaths: SVGPathElement[];\n\n\tpathFinding: PathFinding; // only set when smart routing is active\n\n\tconstructor(props: DefaultLinkProps) {\n\t\tsuper(\"srd-default-link\", props);\n\n\t\tthis.refLabels = {};\n\t\tthis.refPaths = [];\n\t\tthis.state = {\n\t\t\tselected: false\n\t\t};\n\n\t\tif (props.diagramEngine.isSmartRoutingEnabled()) {\n\t\t\tthis.pathFinding = new PathFinding(this.props.diagramEngine);\n\t\t}\n\t}\n\n\tcalculateAllLabelPosition() {\n\t\t_.forEach(this.props.link.labels, (label, index) => {\n\t\t\tthis.calculateLabelPosition(label, index + 1);\n\t\t});\n\t}\n\n\tcomponentDidUpdate() {\n\t\tif (this.props.link.labels.length > 0) {\n\t\t\twindow.requestAnimationFrame(this.calculateAllLabelPosition.bind(this));\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tif (this.props.link.labels.length > 0) {\n\t\t\twindow.requestAnimationFrame(this.calculateAllLabelPosition.bind(this));\n\t\t}\n\t}\n\n\taddPointToLink = (event: MouseEvent, index: number): void => {\n\t\tif (\n\t\t\t!event.shiftKey &&\n\t\t\t!this.props.diagramEngine.isModelLocked(this.props.link) &&\n\t\t\tthis.props.link.points.length - 1 <= this.props.diagramEngine.getMaxNumberPointsPerLink()\n\t\t) {\n\t\t\tconst point = new PointModel(this.props.link, this.props.diagramEngine.getRelativeMousePoint(event));\n\t\t\tpoint.setSelected(true);\n\t\t\tthis.forceUpdate();\n\t\t\tthis.props.link.addPoint(point, index);\n\t\t\tthis.props.pointAdded(point, event);\n\t\t}\n\t};\n\n\tgeneratePoint(pointIndex: number): JSX.Element {\n\t\tlet x = this.props.link.points[pointIndex].x;\n\t\tlet y = this.props.link.points[pointIndex].y;\n\n\t\treturn (\n\t\t\t<g key={\"point-\" + this.props.link.points[pointIndex].id}>\n\t\t\t\t<circle\n\t\t\t\t\tcx={x}\n\t\t\t\t\tcy={y}\n\t\t\t\t\tr={5}\n\t\t\t\t\tclassName={\n\t\t\t\t\t\t\"point \" +\n\t\t\t\t\t\tthis.bem(\"__point\") +\n\t\t\t\t\t\t(this.props.link.points[pointIndex].isSelected() ? this.bem(\"--point-selected\") : \"\")\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t<circle\n\t\t\t\t\tonMouseLeave={() => {\n\t\t\t\t\t\tthis.setState({ selected: false });\n\t\t\t\t\t}}\n\t\t\t\t\tonMouseEnter={() => {\n\t\t\t\t\t\tthis.setState({ selected: true });\n\t\t\t\t\t}}\n\t\t\t\t\tdata-id={this.props.link.points[pointIndex].id}\n\t\t\t\t\tdata-linkid={this.props.link.id}\n\t\t\t\t\tcx={x}\n\t\t\t\t\tcy={y}\n\t\t\t\t\tr={15}\n\t\t\t\t\topacity={0}\n\t\t\t\t\tclassName={\"point \" + this.bem(\"__point\")}\n\t\t\t\t/>\n\t\t\t</g>\n\t\t);\n\t}\n\n\tgenerateLabel(label: LabelModel) {\n\t\tconst canvas = this.props.diagramEngine.canvas as HTMLElement;\n\t\treturn (\n\t\t\t<foreignObject\n\t\t\t\tkey={label.id}\n\t\t\t\tclassName={this.bem(\"__label\")}\n\t\t\t\twidth={canvas.offsetWidth}\n\t\t\t\theight={canvas.offsetHeight}\n\t\t\t>\n\t\t\t\t<div ref={ref => (this.refLabels[label.id] = ref)}>\n\t\t\t\t\t{this.props.diagramEngine\n\t\t\t\t\t\t.getFactoryForLabel(label)\n\t\t\t\t\t\t.generateReactWidget(this.props.diagramEngine, label)}\n\t\t\t\t</div>\n\t\t\t</foreignObject>\n\t\t);\n\t}\n\n\tgenerateLink(path: string, extraProps: any, id: string | number): JSX.Element {\n\t\tvar props = this.props;\n\n\t\tvar Bottom = React.cloneElement(\n\t\t\t(props.diagramEngine.getFactoryForLink(this.props.link) as DefaultLinkFactory).generateLinkSegment(\n\t\t\t\tthis.props.link,\n\t\t\t\tthis,\n\t\t\t\tthis.state.selected || this.props.link.isSelected(),\n\t\t\t\tpath\n\t\t\t),\n\t\t\t{\n\t\t\t\tref: ref => ref && this.refPaths.push(ref)\n\t\t\t}\n\t\t);\n\n\t\tvar Top = React.cloneElement(Bottom, {\n\t\t\t...extraProps,\n\t\t\tstrokeLinecap: \"round\",\n\t\t\tonMouseLeave: () => {\n\t\t\t\tthis.setState({ selected: false });\n\t\t\t},\n\t\t\tonMouseEnter: () => {\n\t\t\t\tthis.setState({ selected: true });\n\t\t\t},\n\t\t\tref: null,\n\t\t\t\"data-linkid\": this.props.link.getID(),\n\t\t\tstrokeOpacity: this.state.selected ? 0.1 : 0,\n\t\t\tstrokeWidth: 20,\n\t\t\tonContextMenu: event => {\n\t\t\t\t// if (!this.props.diagramEngine.isModelLocked(this.props.link)) {\n\t\t\t\t// \tthis.props.link.remove();\n\t\t\t\t// }\n\t\t\t\tif (event && event.preventDefault) event.preventDefault();\n\t\t\t}\n\t\t});\n\n\t\treturn (\n\t\t\t<g key={\"link-\" + id}>\n\t\t\t\t{Bottom}\n\t\t\t\t{Top}\n\t\t\t</g>\n\t\t);\n\t}\n\n\tfindPathAndRelativePositionToRenderLabel = (index: number): { path: any; position: number } => {\n\t\t// an array to hold all path lengths, making sure we hit the DOM only once to fetch this information\n\t\tconst lengths = this.refPaths.map(path => path.getTotalLength());\n\n\t\t// calculate the point where we want to display the label\n\t\tlet labelPosition =\n\t\t\tlengths.reduce((previousValue, currentValue) => previousValue + currentValue, 0) *\n\t\t\t(index / (this.props.link.labels.length + 1));\n\n\t\t// find the path where the label will be rendered and calculate the relative position\n\t\tlet pathIndex = 0;\n\t\twhile (pathIndex < this.refPaths.length) {\n\t\t\tif (labelPosition - lengths[pathIndex] < 0) {\n\t\t\t\treturn {\n\t\t\t\t\tpath: this.refPaths[pathIndex],\n\t\t\t\t\tposition: labelPosition\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// keep searching\n\t\t\tlabelPosition -= lengths[pathIndex];\n\t\t\tpathIndex++;\n\t\t}\n\t};\n\n\tcalculateLabelPosition = (label, index: number) => {\n\t\tif (!this.refLabels[label.id]) {\n\t\t\t// no label? nothing to do here\n\t\t\treturn;\n\t\t}\n\n\t\tconst { path, position } = this.findPathAndRelativePositionToRenderLabel(index);\n\n\t\tconst labelDimensions = {\n\t\t\twidth: this.refLabels[label.id].offsetWidth,\n\t\t\theight: this.refLabels[label.id].offsetHeight\n\t\t};\n\n\t\tconst pathCentre = path.getPointAtLength(position);\n\n\t\tconst labelCoordinates = {\n\t\t\tx: pathCentre.x - labelDimensions.width / 2 + label.offsetX,\n\t\t\ty: pathCentre.y - labelDimensions.height / 2 + label.offsetY\n\t\t};\n\t\tthis.refLabels[label.id].setAttribute(\n\t\t\t\"style\",\n\t\t\t`transform: translate(${labelCoordinates.x}px, ${labelCoordinates.y}px);`\n\t\t);\n\t};\n\n\t/**\n\t * Smart routing is only applicable when all conditions below are true:\n\t * - smart routing is set to true on the engine\n\t * - current link is between two nodes (not between a node and an empty point)\n\t * - no custom points exist along the line\n\t */\n\tisSmartRoutingApplicable(): boolean {\n\t\tconst { diagramEngine, link } = this.props;\n\n\t\tif (!diagramEngine.isSmartRoutingEnabled()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (link.points.length !== 2) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (link.sourcePort === null || link.targetPort === null) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\trender() {\n\t\tconst { diagramEngine } = this.props;\n\t\tif (!diagramEngine.nodesRendered) {\n\t\t\treturn null;\n\t\t}\n\n\t\t//ensure id is present for all points on the path\n\t\tvar points = this.props.link.points;\n\t\tvar paths = [];\n\n\t\tif (this.isSmartRoutingApplicable()) {\n\t\t\t// first step: calculate a direct path between the points being linked\n\t\t\tconst directPathCoords = this.pathFinding.calculateDirectPath(_.first(points), _.last(points));\n\n\t\t\tconst routingMatrix = diagramEngine.getRoutingMatrix();\n\t\t\t// now we need to extract, from the routing matrix, the very first walkable points\n\t\t\t// so they can be used as origin and destination of the link to be created\n\t\t\tconst smartLink = this.pathFinding.calculateLinkStartEndCoords(routingMatrix, directPathCoords);\n\n\t\t\tif (smartLink) {\n\t\t\t\tconst { start, end, pathToStart, pathToEnd } = smartLink;\n\n\t\t\t\t// second step: calculate a path avoiding hitting other elements\n\t\t\t\tconst simplifiedPath = this.pathFinding.calculateDynamicPath(\n\t\t\t\t\troutingMatrix,\n\t\t\t\t\tstart,\n\t\t\t\t\tend,\n\t\t\t\t\tpathToStart,\n\t\t\t\t\tpathToEnd\n\t\t\t\t);\n\n\t\t\t\tpaths.push(\n\t\t\t\t\t//smooth: boolean, extraProps: any, id: string | number, firstPoint: PointModel, lastPoint: PointModel\n\t\t\t\t\tthis.generateLink(\n\t\t\t\t\t\tToolkit.generateDynamicPath(simplifiedPath),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonMouseDown: event => {\n\t\t\t\t\t\t\t\tthis.addPointToLink(event, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"0\"\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// true when smart routing was skipped or not enabled.\n\t\t// See @link{#isSmartRoutingApplicable()}.\n\t\tif (paths.length === 0) {\n\t\t\tif (points.length === 2) {\n\t\t\t\tvar isHorizontal = Math.abs(points[0].x - points[1].x) > Math.abs(points[0].y - points[1].y);\n\t\t\t\tvar xOrY = isHorizontal ? \"x\" : \"y\";\n\n\t\t\t\t//draw the smoothing\n\t\t\t\t//if the points are too close, just draw a straight line\n\t\t\t\tvar margin = 50;\n\t\t\t\tif (Math.abs(points[0][xOrY] - points[1][xOrY]) < 50) {\n\t\t\t\t\tmargin = 5;\n\t\t\t\t}\n\n\t\t\t\tvar pointLeft = points[0];\n\t\t\t\tvar pointRight = points[1];\n\n\t\t\t\t//some defensive programming to make sure the smoothing is\n\t\t\t\t//always in the right direction\n\t\t\t\tif (pointLeft[xOrY] > pointRight[xOrY]) {\n\t\t\t\t\tpointLeft = points[1];\n\t\t\t\t\tpointRight = points[0];\n\t\t\t\t}\n\n\t\t\t\tpaths.push(\n\t\t\t\t\tthis.generateLink(\n\t\t\t\t\t\tToolkit.generateCurvePath(pointLeft, pointRight, this.props.link.curvyness),\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tonMouseDown: event => {\n\t\t\t\t\t\t\t\tthis.addPointToLink(event, 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"0\"\n\t\t\t\t\t)\n\t\t\t\t);\n\n\t\t\t\t// draw the link as dangeling\n\t\t\t\tif (this.props.link.targetPort === null) {\n\t\t\t\t\tpaths.push(this.generatePoint(1));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t//draw the multiple anchors and complex line instead\n\t\t\t\tfor (let j = 0; j < points.length - 1; j++) {\n\t\t\t\t\tpaths.push(\n\t\t\t\t\t\tthis.generateLink(\n\t\t\t\t\t\t\tToolkit.generateLinePath(points[j], points[j + 1]),\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\"data-linkid\": this.props.link.id,\n\t\t\t\t\t\t\t\t\"data-point\": j,\n\t\t\t\t\t\t\t\tonMouseDown: (event: MouseEvent) => {\n\t\t\t\t\t\t\t\t\tthis.addPointToLink(event, j + 1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tj\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t//render the circles\n\t\t\t\tfor (var i = 1; i < points.length - 1; i++) {\n\t\t\t\t\tpaths.push(this.generatePoint(i));\n\t\t\t\t}\n\n\t\t\t\tif (this.props.link.targetPort === null) {\n\t\t\t\t\tpaths.push(this.generatePoint(points.length - 1));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.refPaths = [];\n\t\treturn (\n\t\t\t<g {...this.getProps()}>\n\t\t\t\t{paths}\n\t\t\t\t{_.map(this.props.link.labels, labelModel => {\n\t\t\t\t\treturn this.generateLabel(labelModel);\n\t\t\t\t})}\n\t\t\t</g>\n\t\t);\n\t}\n}\n","import { LinkModel } from \"../models/LinkModel\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { AbstractFactory } from \"./AbstractFactory\";\n\nexport abstract class AbstractLinkFactory<T extends LinkModel = LinkModel> extends AbstractFactory<T> {\n\tabstract generateReactWidget(diagramEngine: DiagramEngine, link: T): JSX.Element;\n}\n","import * as React from \"react\";\nimport * as _ from \"lodash\";\nimport { DefaultNodeModel } from \"../models/DefaultNodeModel\";\nimport { DefaultPortLabel } from \"./DefaultPortLabelWidget\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { BaseWidget, BaseWidgetProps } from \"../../widgets/BaseWidget\";\n\nexport interface DefaultNodeProps extends BaseWidgetProps {\n\tnode: DefaultNodeModel;\n\tdiagramEngine: DiagramEngine;\n}\n\nexport interface DefaultNodeState {}\n\n/**\n * @author Dylan Vorster\n */\nexport class DefaultNodeWidget extends BaseWidget<DefaultNodeProps, DefaultNodeState> {\n\tconstructor(props: DefaultNodeProps) {\n\t\tsuper(\"srd-default-node\", props);\n\t\tthis.state = {};\n\t}\n\n\tgeneratePort(port) {\n\t\treturn <DefaultPortLabel model={port} key={port.id} />;\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div {...this.getProps()} style={{ background: this.props.node.color }}>\n\t\t\t\t<div className={this.bem(\"__title\")}>\n\t\t\t\t\t<div className={this.bem(\"__name\")}>{this.props.node.name}</div>\n\t\t\t\t</div>\n\t\t\t\t<div className={this.bem(\"__ports\")}>\n\t\t\t\t\t<div className={this.bem(\"__in\")}>\n\t\t\t\t\t\t{_.map(this.props.node.getInPorts(), this.generatePort.bind(this))}\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className={this.bem(\"__out\")}>\n\t\t\t\t\t\t{_.map(this.props.node.getOutPorts(), this.generatePort.bind(this))}\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","import * as React from \"react\";\nimport { DefaultPortModel } from \"../models/DefaultPortModel\";\nimport { PortWidget } from \"../../widgets/PortWidget\";\nimport { BaseWidget, BaseWidgetProps } from \"../../widgets/BaseWidget\";\n\nexport interface DefaultPortLabelProps extends BaseWidgetProps {\n\tmodel: DefaultPortModel;\n}\n\nexport interface DefaultPortLabelState {}\n\n/**\n * @author Dylan Vorster\n */\nexport class DefaultPortLabel extends BaseWidget<DefaultPortLabelProps, DefaultPortLabelState> {\n\tconstructor(props) {\n\t\tsuper(\"srd-default-port\", props);\n\t}\n\n\tgetClassName() {\n\t\treturn super.getClassName() + (this.props.model.in ? this.bem(\"--in\") : this.bem(\"--out\"));\n\t}\n\n\trender() {\n\t\tvar port = <PortWidget node={this.props.model.getParent()} name={this.props.model.name} />;\n\t\tvar label = <div className=\"name\">{this.props.model.label}</div>;\n\n\t\treturn (\n\t\t\t<div {...this.getProps()}>\n\t\t\t\t{this.props.model.in ? port : label}\n\t\t\t\t{this.props.model.in ? label : port}\n\t\t\t</div>\n\t\t);\n\t}\n}\n","import * as React from \"react\";\nimport { NodeModel } from \"../models/NodeModel\";\nimport { BaseWidget, BaseWidgetProps } from \"./BaseWidget\";\n\nexport interface PortProps extends BaseWidgetProps {\n\tname: string;\n\tnode: NodeModel;\n}\n\nexport interface PortState {\n\tselected: boolean;\n}\n\n/**\n * @author Dylan Vorster\n */\nexport class PortWidget extends BaseWidget<PortProps, PortState> {\n\tconstructor(props: PortProps) {\n\t\tsuper(\"srd-port\", props);\n\t\tthis.state = {\n\t\t\tselected: false\n\t\t};\n\t}\n\n\tgetClassName() {\n\t\treturn \"port \" + super.getClassName() + (this.state.selected ? this.bem(\"--selected\") : \"\");\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div\n\t\t\t\t{...this.getProps()}\n\t\t\t\tonMouseEnter={() => {\n\t\t\t\t\tthis.setState({ selected: true });\n\t\t\t\t}}\n\t\t\t\tonMouseLeave={() => {\n\t\t\t\t\tthis.setState({ selected: false });\n\t\t\t\t}}\n\t\t\t\tdata-name={this.props.name}\n\t\t\t\tdata-nodeid={this.props.node.getID()}\n\t\t\t/>\n\t\t);\n\t}\n}\n","import { NodeModel } from \"../models/NodeModel\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { AbstractFactory } from \"./AbstractFactory\";\n\nexport abstract class AbstractNodeFactory<T extends NodeModel = NodeModel> extends AbstractFactory<T> {\n\tabstract generateReactWidget(diagramEngine: DiagramEngine, node: T): JSX.Element;\n}\n","import { BaseAction } from \"./BaseAction\";\nimport { DiagramModel } from \"../models/DiagramModel\";\n\nexport class MoveCanvasAction extends BaseAction {\n\tinitialOffsetX: number;\n\tinitialOffsetY: number;\n\n\tconstructor(mouseX: number, mouseY: number, diagramModel: DiagramModel) {\n\t\tsuper(mouseX, mouseY);\n\t\tthis.initialOffsetX = diagramModel.getOffsetX();\n\t\tthis.initialOffsetY = diagramModel.getOffsetY();\n\t}\n}\n","import { BaseAction } from \"./BaseAction\";\nimport { SelectionModel } from \"../models/SelectionModel\";\nimport { PointModel } from \"../models/PointModel\";\nimport { NodeModel } from \"../models/NodeModel\";\nimport { DiagramEngine } from \"../DiagramEngine\";\n\nexport class MoveItemsAction extends BaseAction {\n\tselectionModels: SelectionModel[];\n\tmoved: boolean;\n\n\tconstructor(mouseX: number, mouseY: number, diagramEngine: DiagramEngine) {\n\t\tsuper(mouseX, mouseY);\n\t\tthis.moved = false;\n\t\tdiagramEngine.enableRepaintEntities(diagramEngine.getDiagramModel().getSelectedItems());\n\t\tvar selectedItems = diagramEngine.getDiagramModel().getSelectedItems();\n\n\t\t//dont allow items which are locked to move\n\t\tselectedItems = selectedItems.filter(item => {\n\t\t\treturn !diagramEngine.isModelLocked(item);\n\t\t});\n\n\t\tthis.selectionModels = selectedItems.map((item: PointModel | NodeModel) => {\n\t\t\treturn {\n\t\t\t\tmodel: item,\n\t\t\t\tinitialX: item.x,\n\t\t\t\tinitialY: item.y\n\t\t\t};\n\t\t});\n\t}\n}\n","import { BaseAction } from \"./BaseAction\";\nimport { DiagramModel } from \"../models/DiagramModel\";\n\nexport class SelectingAction extends BaseAction {\n\tmouseX2: number;\n\tmouseY2: number;\n\n\tconstructor(mouseX: number, mouseY: number) {\n\t\tsuper(mouseX, mouseY);\n\t\tthis.mouseX2 = mouseX;\n\t\tthis.mouseY2 = mouseY;\n\t}\n\n\tgetBoxDimensions() {\n\t\treturn {\n\t\t\tleft: this.mouseX2 > this.mouseX ? this.mouseX : this.mouseX2,\n\t\t\ttop: this.mouseY2 > this.mouseY ? this.mouseY : this.mouseY2,\n\t\t\twidth: Math.abs(this.mouseX2 - this.mouseX),\n\t\t\theight: Math.abs(this.mouseY2 - this.mouseY),\n\t\t\tright: this.mouseX2 < this.mouseX ? this.mouseX : this.mouseX2,\n\t\t\tbottom: this.mouseY2 < this.mouseY ? this.mouseY : this.mouseY2\n\t\t};\n\t}\n\n\tcontainsElement(x: number, y: number, diagramModel: DiagramModel): boolean {\n\t\tvar z = diagramModel.getZoomLevel() / 100.0;\n\t\tlet dimensions = this.getBoxDimensions();\n\n\t\treturn (\n\t\t\tx * z + diagramModel.getOffsetX() > dimensions.left &&\n\t\t\tx * z + diagramModel.getOffsetX() < dimensions.right &&\n\t\t\ty * z + diagramModel.getOffsetY() > dimensions.top &&\n\t\t\ty * z + diagramModel.getOffsetY() < dimensions.bottom\n\t\t);\n\t}\n}\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { LinkWidget } from \"../LinkWidget\";\nimport * as _ from \"lodash\";\nimport { PointModel } from \"../../models/PointModel\";\nimport { BaseWidget, BaseWidgetProps } from \"../BaseWidget\";\n\nexport interface LinkLayerProps extends BaseWidgetProps {\n\tdiagramEngine: DiagramEngine;\n\tpointAdded: (point: PointModel, event: MouseEvent) => any;\n}\n\nexport interface LinkLayerState {}\n\n/**\n * @author Dylan Vorster\n */\nexport class LinkLayerWidget extends BaseWidget<LinkLayerProps, LinkLayerState> {\n\tconstructor(props: LinkLayerProps) {\n\t\tsuper(\"srd-link-layer\", props);\n\t\tthis.state = {};\n\t}\n\n\trender() {\n\t\tvar diagramModel = this.props.diagramEngine.getDiagramModel();\n\t\treturn (\n\t\t\t<svg\n\t\t\t\t{...this.getProps()}\n\t\t\t\tstyle={{\n\t\t\t\t\ttransform:\n\t\t\t\t\t\t\"translate(\" +\n\t\t\t\t\t\tdiagramModel.getOffsetX() +\n\t\t\t\t\t\t\"px,\" +\n\t\t\t\t\t\tdiagramModel.getOffsetY() +\n\t\t\t\t\t\t\"px) scale(\" +\n\t\t\t\t\t\tdiagramModel.getZoomLevel() / 100.0 +\n\t\t\t\t\t\t\")\"\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{//only perform these actions when we have a diagram\n\t\t\t\tthis.props.diagramEngine.canvas &&\n\t\t\t\t\t_.map(diagramModel.getLinks(), link => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.props.diagramEngine.nodesRendered &&\n\t\t\t\t\t\t\t!this.props.diagramEngine.linksThatHaveInitiallyRendered[link.id]\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tif (link.sourcePort !== null) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst portCenter = this.props.diagramEngine.getPortCenter(link.sourcePort);\n\t\t\t\t\t\t\t\t\tlink.points[0].updateLocation(portCenter);\n\n\t\t\t\t\t\t\t\t\tconst portCoords = this.props.diagramEngine.getPortCoords(link.sourcePort);\n\t\t\t\t\t\t\t\t\tlink.sourcePort.updateCoords(portCoords);\n\n\t\t\t\t\t\t\t\t\tthis.props.diagramEngine.linksThatHaveInitiallyRendered[link.id] = true;\n\t\t\t\t\t\t\t\t} catch (ignore) {\n\t\t\t\t\t\t\t\t\t/*noop*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (link.targetPort !== null) {\n\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\tconst portCenter = this.props.diagramEngine.getPortCenter(link.targetPort);\n\t\t\t\t\t\t\t\t\t_.last(link.points).updateLocation(portCenter);\n\n\t\t\t\t\t\t\t\t\tconst portCoords = this.props.diagramEngine.getPortCoords(link.targetPort);\n\t\t\t\t\t\t\t\t\tlink.targetPort.updateCoords(portCoords);\n\n\t\t\t\t\t\t\t\t\tthis.props.diagramEngine.linksThatHaveInitiallyRendered[link.id] = true;\n\t\t\t\t\t\t\t\t} catch (ignore) {\n\t\t\t\t\t\t\t\t\t/*noop*/\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//generate links\n\t\t\t\t\t\tvar generatedLink = this.props.diagramEngine.generateWidgetForLink(link);\n\t\t\t\t\t\tif (!generatedLink) {\n\t\t\t\t\t\t\tthrow new Error(`no link generated for type: ${link.getType()}`);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t<LinkWidget key={link.getID()} link={link} diagramEngine={this.props.diagramEngine}>\n\t\t\t\t\t\t\t\t{React.cloneElement(generatedLink, {\n\t\t\t\t\t\t\t\t\tpointAdded: this.props.pointAdded\n\t\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t\t</LinkWidget>\n\t\t\t\t\t\t);\n\t\t\t\t\t})}\n\t\t\t</svg>\n\t\t);\n\t}\n}\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { LinkModel } from \"../models/LinkModel\";\nimport { BaseWidget, BaseWidgetProps } from \"./BaseWidget\";\n\nexport interface LinkProps extends BaseWidgetProps {\n\tlink: LinkModel;\n\tdiagramEngine: DiagramEngine;\n\tchildren?: any;\n}\n\nexport interface LinkState {}\n\n/**\n * @author Dylan Vorster\n */\nexport class LinkWidget extends BaseWidget<LinkProps, LinkState> {\n\tconstructor(props: LinkProps) {\n\t\tsuper(\"srd-link\", props);\n\t\tthis.state = {};\n\t}\n\n\tshouldComponentUpdate() {\n\t\treturn this.props.diagramEngine.canEntityRepaint(this.props.link);\n\t}\n\n\trender() {\n\t\treturn this.props.children;\n\t}\n}\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport * as _ from \"lodash\";\nimport { NodeWidget } from \"../NodeWidget\";\nimport { NodeModel } from \"../../models/NodeModel\";\nimport { BaseWidget, BaseWidgetProps } from \"../BaseWidget\";\n\nexport interface NodeLayerProps extends BaseWidgetProps {\n\tdiagramEngine: DiagramEngine;\n}\n\nexport interface NodeLayerState {}\n\nexport class NodeLayerWidget extends BaseWidget<NodeLayerProps, NodeLayerState> {\n\tconstructor(props: NodeLayerProps) {\n\t\tsuper(\"srd-node-layer\", props);\n\t\tthis.state = {};\n\t}\n\n\tupdateNodeDimensions = () => {\n\t\tif (!this.props.diagramEngine.nodesRendered) {\n\t\t\tconst diagramModel = this.props.diagramEngine.getDiagramModel();\n\t\t\t_.map(diagramModel.getNodes(), node => {\n\t\t\t\tnode.updateDimensions(this.props.diagramEngine.getNodeDimensions(node));\n\t\t\t});\n\t\t}\n\t};\n\n\tcomponentDidUpdate() {\n\t\tthis.updateNodeDimensions();\n\t\tthis.props.diagramEngine.nodesRendered = true;\n\t}\n\n\trender() {\n\t\tvar diagramModel = this.props.diagramEngine.getDiagramModel();\n\t\treturn (\n\t\t\t<div\n\t\t\t\t{...this.getProps()}\n\t\t\t\tstyle={{\n\t\t\t\t\ttransform:\n\t\t\t\t\t\t\"translate(\" +\n\t\t\t\t\t\tdiagramModel.getOffsetX() +\n\t\t\t\t\t\t\"px,\" +\n\t\t\t\t\t\tdiagramModel.getOffsetY() +\n\t\t\t\t\t\t\"px) scale(\" +\n\t\t\t\t\t\tdiagramModel.getZoomLevel() / 100.0 +\n\t\t\t\t\t\t\")\"\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{_.map(diagramModel.getNodes(), (node: NodeModel) => {\n\t\t\t\t\treturn React.createElement(\n\t\t\t\t\t\tNodeWidget,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdiagramEngine: this.props.diagramEngine,\n\t\t\t\t\t\t\tkey: node.id,\n\t\t\t\t\t\t\tnode: node\n\t\t\t\t\t\t},\n\t\t\t\t\t\tthis.props.diagramEngine.generateWidgetForNode(node)\n\t\t\t\t\t);\n\t\t\t\t})}\n\t\t\t</div>\n\t\t);\n\t}\n}\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport { NodeModel } from \"../models/NodeModel\";\nimport { Toolkit } from \"../Toolkit\";\nimport { BaseWidget, BaseWidgetProps } from \"./BaseWidget\";\n\nexport interface NodeProps extends BaseWidgetProps {\n\tnode: NodeModel;\n\tchildren?: any;\n\tdiagramEngine: DiagramEngine;\n}\n\nexport interface NodeState {}\n\n/**\n * @author Dylan Vorster\n */\nexport class NodeWidget extends BaseWidget<NodeProps, NodeState> {\n\tconstructor(props: NodeProps) {\n\t\tsuper(\"srd-node\", props);\n\t\tthis.state = {};\n\t}\n\n\tshouldComponentUpdate() {\n\t\treturn this.props.diagramEngine.canEntityRepaint(this.props.node);\n\t}\n\n\tgetClassName() {\n\t\treturn \"node \" + super.getClassName() + (this.props.node.isSelected() ? this.bem(\"--selected\") : \"\");\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div\n\t\t\t\t{...this.getProps()}\n\t\t\t\tdata-nodeid={this.props.node.id}\n\t\t\t\tstyle={{\n\t\t\t\t\ttop: this.props.node.y,\n\t\t\t\t\tleft: this.props.node.x\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{this.props.children}\n\t\t\t</div>\n\t\t);\n\t}\n}\n","var matches = require('matches-selector')\r\n\r\nmodule.exports = function (element, selector, checkYoSelf) {\r\n  var parent = checkYoSelf ? element : element.parentNode\r\n\r\n  while (parent && parent !== document) {\r\n    if (matches(parent, selector)) return parent;\r\n    parent = parent.parentNode\r\n  }\r\n}\r\n","\r\n/**\r\n * Element prototype.\r\n */\r\n\r\nvar proto = Element.prototype;\r\n\r\n/**\r\n * Vendor function.\r\n */\r\n\r\nvar vendor = proto.matchesSelector\r\n  || proto.webkitMatchesSelector\r\n  || proto.mozMatchesSelector\r\n  || proto.msMatchesSelector\r\n  || proto.oMatchesSelector;\r\n\r\n/**\r\n * Expose `match()`.\r\n */\r\n\r\nmodule.exports = match;\r\n\r\n/**\r\n * Match `el` to `selector`.\r\n *\r\n * @param {Element} el\r\n * @param {String} selector\r\n * @return {Boolean}\r\n * @api public\r\n */\r\n\r\nfunction match(el, selector) {\r\n  if (vendor) return vendor.call(el, selector);\r\n  var nodes = el.parentNode.querySelectorAll(selector);\r\n  for (var i = 0; i < nodes.length; ++i) {\r\n    if (nodes[i] == el) return true;\r\n  }\r\n  return false;\r\n}","module.exports = require('./src/PathFinding');\r\n","module.exports = {\r\n    'Heap'                      : require('heap'),\r\n    'Node'                      : require('./core/Node'),\r\n    'Grid'                      : require('./core/Grid'),\r\n    'Util'                      : require('./core/Util'),\r\n    'DiagonalMovement'          : require('./core/DiagonalMovement'),\r\n    'Heuristic'                 : require('./core/Heuristic'),\r\n    'AStarFinder'               : require('./finders/AStarFinder'),\r\n    'BestFirstFinder'           : require('./finders/BestFirstFinder'),\r\n    'BreadthFirstFinder'        : require('./finders/BreadthFirstFinder'),\r\n    'DijkstraFinder'            : require('./finders/DijkstraFinder'),\r\n    'BiAStarFinder'             : require('./finders/BiAStarFinder'),\r\n    'BiBestFirstFinder'         : require('./finders/BiBestFirstFinder'),\r\n    'BiBreadthFirstFinder'      : require('./finders/BiBreadthFirstFinder'),\r\n    'BiDijkstraFinder'          : require('./finders/BiDijkstraFinder'),\r\n    'IDAStarFinder'             : require('./finders/IDAStarFinder'),\r\n    'JumpPointFinder'           : require('./finders/JumpPointFinder'),\r\n};\r\n","// Generated by CoffeeScript 1.8.0\n(function() {\n  var Heap, defaultCmp, floor, heapify, heappop, heappush, heappushpop, heapreplace, insort, min, nlargest, nsmallest, updateItem, _siftdown, _siftup;\n\n  floor = Math.floor, min = Math.min;\n\n\n  /*\n  Default comparison function to be used\n   */\n\n  defaultCmp = function(x, y) {\n    if (x < y) {\n      return -1;\n    }\n    if (x > y) {\n      return 1;\n    }\n    return 0;\n  };\n\n\n  /*\n  Insert item x in list a, and keep it sorted assuming a is sorted.\n  \n  If x is already in a, insert it to the right of the rightmost x.\n  \n  Optional args lo (default 0) and hi (default a.length) bound the slice\n  of a to be searched.\n   */\n\n  insort = function(a, x, lo, hi, cmp) {\n    var mid;\n    if (lo == null) {\n      lo = 0;\n    }\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    if (lo < 0) {\n      throw new Error('lo must be non-negative');\n    }\n    if (hi == null) {\n      hi = a.length;\n    }\n    while (lo < hi) {\n      mid = floor((lo + hi) / 2);\n      if (cmp(x, a[mid]) < 0) {\n        hi = mid;\n      } else {\n        lo = mid + 1;\n      }\n    }\n    return ([].splice.apply(a, [lo, lo - lo].concat(x)), x);\n  };\n\n\n  /*\n  Push item onto heap, maintaining the heap invariant.\n   */\n\n  heappush = function(array, item, cmp) {\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    array.push(item);\n    return _siftdown(array, 0, array.length - 1, cmp);\n  };\n\n\n  /*\n  Pop the smallest item off the heap, maintaining the heap invariant.\n   */\n\n  heappop = function(array, cmp) {\n    var lastelt, returnitem;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    lastelt = array.pop();\n    if (array.length) {\n      returnitem = array[0];\n      array[0] = lastelt;\n      _siftup(array, 0, cmp);\n    } else {\n      returnitem = lastelt;\n    }\n    return returnitem;\n  };\n\n\n  /*\n  Pop and return the current smallest value, and add the new item.\n  \n  This is more efficient than heappop() followed by heappush(), and can be\n  more appropriate when using a fixed size heap. Note that the value\n  returned may be larger than item! That constrains reasonable use of\n  this routine unless written as part of a conditional replacement:\n      if item > array[0]\n        item = heapreplace(array, item)\n   */\n\n  heapreplace = function(array, item, cmp) {\n    var returnitem;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    returnitem = array[0];\n    array[0] = item;\n    _siftup(array, 0, cmp);\n    return returnitem;\n  };\n\n\n  /*\n  Fast version of a heappush followed by a heappop.\n   */\n\n  heappushpop = function(array, item, cmp) {\n    var _ref;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    if (array.length && cmp(array[0], item) < 0) {\n      _ref = [array[0], item], item = _ref[0], array[0] = _ref[1];\n      _siftup(array, 0, cmp);\n    }\n    return item;\n  };\n\n\n  /*\n  Transform list into a heap, in-place, in O(array.length) time.\n   */\n\n  heapify = function(array, cmp) {\n    var i, _i, _j, _len, _ref, _ref1, _results, _results1;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    _ref1 = (function() {\n      _results1 = [];\n      for (var _j = 0, _ref = floor(array.length / 2); 0 <= _ref ? _j < _ref : _j > _ref; 0 <= _ref ? _j++ : _j--){ _results1.push(_j); }\n      return _results1;\n    }).apply(this).reverse();\n    _results = [];\n    for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n      i = _ref1[_i];\n      _results.push(_siftup(array, i, cmp));\n    }\n    return _results;\n  };\n\n\n  /*\n  Update the position of the given item in the heap.\n  This function should be called every time the item is being modified.\n   */\n\n  updateItem = function(array, item, cmp) {\n    var pos;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    pos = array.indexOf(item);\n    if (pos === -1) {\n      return;\n    }\n    _siftdown(array, 0, pos, cmp);\n    return _siftup(array, pos, cmp);\n  };\n\n\n  /*\n  Find the n largest elements in a dataset.\n   */\n\n  nlargest = function(array, n, cmp) {\n    var elem, result, _i, _len, _ref;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    result = array.slice(0, n);\n    if (!result.length) {\n      return result;\n    }\n    heapify(result, cmp);\n    _ref = array.slice(n);\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      elem = _ref[_i];\n      heappushpop(result, elem, cmp);\n    }\n    return result.sort(cmp).reverse();\n  };\n\n\n  /*\n  Find the n smallest elements in a dataset.\n   */\n\n  nsmallest = function(array, n, cmp) {\n    var elem, i, los, result, _i, _j, _len, _ref, _ref1, _results;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    if (n * 10 <= array.length) {\n      result = array.slice(0, n).sort(cmp);\n      if (!result.length) {\n        return result;\n      }\n      los = result[result.length - 1];\n      _ref = array.slice(n);\n      for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n        elem = _ref[_i];\n        if (cmp(elem, los) < 0) {\n          insort(result, elem, 0, null, cmp);\n          result.pop();\n          los = result[result.length - 1];\n        }\n      }\n      return result;\n    }\n    heapify(array, cmp);\n    _results = [];\n    for (i = _j = 0, _ref1 = min(n, array.length); 0 <= _ref1 ? _j < _ref1 : _j > _ref1; i = 0 <= _ref1 ? ++_j : --_j) {\n      _results.push(heappop(array, cmp));\n    }\n    return _results;\n  };\n\n  _siftdown = function(array, startpos, pos, cmp) {\n    var newitem, parent, parentpos;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    newitem = array[pos];\n    while (pos > startpos) {\n      parentpos = (pos - 1) >> 1;\n      parent = array[parentpos];\n      if (cmp(newitem, parent) < 0) {\n        array[pos] = parent;\n        pos = parentpos;\n        continue;\n      }\n      break;\n    }\n    return array[pos] = newitem;\n  };\n\n  _siftup = function(array, pos, cmp) {\n    var childpos, endpos, newitem, rightpos, startpos;\n    if (cmp == null) {\n      cmp = defaultCmp;\n    }\n    endpos = array.length;\n    startpos = pos;\n    newitem = array[pos];\n    childpos = 2 * pos + 1;\n    while (childpos < endpos) {\n      rightpos = childpos + 1;\n      if (rightpos < endpos && !(cmp(array[childpos], array[rightpos]) < 0)) {\n        childpos = rightpos;\n      }\n      array[pos] = array[childpos];\n      pos = childpos;\n      childpos = 2 * pos + 1;\n    }\n    array[pos] = newitem;\n    return _siftdown(array, startpos, pos, cmp);\n  };\n\n  Heap = (function() {\n    Heap.push = heappush;\n\n    Heap.pop = heappop;\n\n    Heap.replace = heapreplace;\n\n    Heap.pushpop = heappushpop;\n\n    Heap.heapify = heapify;\n\n    Heap.updateItem = updateItem;\n\n    Heap.nlargest = nlargest;\n\n    Heap.nsmallest = nsmallest;\n\n    function Heap(cmp) {\n      this.cmp = cmp != null ? cmp : defaultCmp;\n      this.nodes = [];\n    }\n\n    Heap.prototype.push = function(x) {\n      return heappush(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.pop = function() {\n      return heappop(this.nodes, this.cmp);\n    };\n\n    Heap.prototype.peek = function() {\n      return this.nodes[0];\n    };\n\n    Heap.prototype.contains = function(x) {\n      return this.nodes.indexOf(x) !== -1;\n    };\n\n    Heap.prototype.replace = function(x) {\n      return heapreplace(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.pushpop = function(x) {\n      return heappushpop(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.heapify = function() {\n      return heapify(this.nodes, this.cmp);\n    };\n\n    Heap.prototype.updateItem = function(x) {\n      return updateItem(this.nodes, x, this.cmp);\n    };\n\n    Heap.prototype.clear = function() {\n      return this.nodes = [];\n    };\n\n    Heap.prototype.empty = function() {\n      return this.nodes.length === 0;\n    };\n\n    Heap.prototype.size = function() {\n      return this.nodes.length;\n    };\n\n    Heap.prototype.clone = function() {\n      var heap;\n      heap = new Heap();\n      heap.nodes = this.nodes.slice(0);\n      return heap;\n    };\n\n    Heap.prototype.toArray = function() {\n      return this.nodes.slice(0);\n    };\n\n    Heap.prototype.insert = Heap.prototype.push;\n\n    Heap.prototype.top = Heap.prototype.peek;\n\n    Heap.prototype.front = Heap.prototype.peek;\n\n    Heap.prototype.has = Heap.prototype.contains;\n\n    Heap.prototype.copy = Heap.prototype.clone;\n\n    return Heap;\n\n  })();\n\n  if (typeof module !== \"undefined\" && module !== null ? module.exports : void 0) {\n    module.exports = Heap;\n  } else {\n    window.Heap = Heap;\n  }\n\n}).call(this);\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","var Node = require('./Node');\r\nvar DiagonalMovement = require('./DiagonalMovement');\r\n\r\n/**\r\n * The Grid class, which serves as the encapsulation of the layout of the nodes.\r\n * @constructor\r\n * @param {number|Array<Array<(number|boolean)>>} width_or_matrix Number of columns of the grid, or matrix\r\n * @param {number} height Number of rows of the grid.\r\n * @param {Array<Array<(number|boolean)>>} [matrix] - A 0-1 matrix\r\n *     representing the walkable status of the nodes(0 or false for walkable).\r\n *     If the matrix is not supplied, all the nodes will be walkable.  */\r\nfunction Grid(width_or_matrix, height, matrix) {\r\n    var width;\r\n\r\n    if (typeof width_or_matrix !== 'object') {\r\n        width = width_or_matrix;\r\n    } else {\r\n        height = width_or_matrix.length;\r\n        width = width_or_matrix[0].length;\r\n        matrix = width_or_matrix;\r\n    }\r\n\r\n    /**\r\n     * The number of columns of the grid.\r\n     * @type number\r\n     */\r\n    this.width = width;\r\n    /**\r\n     * The number of rows of the grid.\r\n     * @type number\r\n     */\r\n    this.height = height;\r\n\r\n    /**\r\n     * A 2D array of nodes.\r\n     */\r\n    this.nodes = this._buildNodes(width, height, matrix);\r\n}\r\n\r\n/**\r\n * Build and return the nodes.\r\n * @private\r\n * @param {number} width\r\n * @param {number} height\r\n * @param {Array<Array<number|boolean>>} [matrix] - A 0-1 matrix representing\r\n *     the walkable status of the nodes.\r\n * @see Grid\r\n */\r\nGrid.prototype._buildNodes = function(width, height, matrix) {\r\n    var i, j,\r\n        nodes = new Array(height);\r\n\r\n    for (i = 0; i < height; ++i) {\r\n        nodes[i] = new Array(width);\r\n        for (j = 0; j < width; ++j) {\r\n            nodes[i][j] = new Node(j, i);\r\n        }\r\n    }\r\n\r\n\r\n    if (matrix === undefined) {\r\n        return nodes;\r\n    }\r\n\r\n    if (matrix.length !== height || matrix[0].length !== width) {\r\n        throw new Error('Matrix size does not fit');\r\n    }\r\n\r\n    for (i = 0; i < height; ++i) {\r\n        for (j = 0; j < width; ++j) {\r\n            if (matrix[i][j]) {\r\n                // 0, false, null will be walkable\r\n                // while others will be un-walkable\r\n                nodes[i][j].walkable = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    return nodes;\r\n};\r\n\r\n\r\nGrid.prototype.getNodeAt = function(x, y) {\r\n    return this.nodes[y][x];\r\n};\r\n\r\n\r\n/**\r\n * Determine whether the node at the given position is walkable.\r\n * (Also returns false if the position is outside the grid.)\r\n * @param {number} x - The x coordinate of the node.\r\n * @param {number} y - The y coordinate of the node.\r\n * @return {boolean} - The walkability of the node.\r\n */\r\nGrid.prototype.isWalkableAt = function(x, y) {\r\n    return this.isInside(x, y) && this.nodes[y][x].walkable;\r\n};\r\n\r\n\r\n/**\r\n * Determine whether the position is inside the grid.\r\n * XXX: `grid.isInside(x, y)` is wierd to read.\r\n * It should be `(x, y) is inside grid`, but I failed to find a better\r\n * name for this method.\r\n * @param {number} x\r\n * @param {number} y\r\n * @return {boolean}\r\n */\r\nGrid.prototype.isInside = function(x, y) {\r\n    return (x >= 0 && x < this.width) && (y >= 0 && y < this.height);\r\n};\r\n\r\n\r\n/**\r\n * Set whether the node on the given position is walkable.\r\n * NOTE: throws exception if the coordinate is not inside the grid.\r\n * @param {number} x - The x coordinate of the node.\r\n * @param {number} y - The y coordinate of the node.\r\n * @param {boolean} walkable - Whether the position is walkable.\r\n */\r\nGrid.prototype.setWalkableAt = function(x, y, walkable) {\r\n    this.nodes[y][x].walkable = walkable;\r\n};\r\n\r\n\r\n/**\r\n * Get the neighbors of the given node.\r\n *\r\n *     offsets      diagonalOffsets:\r\n *  +---+---+---+    +---+---+---+\r\n *  |   | 0 |   |    | 0 |   | 1 |\r\n *  +---+---+---+    +---+---+---+\r\n *  | 3 |   | 1 |    |   |   |   |\r\n *  +---+---+---+    +---+---+---+\r\n *  |   | 2 |   |    | 3 |   | 2 |\r\n *  +---+---+---+    +---+---+---+\r\n *\r\n *  When allowDiagonal is true, if offsets[i] is valid, then\r\n *  diagonalOffsets[i] and\r\n *  diagonalOffsets[(i + 1) % 4] is valid.\r\n * @param {Node} node\r\n * @param {DiagonalMovement} diagonalMovement\r\n */\r\nGrid.prototype.getNeighbors = function(node, diagonalMovement) {\r\n    var x = node.x,\r\n        y = node.y,\r\n        neighbors = [],\r\n        s0 = false, d0 = false,\r\n        s1 = false, d1 = false,\r\n        s2 = false, d2 = false,\r\n        s3 = false, d3 = false,\r\n        nodes = this.nodes;\r\n\r\n    // \r\n    if (this.isWalkableAt(x, y - 1)) {\r\n        neighbors.push(nodes[y - 1][x]);\r\n        s0 = true;\r\n    }\r\n    // \r\n    if (this.isWalkableAt(x + 1, y)) {\r\n        neighbors.push(nodes[y][x + 1]);\r\n        s1 = true;\r\n    }\r\n    // \r\n    if (this.isWalkableAt(x, y + 1)) {\r\n        neighbors.push(nodes[y + 1][x]);\r\n        s2 = true;\r\n    }\r\n    // \r\n    if (this.isWalkableAt(x - 1, y)) {\r\n        neighbors.push(nodes[y][x - 1]);\r\n        s3 = true;\r\n    }\r\n\r\n    if (diagonalMovement === DiagonalMovement.Never) {\r\n        return neighbors;\r\n    }\r\n\r\n    if (diagonalMovement === DiagonalMovement.OnlyWhenNoObstacles) {\r\n        d0 = s3 && s0;\r\n        d1 = s0 && s1;\r\n        d2 = s1 && s2;\r\n        d3 = s2 && s3;\r\n    } else if (diagonalMovement === DiagonalMovement.IfAtMostOneObstacle) {\r\n        d0 = s3 || s0;\r\n        d1 = s0 || s1;\r\n        d2 = s1 || s2;\r\n        d3 = s2 || s3;\r\n    } else if (diagonalMovement === DiagonalMovement.Always) {\r\n        d0 = true;\r\n        d1 = true;\r\n        d2 = true;\r\n        d3 = true;\r\n    } else {\r\n        throw new Error('Incorrect value of diagonalMovement');\r\n    }\r\n\r\n    // \r\n    if (d0 && this.isWalkableAt(x - 1, y - 1)) {\r\n        neighbors.push(nodes[y - 1][x - 1]);\r\n    }\r\n    // \r\n    if (d1 && this.isWalkableAt(x + 1, y - 1)) {\r\n        neighbors.push(nodes[y - 1][x + 1]);\r\n    }\r\n    // \r\n    if (d2 && this.isWalkableAt(x + 1, y + 1)) {\r\n        neighbors.push(nodes[y + 1][x + 1]);\r\n    }\r\n    // \r\n    if (d3 && this.isWalkableAt(x - 1, y + 1)) {\r\n        neighbors.push(nodes[y + 1][x - 1]);\r\n    }\r\n\r\n    return neighbors;\r\n};\r\n\r\n\r\n/**\r\n * Get a clone of this grid.\r\n * @return {Grid} Cloned grid.\r\n */\r\nGrid.prototype.clone = function() {\r\n    var i, j,\r\n\r\n        width = this.width,\r\n        height = this.height,\r\n        thisNodes = this.nodes,\r\n\r\n        newGrid = new Grid(width, height),\r\n        newNodes = new Array(height);\r\n\r\n    for (i = 0; i < height; ++i) {\r\n        newNodes[i] = new Array(width);\r\n        for (j = 0; j < width; ++j) {\r\n            newNodes[i][j] = new Node(j, i, thisNodes[i][j].walkable);\r\n        }\r\n    }\r\n\r\n    newGrid.nodes = newNodes;\r\n\r\n    return newGrid;\r\n};\r\n\r\nmodule.exports = Grid;\r\n","var AStarFinder = require('./AStarFinder');\r\n\r\n/**\r\n * Best-First-Search path-finder.\r\n * @constructor\r\n * @extends AStarFinder\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n */\r\nfunction BestFirstFinder(opt) {\r\n    AStarFinder.call(this, opt);\r\n\r\n    var orig = this.heuristic;\r\n    this.heuristic = function(dx, dy) {\r\n        return orig(dx, dy) * 1000000;\r\n    };\r\n}\r\n\r\nBestFirstFinder.prototype = new AStarFinder();\r\nBestFirstFinder.prototype.constructor = BestFirstFinder;\r\n\r\nmodule.exports = BestFirstFinder;\r\n","var Util = require('../core/Util');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Breadth-First-Search path finder.\r\n * @constructor\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n */\r\nfunction BreadthFirstFinder(opt) {\r\n    opt = opt || {};\r\n    this.allowDiagonal = opt.allowDiagonal;\r\n    this.dontCrossCorners = opt.dontCrossCorners;\r\n    this.diagonalMovement = opt.diagonalMovement;\r\n\r\n    if (!this.diagonalMovement) {\r\n        if (!this.allowDiagonal) {\r\n            this.diagonalMovement = DiagonalMovement.Never;\r\n        } else {\r\n            if (this.dontCrossCorners) {\r\n                this.diagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;\r\n            } else {\r\n                this.diagonalMovement = DiagonalMovement.IfAtMostOneObstacle;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Find and return the the path.\r\n * @return {Array<Array<number>>} The path, including both start and\r\n *     end positions.\r\n */\r\nBreadthFirstFinder.prototype.findPath = function(startX, startY, endX, endY, grid) {\r\n    var openList = [],\r\n        diagonalMovement = this.diagonalMovement,\r\n        startNode = grid.getNodeAt(startX, startY),\r\n        endNode = grid.getNodeAt(endX, endY),\r\n        neighbors, neighbor, node, i, l;\r\n\r\n    // push the start pos into the queue\r\n    openList.push(startNode);\r\n    startNode.opened = true;\r\n\r\n    // while the queue is not empty\r\n    while (openList.length) {\r\n        // take the front node from the queue\r\n        node = openList.shift();\r\n        node.closed = true;\r\n\r\n        // reached the end position\r\n        if (node === endNode) {\r\n            return Util.backtrace(endNode);\r\n        }\r\n\r\n        neighbors = grid.getNeighbors(node, diagonalMovement);\r\n        for (i = 0, l = neighbors.length; i < l; ++i) {\r\n            neighbor = neighbors[i];\r\n\r\n            // skip this neighbor if it has been inspected before\r\n            if (neighbor.closed || neighbor.opened) {\r\n                continue;\r\n            }\r\n\r\n            openList.push(neighbor);\r\n            neighbor.opened = true;\r\n            neighbor.parent = node;\r\n        }\r\n    }\r\n    \r\n    // fail to find the path\r\n    return [];\r\n};\r\n\r\nmodule.exports = BreadthFirstFinder;\r\n","var AStarFinder = require('./AStarFinder');\r\n\r\n/**\r\n * Dijkstra path-finder.\r\n * @constructor\r\n * @extends AStarFinder\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n */\r\nfunction DijkstraFinder(opt) {\r\n    AStarFinder.call(this, opt);\r\n    this.heuristic = function(dx, dy) {\r\n        return 0;\r\n    };\r\n}\r\n\r\nDijkstraFinder.prototype = new AStarFinder();\r\nDijkstraFinder.prototype.constructor = DijkstraFinder;\r\n\r\nmodule.exports = DijkstraFinder;\r\n","var BiAStarFinder = require('./BiAStarFinder');\r\n\r\n/**\r\n * Bi-direcitional Best-First-Search path-finder.\r\n * @constructor\r\n * @extends BiAStarFinder\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n */\r\nfunction BiBestFirstFinder(opt) {\r\n    BiAStarFinder.call(this, opt);\r\n\r\n    var orig = this.heuristic;\r\n    this.heuristic = function(dx, dy) {\r\n        return orig(dx, dy) * 1000000;\r\n    };\r\n}\r\n\r\nBiBestFirstFinder.prototype = new BiAStarFinder();\r\nBiBestFirstFinder.prototype.constructor = BiBestFirstFinder;\r\n\r\nmodule.exports = BiBestFirstFinder;\r\n","var Util = require('../core/Util');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Bi-directional Breadth-First-Search path finder.\r\n * @constructor\r\n * @param {object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n */\r\nfunction BiBreadthFirstFinder(opt) {\r\n    opt = opt || {};\r\n    this.allowDiagonal = opt.allowDiagonal;\r\n    this.dontCrossCorners = opt.dontCrossCorners;\r\n    this.diagonalMovement = opt.diagonalMovement;\r\n\r\n    if (!this.diagonalMovement) {\r\n        if (!this.allowDiagonal) {\r\n            this.diagonalMovement = DiagonalMovement.Never;\r\n        } else {\r\n            if (this.dontCrossCorners) {\r\n                this.diagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;\r\n            } else {\r\n                this.diagonalMovement = DiagonalMovement.IfAtMostOneObstacle;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**\r\n * Find and return the the path.\r\n * @return {Array<Array<number>>} The path, including both start and\r\n *     end positions.\r\n */\r\nBiBreadthFirstFinder.prototype.findPath = function(startX, startY, endX, endY, grid) {\r\n    var startNode = grid.getNodeAt(startX, startY),\r\n        endNode = grid.getNodeAt(endX, endY),\r\n        startOpenList = [], endOpenList = [],\r\n        neighbors, neighbor, node,\r\n        diagonalMovement = this.diagonalMovement,\r\n        BY_START = 0, BY_END = 1,\r\n        i, l;\r\n\r\n    // push the start and end nodes into the queues\r\n    startOpenList.push(startNode);\r\n    startNode.opened = true;\r\n    startNode.by = BY_START;\r\n\r\n    endOpenList.push(endNode);\r\n    endNode.opened = true;\r\n    endNode.by = BY_END;\r\n\r\n    // while both the queues are not empty\r\n    while (startOpenList.length && endOpenList.length) {\r\n\r\n        // expand start open list\r\n\r\n        node = startOpenList.shift();\r\n        node.closed = true;\r\n\r\n        neighbors = grid.getNeighbors(node, diagonalMovement);\r\n        for (i = 0, l = neighbors.length; i < l; ++i) {\r\n            neighbor = neighbors[i];\r\n\r\n            if (neighbor.closed) {\r\n                continue;\r\n            }\r\n            if (neighbor.opened) {\r\n                // if this node has been inspected by the reversed search,\r\n                // then a path is found.\r\n                if (neighbor.by === BY_END) {\r\n                    return Util.biBacktrace(node, neighbor);\r\n                }\r\n                continue;\r\n            }\r\n            startOpenList.push(neighbor);\r\n            neighbor.parent = node;\r\n            neighbor.opened = true;\r\n            neighbor.by = BY_START;\r\n        }\r\n\r\n        // expand end open list\r\n\r\n        node = endOpenList.shift();\r\n        node.closed = true;\r\n\r\n        neighbors = grid.getNeighbors(node, diagonalMovement);\r\n        for (i = 0, l = neighbors.length; i < l; ++i) {\r\n            neighbor = neighbors[i];\r\n\r\n            if (neighbor.closed) {\r\n                continue;\r\n            }\r\n            if (neighbor.opened) {\r\n                if (neighbor.by === BY_START) {\r\n                    return Util.biBacktrace(neighbor, node);\r\n                }\r\n                continue;\r\n            }\r\n            endOpenList.push(neighbor);\r\n            neighbor.parent = node;\r\n            neighbor.opened = true;\r\n            neighbor.by = BY_END;\r\n        }\r\n    }\r\n\r\n    // fail to find the path\r\n    return [];\r\n};\r\n\r\nmodule.exports = BiBreadthFirstFinder;\r\n","var BiAStarFinder = require('./BiAStarFinder');\r\n\r\n/**\r\n * Bi-directional Dijkstra path-finder.\r\n * @constructor\r\n * @extends BiAStarFinder\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n */\r\nfunction BiDijkstraFinder(opt) {\r\n    BiAStarFinder.call(this, opt);\r\n    this.heuristic = function(dx, dy) {\r\n        return 0;\r\n    };\r\n}\r\n\r\nBiDijkstraFinder.prototype = new BiAStarFinder();\r\nBiDijkstraFinder.prototype.constructor = BiDijkstraFinder;\r\n\r\nmodule.exports = BiDijkstraFinder;\r\n","var Util       = require('../core/Util');\r\nvar Heuristic  = require('../core/Heuristic');\r\nvar Node       = require('../core/Node');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Iterative Deeping A Star (IDA*) path-finder.\r\n *\r\n * Recursion based on:\r\n *   http://www.apl.jhu.edu/~hall/AI-Programming/IDA-Star.html\r\n *\r\n * Path retracing based on:\r\n *  V. Nageshwara Rao, Vipin Kumar and K. Ramesh\r\n *  \"A Parallel Implementation of Iterative-Deeping-A*\", January 1987.\r\n *  ftp://ftp.cs.utexas.edu/.snapshot/hourly.1/pub/AI-Lab/tech-reports/UT-AI-TR-87-46.pdf\r\n *\r\n * @author Gerard Meier (www.gerardmeier.com)\r\n *\r\n * @constructor\r\n * @param {Object} opt\r\n * @param {boolean} opt.allowDiagonal Whether diagonal movement is allowed.\r\n *     Deprecated, use diagonalMovement instead.\r\n * @param {boolean} opt.dontCrossCorners Disallow diagonal movement touching\r\n *     block corners. Deprecated, use diagonalMovement instead.\r\n * @param {DiagonalMovement} opt.diagonalMovement Allowed diagonal movement.\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n * @param {number} opt.weight Weight to apply to the heuristic to allow for\r\n *     suboptimal paths, in order to speed up the search.\r\n * @param {boolean} opt.trackRecursion Whether to track recursion for\r\n *     statistical purposes.\r\n * @param {number} opt.timeLimit Maximum execution time. Use <= 0 for infinite.\r\n */\r\nfunction IDAStarFinder(opt) {\r\n    opt = opt || {};\r\n    this.allowDiagonal = opt.allowDiagonal;\r\n    this.dontCrossCorners = opt.dontCrossCorners;\r\n    this.diagonalMovement = opt.diagonalMovement;\r\n    this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    this.weight = opt.weight || 1;\r\n    this.trackRecursion = opt.trackRecursion || false;\r\n    this.timeLimit = opt.timeLimit || Infinity; // Default: no time limit.\r\n\r\n    if (!this.diagonalMovement) {\r\n        if (!this.allowDiagonal) {\r\n            this.diagonalMovement = DiagonalMovement.Never;\r\n        } else {\r\n            if (this.dontCrossCorners) {\r\n                this.diagonalMovement = DiagonalMovement.OnlyWhenNoObstacles;\r\n            } else {\r\n                this.diagonalMovement = DiagonalMovement.IfAtMostOneObstacle;\r\n            }\r\n        }\r\n    }\r\n\r\n    // When diagonal movement is allowed the manhattan heuristic is not\r\n    // admissible, it should be octile instead\r\n    if (this.diagonalMovement === DiagonalMovement.Never) {\r\n        this.heuristic = opt.heuristic || Heuristic.manhattan;\r\n    } else {\r\n        this.heuristic = opt.heuristic || Heuristic.octile;\r\n    }\r\n}\r\n\r\n/**\r\n * Find and return the the path. When an empty array is returned, either\r\n * no path is possible, or the maximum execution time is reached.\r\n *\r\n * @return {Array<Array<number>>} The path, including both start and\r\n *     end positions.\r\n */\r\nIDAStarFinder.prototype.findPath = function(startX, startY, endX, endY, grid) {\r\n    // Used for statistics:\r\n    var nodesVisited = 0;\r\n\r\n    // Execution time limitation:\r\n    var startTime = new Date().getTime();\r\n\r\n    // Heuristic helper:\r\n    var h = function(a, b) {\r\n        return this.heuristic(Math.abs(b.x - a.x), Math.abs(b.y - a.y));\r\n    }.bind(this);\r\n\r\n    // Step cost from a to b:\r\n    var cost = function(a, b) {\r\n        return (a.x === b.x || a.y === b.y) ? 1 : Math.SQRT2;\r\n    };\r\n\r\n    /**\r\n     * IDA* search implementation.\r\n     *\r\n     * @param {Node} The node currently expanding from.\r\n     * @param {number} Cost to reach the given node.\r\n     * @param {number} Maximum search depth (cut-off value).\r\n     * @param {Array<Array<number>>} The found route.\r\n     * @param {number} Recursion depth.\r\n     *\r\n     * @return {Object} either a number with the new optimal cut-off depth,\r\n     * or a valid node instance, in which case a path was found.\r\n     */\r\n    var search = function(node, g, cutoff, route, depth) {\r\n        nodesVisited++;\r\n\r\n        // Enforce timelimit:\r\n        if (this.timeLimit > 0 &&\r\n            new Date().getTime() - startTime > this.timeLimit * 1000) {\r\n            // Enforced as \"path-not-found\".\r\n            return Infinity;\r\n        }\r\n\r\n        var f = g + h(node, end) * this.weight;\r\n\r\n        // We've searched too deep for this iteration.\r\n        if (f > cutoff) {\r\n            return f;\r\n        }\r\n\r\n        if (node == end) {\r\n            route[depth] = [node.x, node.y];\r\n            return node;\r\n        }\r\n\r\n        var min, t, k, neighbour;\r\n\r\n        var neighbours = grid.getNeighbors(node, this.diagonalMovement);\r\n\r\n        // Sort the neighbours, gives nicer paths. But, this deviates\r\n        // from the original algorithm - so I left it out.\r\n        //neighbours.sort(function(a, b){\r\n        //    return h(a, end) - h(b, end);\r\n        //});\r\n\r\n        \r\n        /*jshint -W084 *///Disable warning: Expected a conditional expression and instead saw an assignment\r\n        for (k = 0, min = Infinity; neighbour = neighbours[k]; ++k) {\r\n        /*jshint +W084 *///Enable warning: Expected a conditional expression and instead saw an assignment\r\n            if (this.trackRecursion) {\r\n                // Retain a copy for visualisation. Due to recursion, this\r\n                // node may be part of other paths too.\r\n                neighbour.retainCount = neighbour.retainCount + 1 || 1;\r\n\r\n                if(neighbour.tested !== true) {\r\n                    neighbour.tested = true;\r\n                }\r\n            }\r\n\r\n            t = search(neighbour, g + cost(node, neighbour), cutoff, route, depth + 1);\r\n\r\n            if (t instanceof Node) {\r\n                route[depth] = [node.x, node.y];\r\n\r\n                // For a typical A* linked list, this would work:\r\n                // neighbour.parent = node;\r\n                return t;\r\n            }\r\n\r\n            // Decrement count, then determine whether it's actually closed.\r\n            if (this.trackRecursion && (--neighbour.retainCount) === 0) {\r\n                neighbour.tested = false;\r\n            }\r\n\r\n            if (t < min) {\r\n                min = t;\r\n            }\r\n        }\r\n\r\n        return min;\r\n\r\n    }.bind(this);\r\n\r\n    // Node instance lookups:\r\n    var start = grid.getNodeAt(startX, startY);\r\n    var end   = grid.getNodeAt(endX, endY);\r\n\r\n    // Initial search depth, given the typical heuristic contraints,\r\n    // there should be no cheaper route possible.\r\n    var cutOff = h(start, end);\r\n\r\n    var j, route, t;\r\n\r\n    // With an overflow protection.\r\n    for (j = 0; true; ++j) {\r\n\r\n        route = [];\r\n\r\n        // Search till cut-off depth:\r\n        t = search(start, 0, cutOff, route, 0);\r\n\r\n        // Route not possible, or not found in time limit.\r\n        if (t === Infinity) {\r\n            return [];\r\n        }\r\n\r\n        // If t is a node, it's also the end node. Route is now\r\n        // populated with a valid path to the end node.\r\n        if (t instanceof Node) {\r\n            return route;\r\n        }\r\n\r\n        // Try again, this time with a deeper cut-off. The t score\r\n        // is the closest we got to the end node.\r\n        cutOff = t;\r\n    }\r\n\r\n    // This _should_ never to be reached.\r\n    return [];\r\n};\r\n\r\nmodule.exports = IDAStarFinder;\r\n","/**\r\n * @author aniero / https://github.com/aniero\r\n */\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\nvar JPFNeverMoveDiagonally = require('./JPFNeverMoveDiagonally');\r\nvar JPFAlwaysMoveDiagonally = require('./JPFAlwaysMoveDiagonally');\r\nvar JPFMoveDiagonallyIfNoObstacles = require('./JPFMoveDiagonallyIfNoObstacles');\r\nvar JPFMoveDiagonallyIfAtMostOneObstacle = require('./JPFMoveDiagonallyIfAtMostOneObstacle');\r\n\r\n/**\r\n * Path finder using the Jump Point Search algorithm\r\n * @param {Object} opt\r\n * @param {function} opt.heuristic Heuristic function to estimate the distance\r\n *     (defaults to manhattan).\r\n * @param {DiagonalMovement} opt.diagonalMovement Condition under which diagonal\r\n *      movement will be allowed.\r\n */\r\nfunction JumpPointFinder(opt) {\r\n    opt = opt || {};\r\n    if (opt.diagonalMovement === DiagonalMovement.Never) {\r\n        return new JPFNeverMoveDiagonally(opt);\r\n    } else if (opt.diagonalMovement === DiagonalMovement.Always) {\r\n        return new JPFAlwaysMoveDiagonally(opt);\r\n    } else if (opt.diagonalMovement === DiagonalMovement.OnlyWhenNoObstacles) {\r\n        return new JPFMoveDiagonallyIfNoObstacles(opt);\r\n    } else {\r\n        return new JPFMoveDiagonallyIfAtMostOneObstacle(opt);\r\n    }\r\n}\r\n\r\nmodule.exports = JumpPointFinder;\r\n","/**\r\n * @author imor / https://github.com/imor\r\n */\r\nvar JumpPointFinderBase = require('./JumpPointFinderBase');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Path finder using the Jump Point Search algorithm allowing only horizontal\r\n * or vertical movements.\r\n */\r\nfunction JPFNeverMoveDiagonally(opt) {\r\n    JumpPointFinderBase.call(this, opt);\r\n}\r\n\r\nJPFNeverMoveDiagonally.prototype = new JumpPointFinderBase();\r\nJPFNeverMoveDiagonally.prototype.constructor = JPFNeverMoveDiagonally;\r\n\r\n/**\r\n * Search recursively in the direction (parent -> child), stopping only when a\r\n * jump point is found.\r\n * @protected\r\n * @return {Array<Array<number>>} The x, y coordinate of the jump point\r\n *     found, or null if not found\r\n */\r\nJPFNeverMoveDiagonally.prototype._jump = function(x, y, px, py) {\r\n    var grid = this.grid,\r\n        dx = x - px, dy = y - py;\r\n\r\n    if (!grid.isWalkableAt(x, y)) {\r\n        return null;\r\n    }\r\n\r\n    if(this.trackJumpRecursion === true) {\r\n        grid.getNodeAt(x, y).tested = true;\r\n    }\r\n\r\n    if (grid.getNodeAt(x, y) === this.endNode) {\r\n        return [x, y];\r\n    }\r\n\r\n    if (dx !== 0) {\r\n        if ((grid.isWalkableAt(x, y - 1) && !grid.isWalkableAt(x - dx, y - 1)) ||\r\n            (grid.isWalkableAt(x, y + 1) && !grid.isWalkableAt(x - dx, y + 1))) {\r\n            return [x, y];\r\n        }\r\n    }\r\n    else if (dy !== 0) {\r\n        if ((grid.isWalkableAt(x - 1, y) && !grid.isWalkableAt(x - 1, y - dy)) ||\r\n            (grid.isWalkableAt(x + 1, y) && !grid.isWalkableAt(x + 1, y - dy))) {\r\n            return [x, y];\r\n        }\r\n        //When moving vertically, must check for horizontal jump points\r\n        if (this._jump(x + 1, y, x, y) || this._jump(x - 1, y, x, y)) {\r\n            return [x, y];\r\n        }\r\n    }\r\n    else {\r\n        throw new Error(\"Only horizontal and vertical movements are allowed\");\r\n    }\r\n\r\n    return this._jump(x + dx, y + dy, x, y);\r\n};\r\n\r\n/**\r\n * Find the neighbors for the given node. If the node has a parent,\r\n * prune the neighbors based on the jump point search algorithm, otherwise\r\n * return all available neighbors.\r\n * @return {Array<Array<number>>} The neighbors found.\r\n */\r\nJPFNeverMoveDiagonally.prototype._findNeighbors = function(node) {\r\n    var parent = node.parent,\r\n        x = node.x, y = node.y,\r\n        grid = this.grid,\r\n        px, py, nx, ny, dx, dy,\r\n        neighbors = [], neighborNodes, neighborNode, i, l;\r\n\r\n    // directed pruning: can ignore most neighbors, unless forced.\r\n    if (parent) {\r\n        px = parent.x;\r\n        py = parent.y;\r\n        // get the normalized direction of travel\r\n        dx = (x - px) / Math.max(Math.abs(x - px), 1);\r\n        dy = (y - py) / Math.max(Math.abs(y - py), 1);\r\n\r\n        if (dx !== 0) {\r\n            if (grid.isWalkableAt(x, y - 1)) {\r\n                neighbors.push([x, y - 1]);\r\n            }\r\n            if (grid.isWalkableAt(x, y + 1)) {\r\n                neighbors.push([x, y + 1]);\r\n            }\r\n            if (grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y]);\r\n            }\r\n        }\r\n        else if (dy !== 0) {\r\n            if (grid.isWalkableAt(x - 1, y)) {\r\n                neighbors.push([x - 1, y]);\r\n            }\r\n            if (grid.isWalkableAt(x + 1, y)) {\r\n                neighbors.push([x + 1, y]);\r\n            }\r\n            if (grid.isWalkableAt(x, y + dy)) {\r\n                neighbors.push([x, y + dy]);\r\n            }\r\n        }\r\n    }\r\n    // return all neighbors\r\n    else {\r\n        neighborNodes = grid.getNeighbors(node, DiagonalMovement.Never);\r\n        for (i = 0, l = neighborNodes.length; i < l; ++i) {\r\n            neighborNode = neighborNodes[i];\r\n            neighbors.push([neighborNode.x, neighborNode.y]);\r\n        }\r\n    }\r\n\r\n    return neighbors;\r\n};\r\n\r\nmodule.exports = JPFNeverMoveDiagonally;\r\n","/**\r\n * @author imor / https://github.com/imor\r\n */\r\nvar JumpPointFinderBase = require('./JumpPointFinderBase');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Path finder using the Jump Point Search algorithm which always moves\r\n * diagonally irrespective of the number of obstacles.\r\n */\r\nfunction JPFAlwaysMoveDiagonally(opt) {\r\n    JumpPointFinderBase.call(this, opt);\r\n}\r\n\r\nJPFAlwaysMoveDiagonally.prototype = new JumpPointFinderBase();\r\nJPFAlwaysMoveDiagonally.prototype.constructor = JPFAlwaysMoveDiagonally;\r\n\r\n/**\r\n * Search recursively in the direction (parent -> child), stopping only when a\r\n * jump point is found.\r\n * @protected\r\n * @return {Array<Array<number>>} The x, y coordinate of the jump point\r\n *     found, or null if not found\r\n */\r\nJPFAlwaysMoveDiagonally.prototype._jump = function(x, y, px, py) {\r\n    var grid = this.grid,\r\n        dx = x - px, dy = y - py;\r\n\r\n    if (!grid.isWalkableAt(x, y)) {\r\n        return null;\r\n    }\r\n\r\n    if(this.trackJumpRecursion === true) {\r\n        grid.getNodeAt(x, y).tested = true;\r\n    }\r\n\r\n    if (grid.getNodeAt(x, y) === this.endNode) {\r\n        return [x, y];\r\n    }\r\n\r\n    // check for forced neighbors\r\n    // along the diagonal\r\n    if (dx !== 0 && dy !== 0) {\r\n        if ((grid.isWalkableAt(x - dx, y + dy) && !grid.isWalkableAt(x - dx, y)) ||\r\n            (grid.isWalkableAt(x + dx, y - dy) && !grid.isWalkableAt(x, y - dy))) {\r\n            return [x, y];\r\n        }\r\n        // when moving diagonally, must check for vertical/horizontal jump points\r\n        if (this._jump(x + dx, y, x, y) || this._jump(x, y + dy, x, y)) {\r\n            return [x, y];\r\n        }\r\n    }\r\n    // horizontally/vertically\r\n    else {\r\n        if( dx !== 0 ) { // moving along x\r\n            if((grid.isWalkableAt(x + dx, y + 1) && !grid.isWalkableAt(x, y + 1)) ||\r\n               (grid.isWalkableAt(x + dx, y - 1) && !grid.isWalkableAt(x, y - 1))) {\r\n                return [x, y];\r\n            }\r\n        }\r\n        else {\r\n            if((grid.isWalkableAt(x + 1, y + dy) && !grid.isWalkableAt(x + 1, y)) ||\r\n               (grid.isWalkableAt(x - 1, y + dy) && !grid.isWalkableAt(x - 1, y))) {\r\n                return [x, y];\r\n            }\r\n        }\r\n    }\r\n\r\n    return this._jump(x + dx, y + dy, x, y);\r\n};\r\n\r\n/**\r\n * Find the neighbors for the given node. If the node has a parent,\r\n * prune the neighbors based on the jump point search algorithm, otherwise\r\n * return all available neighbors.\r\n * @return {Array<Array<number>>} The neighbors found.\r\n */\r\nJPFAlwaysMoveDiagonally.prototype._findNeighbors = function(node) {\r\n    var parent = node.parent,\r\n        x = node.x, y = node.y,\r\n        grid = this.grid,\r\n        px, py, nx, ny, dx, dy,\r\n        neighbors = [], neighborNodes, neighborNode, i, l;\r\n\r\n    // directed pruning: can ignore most neighbors, unless forced.\r\n    if (parent) {\r\n        px = parent.x;\r\n        py = parent.y;\r\n        // get the normalized direction of travel\r\n        dx = (x - px) / Math.max(Math.abs(x - px), 1);\r\n        dy = (y - py) / Math.max(Math.abs(y - py), 1);\r\n\r\n        // search diagonally\r\n        if (dx !== 0 && dy !== 0) {\r\n            if (grid.isWalkableAt(x, y + dy)) {\r\n                neighbors.push([x, y + dy]);\r\n            }\r\n            if (grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y]);\r\n            }\r\n            if (grid.isWalkableAt(x + dx, y + dy)) {\r\n                neighbors.push([x + dx, y + dy]);\r\n            }\r\n            if (!grid.isWalkableAt(x - dx, y)) {\r\n                neighbors.push([x - dx, y + dy]);\r\n            }\r\n            if (!grid.isWalkableAt(x, y - dy)) {\r\n                neighbors.push([x + dx, y - dy]);\r\n            }\r\n        }\r\n        // search horizontally/vertically\r\n        else {\r\n            if(dx === 0) {\r\n                if (grid.isWalkableAt(x, y + dy)) {\r\n                    neighbors.push([x, y + dy]);\r\n                }\r\n                if (!grid.isWalkableAt(x + 1, y)) {\r\n                    neighbors.push([x + 1, y + dy]);\r\n                }\r\n                if (!grid.isWalkableAt(x - 1, y)) {\r\n                    neighbors.push([x - 1, y + dy]);\r\n                }\r\n            }\r\n            else {\r\n                if (grid.isWalkableAt(x + dx, y)) {\r\n                    neighbors.push([x + dx, y]);\r\n                }\r\n                if (!grid.isWalkableAt(x, y + 1)) {\r\n                    neighbors.push([x + dx, y + 1]);\r\n                }\r\n                if (!grid.isWalkableAt(x, y - 1)) {\r\n                    neighbors.push([x + dx, y - 1]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // return all neighbors\r\n    else {\r\n        neighborNodes = grid.getNeighbors(node, DiagonalMovement.Always);\r\n        for (i = 0, l = neighborNodes.length; i < l; ++i) {\r\n            neighborNode = neighborNodes[i];\r\n            neighbors.push([neighborNode.x, neighborNode.y]);\r\n        }\r\n    }\r\n\r\n    return neighbors;\r\n};\r\n\r\nmodule.exports = JPFAlwaysMoveDiagonally;\r\n","/**\r\n * @author imor / https://github.com/imor\r\n */\r\nvar JumpPointFinderBase = require('./JumpPointFinderBase');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Path finder using the Jump Point Search algorithm which moves\r\n * diagonally only when there are no obstacles.\r\n */\r\nfunction JPFMoveDiagonallyIfNoObstacles(opt) {\r\n    JumpPointFinderBase.call(this, opt);\r\n}\r\n\r\nJPFMoveDiagonallyIfNoObstacles.prototype = new JumpPointFinderBase();\r\nJPFMoveDiagonallyIfNoObstacles.prototype.constructor = JPFMoveDiagonallyIfNoObstacles;\r\n\r\n/**\r\n * Search recursively in the direction (parent -> child), stopping only when a\r\n * jump point is found.\r\n * @protected\r\n * @return {Array<Array<number>>} The x, y coordinate of the jump point\r\n *     found, or null if not found\r\n */\r\nJPFMoveDiagonallyIfNoObstacles.prototype._jump = function(x, y, px, py) {\r\n    var grid = this.grid,\r\n        dx = x - px, dy = y - py;\r\n\r\n    if (!grid.isWalkableAt(x, y)) {\r\n        return null;\r\n    }\r\n\r\n    if(this.trackJumpRecursion === true) {\r\n        grid.getNodeAt(x, y).tested = true;\r\n    }\r\n\r\n    if (grid.getNodeAt(x, y) === this.endNode) {\r\n        return [x, y];\r\n    }\r\n\r\n    // check for forced neighbors\r\n    // along the diagonal\r\n    if (dx !== 0 && dy !== 0) {\r\n        // if ((grid.isWalkableAt(x - dx, y + dy) && !grid.isWalkableAt(x - dx, y)) ||\r\n            // (grid.isWalkableAt(x + dx, y - dy) && !grid.isWalkableAt(x, y - dy))) {\r\n            // return [x, y];\r\n        // }\r\n        // when moving diagonally, must check for vertical/horizontal jump points\r\n        if (this._jump(x + dx, y, x, y) || this._jump(x, y + dy, x, y)) {\r\n            return [x, y];\r\n        }\r\n    }\r\n    // horizontally/vertically\r\n    else {\r\n        if (dx !== 0) {\r\n            if ((grid.isWalkableAt(x, y - 1) && !grid.isWalkableAt(x - dx, y - 1)) ||\r\n                (grid.isWalkableAt(x, y + 1) && !grid.isWalkableAt(x - dx, y + 1))) {\r\n                return [x, y];\r\n            }\r\n        }\r\n        else if (dy !== 0) {\r\n            if ((grid.isWalkableAt(x - 1, y) && !grid.isWalkableAt(x - 1, y - dy)) ||\r\n                (grid.isWalkableAt(x + 1, y) && !grid.isWalkableAt(x + 1, y - dy))) {\r\n                return [x, y];\r\n            }\r\n            // When moving vertically, must check for horizontal jump points\r\n            // if (this._jump(x + 1, y, x, y) || this._jump(x - 1, y, x, y)) {\r\n                // return [x, y];\r\n            // }\r\n        }\r\n    }\r\n\r\n    // moving diagonally, must make sure one of the vertical/horizontal\r\n    // neighbors is open to allow the path\r\n    if (grid.isWalkableAt(x + dx, y) && grid.isWalkableAt(x, y + dy)) {\r\n        return this._jump(x + dx, y + dy, x, y);\r\n    } else {\r\n        return null;\r\n    }\r\n};\r\n\r\n/**\r\n * Find the neighbors for the given node. If the node has a parent,\r\n * prune the neighbors based on the jump point search algorithm, otherwise\r\n * return all available neighbors.\r\n * @return {Array<Array<number>>} The neighbors found.\r\n */\r\nJPFMoveDiagonallyIfNoObstacles.prototype._findNeighbors = function(node) {\r\n    var parent = node.parent,\r\n        x = node.x, y = node.y,\r\n        grid = this.grid,\r\n        px, py, nx, ny, dx, dy,\r\n        neighbors = [], neighborNodes, neighborNode, i, l;\r\n\r\n    // directed pruning: can ignore most neighbors, unless forced.\r\n    if (parent) {\r\n        px = parent.x;\r\n        py = parent.y;\r\n        // get the normalized direction of travel\r\n        dx = (x - px) / Math.max(Math.abs(x - px), 1);\r\n        dy = (y - py) / Math.max(Math.abs(y - py), 1);\r\n\r\n        // search diagonally\r\n        if (dx !== 0 && dy !== 0) {\r\n            if (grid.isWalkableAt(x, y + dy)) {\r\n                neighbors.push([x, y + dy]);\r\n            }\r\n            if (grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y]);\r\n            }\r\n            if (grid.isWalkableAt(x, y + dy) && grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y + dy]);\r\n            }\r\n        }\r\n        // search horizontally/vertically\r\n        else {\r\n            var isNextWalkable;\r\n            if (dx !== 0) {\r\n                isNextWalkable = grid.isWalkableAt(x + dx, y);\r\n                var isTopWalkable = grid.isWalkableAt(x, y + 1);\r\n                var isBottomWalkable = grid.isWalkableAt(x, y - 1);\r\n\r\n                if (isNextWalkable) {\r\n                    neighbors.push([x + dx, y]);\r\n                    if (isTopWalkable) {\r\n                        neighbors.push([x + dx, y + 1]);\r\n                    }\r\n                    if (isBottomWalkable) {\r\n                        neighbors.push([x + dx, y - 1]);\r\n                    }\r\n                }\r\n                if (isTopWalkable) {\r\n                    neighbors.push([x, y + 1]);\r\n                }\r\n                if (isBottomWalkable) {\r\n                    neighbors.push([x, y - 1]);\r\n                }\r\n            }\r\n            else if (dy !== 0) {\r\n                isNextWalkable = grid.isWalkableAt(x, y + dy);\r\n                var isRightWalkable = grid.isWalkableAt(x + 1, y);\r\n                var isLeftWalkable = grid.isWalkableAt(x - 1, y);\r\n\r\n                if (isNextWalkable) {\r\n                    neighbors.push([x, y + dy]);\r\n                    if (isRightWalkable) {\r\n                        neighbors.push([x + 1, y + dy]);\r\n                    }\r\n                    if (isLeftWalkable) {\r\n                        neighbors.push([x - 1, y + dy]);\r\n                    }\r\n                }\r\n                if (isRightWalkable) {\r\n                    neighbors.push([x + 1, y]);\r\n                }\r\n                if (isLeftWalkable) {\r\n                    neighbors.push([x - 1, y]);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // return all neighbors\r\n    else {\r\n        neighborNodes = grid.getNeighbors(node, DiagonalMovement.OnlyWhenNoObstacles);\r\n        for (i = 0, l = neighborNodes.length; i < l; ++i) {\r\n            neighborNode = neighborNodes[i];\r\n            neighbors.push([neighborNode.x, neighborNode.y]);\r\n        }\r\n    }\r\n\r\n    return neighbors;\r\n};\r\n\r\nmodule.exports = JPFMoveDiagonallyIfNoObstacles;\r\n","/**\r\n * @author imor / https://github.com/imor\r\n */\r\nvar JumpPointFinderBase = require('./JumpPointFinderBase');\r\nvar DiagonalMovement = require('../core/DiagonalMovement');\r\n\r\n/**\r\n * Path finder using the Jump Point Search algorithm which moves\r\n * diagonally only when there is at most one obstacle.\r\n */\r\nfunction JPFMoveDiagonallyIfAtMostOneObstacle(opt) {\r\n    JumpPointFinderBase.call(this, opt);\r\n}\r\n\r\nJPFMoveDiagonallyIfAtMostOneObstacle.prototype = new JumpPointFinderBase();\r\nJPFMoveDiagonallyIfAtMostOneObstacle.prototype.constructor = JPFMoveDiagonallyIfAtMostOneObstacle;\r\n\r\n/**\r\n * Search recursively in the direction (parent -> child), stopping only when a\r\n * jump point is found.\r\n * @protected\r\n * @return {Array<Array<number>>} The x, y coordinate of the jump point\r\n *     found, or null if not found\r\n */\r\nJPFMoveDiagonallyIfAtMostOneObstacle.prototype._jump = function(x, y, px, py) {\r\n    var grid = this.grid,\r\n        dx = x - px, dy = y - py;\r\n\r\n    if (!grid.isWalkableAt(x, y)) {\r\n        return null;\r\n    }\r\n\r\n    if(this.trackJumpRecursion === true) {\r\n        grid.getNodeAt(x, y).tested = true;\r\n    }\r\n\r\n    if (grid.getNodeAt(x, y) === this.endNode) {\r\n        return [x, y];\r\n    }\r\n\r\n    // check for forced neighbors\r\n    // along the diagonal\r\n    if (dx !== 0 && dy !== 0) {\r\n        if ((grid.isWalkableAt(x - dx, y + dy) && !grid.isWalkableAt(x - dx, y)) ||\r\n            (grid.isWalkableAt(x + dx, y - dy) && !grid.isWalkableAt(x, y - dy))) {\r\n            return [x, y];\r\n        }\r\n        // when moving diagonally, must check for vertical/horizontal jump points\r\n        if (this._jump(x + dx, y, x, y) || this._jump(x, y + dy, x, y)) {\r\n            return [x, y];\r\n        }\r\n    }\r\n    // horizontally/vertically\r\n    else {\r\n        if( dx !== 0 ) { // moving along x\r\n            if((grid.isWalkableAt(x + dx, y + 1) && !grid.isWalkableAt(x, y + 1)) ||\r\n               (grid.isWalkableAt(x + dx, y - 1) && !grid.isWalkableAt(x, y - 1))) {\r\n                return [x, y];\r\n            }\r\n        }\r\n        else {\r\n            if((grid.isWalkableAt(x + 1, y + dy) && !grid.isWalkableAt(x + 1, y)) ||\r\n               (grid.isWalkableAt(x - 1, y + dy) && !grid.isWalkableAt(x - 1, y))) {\r\n                return [x, y];\r\n            }\r\n        }\r\n    }\r\n\r\n    // moving diagonally, must make sure one of the vertical/horizontal\r\n    // neighbors is open to allow the path\r\n    if (grid.isWalkableAt(x + dx, y) || grid.isWalkableAt(x, y + dy)) {\r\n        return this._jump(x + dx, y + dy, x, y);\r\n    } else {\r\n        return null;\r\n    }\r\n};\r\n\r\n/**\r\n * Find the neighbors for the given node. If the node has a parent,\r\n * prune the neighbors based on the jump point search algorithm, otherwise\r\n * return all available neighbors.\r\n * @return {Array<Array<number>>} The neighbors found.\r\n */\r\nJPFMoveDiagonallyIfAtMostOneObstacle.prototype._findNeighbors = function(node) {\r\n    var parent = node.parent,\r\n        x = node.x, y = node.y,\r\n        grid = this.grid,\r\n        px, py, nx, ny, dx, dy,\r\n        neighbors = [], neighborNodes, neighborNode, i, l;\r\n\r\n    // directed pruning: can ignore most neighbors, unless forced.\r\n    if (parent) {\r\n        px = parent.x;\r\n        py = parent.y;\r\n        // get the normalized direction of travel\r\n        dx = (x - px) / Math.max(Math.abs(x - px), 1);\r\n        dy = (y - py) / Math.max(Math.abs(y - py), 1);\r\n\r\n        // search diagonally\r\n        if (dx !== 0 && dy !== 0) {\r\n            if (grid.isWalkableAt(x, y + dy)) {\r\n                neighbors.push([x, y + dy]);\r\n            }\r\n            if (grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y]);\r\n            }\r\n            if (grid.isWalkableAt(x, y + dy) || grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y + dy]);\r\n            }\r\n            if (!grid.isWalkableAt(x - dx, y) && grid.isWalkableAt(x, y + dy)) {\r\n                neighbors.push([x - dx, y + dy]);\r\n            }\r\n            if (!grid.isWalkableAt(x, y - dy) && grid.isWalkableAt(x + dx, y)) {\r\n                neighbors.push([x + dx, y - dy]);\r\n            }\r\n        }\r\n        // search horizontally/vertically\r\n        else {\r\n            if(dx === 0) {\r\n                if (grid.isWalkableAt(x, y + dy)) {\r\n                    neighbors.push([x, y + dy]);\r\n                    if (!grid.isWalkableAt(x + 1, y)) {\r\n                        neighbors.push([x + 1, y + dy]);\r\n                    }\r\n                    if (!grid.isWalkableAt(x - 1, y)) {\r\n                        neighbors.push([x - 1, y + dy]);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (grid.isWalkableAt(x + dx, y)) {\r\n                    neighbors.push([x + dx, y]);\r\n                    if (!grid.isWalkableAt(x, y + 1)) {\r\n                        neighbors.push([x + dx, y + 1]);\r\n                    }\r\n                    if (!grid.isWalkableAt(x, y - 1)) {\r\n                        neighbors.push([x + dx, y - 1]);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // return all neighbors\r\n    else {\r\n        neighborNodes = grid.getNeighbors(node, DiagonalMovement.IfAtMostOneObstacle);\r\n        for (i = 0, l = neighborNodes.length; i < l; ++i) {\r\n            neighborNode = neighborNodes[i];\r\n            neighbors.push([neighborNode.x, neighborNode.y]);\r\n        }\r\n    }\r\n\r\n    return neighbors;\r\n};\r\n\r\nmodule.exports = JPFMoveDiagonallyIfAtMostOneObstacle;\r\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nvar _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();\n\nvar _geom = require('./geom');\n\nvar Path = function Path(init) {\n  var _instructions = init || [];\n\n  var push = function push(arr, el) {\n    var copy = arr.slice(0, arr.length);\n    copy.push(el);\n    return copy;\n  };\n\n  var areEqualPoints = function areEqualPoints(_ref, _ref3) {\n    var _ref2 = _slicedToArray(_ref, 2);\n\n    var a1 = _ref2[0];\n    var b1 = _ref2[1];\n\n    var _ref32 = _slicedToArray(_ref3, 2);\n\n    var a2 = _ref32[0];\n    var b2 = _ref32[1];\n    return a1 === a2 && b1 === b2;\n  };\n\n  var trimZeros = function trimZeros(string, char) {\n    var l = string.length;\n    while (string.charAt(l - 1) === '0') {\n      l = l - 1;\n    }\n    if (string.charAt(l - 1) === '.') {\n      l = l - 1;\n    }\n    return string.substr(0, l);\n  };\n\n  var round = function round(number, digits) {\n    var str = number.toFixed(digits);\n    return trimZeros(str);\n  };\n\n  var printInstrunction = function printInstrunction(_ref4) {\n    var command = _ref4.command;\n    var params = _ref4.params;\n\n    var numbers = params.map(function (param) {\n      return round(param, 6);\n    });\n    return command + ' ' + numbers.join(' ');\n  };\n\n  var point = function point(_ref5, prev) {\n    var command = _ref5.command;\n    var params = _ref5.params;\n\n    switch (command) {\n      case 'M':\n        return [params[0], params[1]];\n      case 'L':\n        return [params[0], params[1]];\n      case 'H':\n        return [params[0], prev[1]];\n      case 'V':\n        return [prev[0], params[0]];\n      case 'Z':\n        return null;\n      case 'C':\n        return [params[4], params[5]];\n      case 'S':\n        return [params[2], params[3]];\n      case 'Q':\n        return [params[2], params[3]];\n      case 'T':\n        return [params[0], params[1]];\n      case 'A':\n        return [params[5], params[6]];\n    }\n  };\n\n  var transformParams = function transformParams(instruction, matrix, prev) {\n    var p = instruction.params;\n\n    var transformer = {\n      'V': function V(instruction, matrix, prev) {\n        var pts = [{ x: prev[0], y: p[1] }];\n        var newPts = (0, _geom.matrixTransform)(pts, matrix);\n        if (newPts[0].x === (0, _geom.matrixTransform)([{ x: prev[0], y: prev[1] }])[0].x) {\n          return {\n            command: 'V',\n            params: [newPts[0].y]\n          };\n        } else {\n          return {\n            command: 'L',\n            params: [newPts[0].x, newPts[0].y]\n          };\n        }\n      },\n      'H': function H(instruction, matrix, prev) {\n        var pts = [{ x: p[0], y: prev[1] }];\n        var newPts = (0, _geom.matrixTransform)(pts, matrix);\n        if (newPts[0].y === (0, _geom.matrixTransform)([{ x: prev[0], y: prev[1] }])[0].y) {\n          return {\n            command: 'H',\n            params: [newPts[0].x]\n          };\n        } else {\n          return {\n            command: 'L',\n            params: [newPts[0].x, newPts[0].y]\n          };\n        }\n      },\n      'A': function A(instruction, matrix, prev) {\n        // transform rx, ry, and x-axis rotation\n        var r = (0, _geom.transformEllipse)(p[0], p[1], p[2], matrix);\n\n        var sweepFlag = p[4];\n        if (matrix[0] * matrix[3] - matrix[1] * matrix[2] < 0) {\n          sweepFlag = sweepFlag ? '0' : '1';\n        }\n\n        // transform endpoint\n        var pts = [{ x: p[5], y: p[6] }];\n        var newPts = (0, _geom.matrixTransform)(pts, matrix);\n\n        if (r.isDegenerate) {\n          return {\n            command: 'L',\n            params: [newPts[0].x, newPts[0].y]\n          };\n        } else {\n          return {\n            command: 'A',\n            params: [r.rx, r.ry, r.ax, p[3], sweepFlag, newPts[0].x, newPts[0].y]\n          };\n        }\n      },\n      'C': function C(instruction, matrix, prev) {\n        var pts = [{ x: p[0], y: p[1] }, { x: p[2], y: p[3] }, { x: p[4], y: p[5] }];\n        var newPts = (0, _geom.matrixTransform)(pts, matrix);\n        return {\n          command: 'C',\n          params: [newPts[0].x, newPts[0].y, newPts[1].x, newPts[1].y, newPts[2].x, newPts[2].y]\n        };\n      },\n      'Z': function Z(instruction, matrix, prev) {\n        return {\n          command: 'Z',\n          params: []\n        };\n      },\n      'default': function _default(instruction, matrix, prev) {\n        var pts = [{ x: p[0], y: p[1] }];\n        var newPts = (0, _geom.matrixTransform)(pts, matrix);\n        var newParams = instruction.params.slice(0, instruction.params.length);\n        newParams.splice(0, 2, newPts[0].x, newPts[0].y);\n        return {\n          command: instruction.command,\n          params: newParams\n        };\n      }\n    };\n\n    if (transformer[instruction.command]) {\n      return transformer[instruction.command](instruction, matrix, prev);\n    } else {\n      return transformer['default'](instruction, matrix, prev);\n    }\n  };\n\n  var verbosify = function verbosify(keys, f) {\n    return function (a) {\n      var args = typeof a === 'object' ? keys.map(function (k) {\n        return a[k];\n      }) : arguments;\n      return f.apply(null, args);\n    };\n  };\n\n  var plus = function plus(instruction) {\n    return Path(push(_instructions, instruction));\n  };\n\n  return {\n    moveto: verbosify(['x', 'y'], function (x, y) {\n      return plus({\n        command: 'M',\n        params: [x, y]\n      });\n    }),\n    lineto: verbosify(['x', 'y'], function (x, y) {\n      return plus({\n        command: 'L',\n        params: [x, y]\n      });\n    }),\n    hlineto: verbosify(['x'], function (x) {\n      return plus({\n        command: 'H',\n        params: [x]\n      });\n    }),\n    vlineto: verbosify(['y'], function (y) {\n      return plus({\n        command: 'V',\n        params: [y]\n      });\n    }),\n    closepath: function closepath() {\n      return plus({\n        command: 'Z',\n        params: []\n      });\n    },\n    curveto: verbosify(['x1', 'y1', 'x2', 'y2', 'x', 'y'], function (x1, y1, x2, y2, x, y) {\n      return plus({\n        command: 'C',\n        params: [x1, y1, x2, y2, x, y]\n      });\n    }),\n    smoothcurveto: verbosify(['x2', 'y2', 'x', 'y'], function (x2, y2, x, y) {\n      return plus({\n        command: 'S',\n        params: [x2, y2, x, y]\n      });\n    }),\n    qcurveto: verbosify(['x1', 'y1', 'x', 'y'], function (x1, y1, x, y) {\n      return plus({\n        command: 'Q',\n        params: [x1, y1, x, y]\n      });\n    }),\n    smoothqcurveto: verbosify(['x', 'y'], function (x, y) {\n      return plus({\n        command: 'T',\n        params: [x, y]\n      });\n    }),\n    arc: verbosify(['rx', 'ry', 'xrot', 'largeArcFlag', 'sweepFlag', 'x', 'y'], function (rx, ry, xrot, largeArcFlag, sweepFlag, x, y) {\n      return plus({\n        command: 'A',\n        params: [rx, ry, xrot, largeArcFlag, sweepFlag, x, y]\n      });\n    }),\n    translate: verbosify(['dx', 'dy'], function () {\n      var dx = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];\n      var dy = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n      if (dx !== 0 || dx !== 0) {\n        var _ret = (function () {\n          var prev = [0, 0];\n          var matrix = [1, 0, 0, 1, dx, dy];\n          var newInstructions = _instructions.map(function (instruction) {\n            var p = transformParams(instruction, matrix, prev);\n            prev = point(instruction, prev);\n            return p;\n          });\n          return {\n            v: Path(newInstructions)\n          };\n        })();\n\n        if (typeof _ret === 'object') return _ret.v;\n      } else {\n        return Path(_instructions);\n      }\n    }),\n    rotate: verbosify(['angle', 'rx', 'ry'], function (angle) {\n      var rx = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n      var ry = arguments.length <= 2 || arguments[2] === undefined ? 0 : arguments[2];\n\n      if (angle !== 0) {\n        var _ret2 = (function () {\n          var prev = undefined;\n          var matrix = undefined;\n          var newInstructions = _instructions;\n\n          if (rx !== 0 && ry !== 0) {\n            prev = [0, 0];\n            matrix = [1, 0, 0, 1, -rx, -ry];\n            newInstructions = newInstructions.map(function (instruction) {\n              var p = transformParams(instruction, matrix, prev);\n              prev = point(instruction, prev);\n              return p;\n            });\n          }\n\n          var rad = angle * Math.PI / 180;\n          var cos = Math.cos(rad);\n          var sin = Math.sin(rad);\n\n          prev = [0, 0];\n          matrix = [cos, sin, -sin, cos, 0, 0];\n          newInstructions = newInstructions.map(function (instruction) {\n            var p = transformParams(instruction, matrix, prev);\n            prev = point(instruction, prev);\n            return p;\n          });\n\n          if (rx !== 0 && ry !== 0) {\n            prev = [0, 0];\n            matrix = [1, 0, 0, 1, rx, ry];\n            newInstructions = newInstructions.map(function (instruction) {\n              var p = transformParams(instruction, matrix, prev);\n              prev = point(instruction, prev);\n              return p;\n            });\n          }\n\n          return {\n            v: Path(newInstructions)\n          };\n        })();\n\n        if (typeof _ret2 === 'object') return _ret2.v;\n      } else {\n        return Path(_instructions);\n      }\n    }),\n    scale: verbosify(['sx', 'sy'], function () {\n      var sx = arguments.length <= 0 || arguments[0] === undefined ? 1 : arguments[0];\n      var sy = arguments.length <= 1 || arguments[1] === undefined ? sx : arguments[1];\n      return (function () {\n        if (sx !== 1 || sy !== 1) {\n          var _ret3 = (function () {\n            var prev = [0, 0];\n            var matrix = [sx, 0, 0, sy, 0, 0];\n            var newInstructions = _instructions.map(function (instruction) {\n              var p = transformParams(instruction, matrix, prev);\n              prev = point(instruction, prev);\n              return p;\n            });\n            return {\n              v: Path(newInstructions)\n            };\n          })();\n\n          if (typeof _ret3 === 'object') return _ret3.v;\n        } else {\n          return Path(_instructions);\n        }\n      })();\n    }),\n    shearX: verbosify(['angle'], function () {\n      var angle = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];\n\n      if (angle !== 0) {\n        var _ret4 = (function () {\n          var prev = [0, 0];\n          var matrix = [1, 0, Math.tan(angle * Math.PI / 180), 1, 0, 0];\n          var newInstructions = _instructions.map(function (instruction) {\n            var p = transformParams(instruction, matrix, prev);\n            prev = point(instruction, prev);\n            return p;\n          });\n          return {\n            v: Path(newInstructions)\n          };\n        })();\n\n        if (typeof _ret4 === 'object') return _ret4.v;\n      } else {\n        return Path(_instructions);\n      }\n    }),\n    shearY: verbosify(['angle'], function () {\n      var angle = arguments.length <= 0 || arguments[0] === undefined ? 0 : arguments[0];\n\n      if (angle !== 0) {\n        var _ret5 = (function () {\n          var prev = [0, 0];\n          var matrix = [1, Math.tan(angle * Math.PI / 180), 0, 1, 0, 0];\n          var newInstructions = _instructions.map(function (instruction) {\n            var p = transformParams(instruction, matrix, prev);\n            prev = point(instruction, prev);\n            return p;\n          });\n          return {\n            v: Path(newInstructions)\n          };\n        })();\n\n        if (typeof _ret5 === 'object') return _ret5.v;\n      } else {\n        return Path(_instructions);\n      }\n    }),\n    print: function print() {\n      return _instructions.map(printInstrunction).join(' ');\n    },\n    toString: function toString() {\n      return undefined.print();\n    },\n    points: function points() {\n      var ps = [];\n      var prev = [0, 0];\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = _instructions[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var instruction = _step.value;\n\n          var p = point(instruction, prev);\n          prev = p;\n          if (p) {\n            ps.push(p);\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator['return']) {\n            _iterator['return']();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      return ps;\n    },\n    instructions: function instructions() {\n      return _instructions.slice(0, _instructions.length);\n    },\n    connect: function connect(path) {\n      var ps = this.points();\n      var last = ps[ps.length - 1];\n      var first = path.points()[0];\n      var newInstructions = undefined;\n      if (_instructions[_instructions.length - 1].command !== 'Z') {\n        newInstructions = path.instructions().slice(1);\n        if (!areEqualPoints(last, first)) {\n          newInstructions.unshift({\n            command: \"L\",\n            params: first\n          });\n        }\n      } else {\n        newInstructions = path.instructions();\n      }\n      return Path(this.instructions().concat(newInstructions));\n    }\n  };\n};\n\nexports['default'] = function () {\n  return Path();\n};\n\nmodule.exports = exports['default'];","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; })();\n\nvar sq = function sq(x) {\n  return x * x;\n};\n\nvar distPointToPoint = function distPointToPoint(_ref, _ref3) {\n  var _ref2 = _slicedToArray(_ref, 2);\n\n  var ax = _ref2[0];\n  var ay = _ref2[1];\n\n  var _ref32 = _slicedToArray(_ref3, 2);\n\n  var bx = _ref32[0];\n  var by = _ref32[1];\n  return Math.sqrt(sq(ax - bx) + sq(ay - by));\n};\n\nvar distPointToParabol = function distPointToParabol(a, f) {\n  var p = distPointToPoint(a, f);\n\n  return p == 0 ? Infinity : sq(p) / (2 * Math.abs(a[1] - f[1]));\n};\n\nvar circumCenter = function circumCenter(a, b, c) {\n  var d = (a[0] - c[0]) * (b[1] - c[1]) - (b[0] - c[0]) * (a[1] - c[1]);\n\n  if (d == 0) return [Infinity, Infinity];\n\n  var xc = (((a[0] - c[0]) * (a[0] + c[0]) + (a[1] - c[1]) * (a[1] + c[1])) / 2 * (b[1] - c[1]) - ((b[0] - c[0]) * (b[0] + c[0]) + (b[1] - c[1]) * (b[1] + c[1])) / 2 * (a[1] - c[1])) / d;\n  var yc = (((b[0] - c[0]) * (b[0] + c[0]) + (b[1] - c[1]) * (b[1] + c[1])) / 2 * (a[0] - c[0]) - ((a[0] - c[0]) * (a[0] + c[0]) + (a[1] - c[1]) * (a[1] + c[1])) / 2 * (b[0] - c[0])) / d;\n  return [xc, yc];\n};\n\nvar parabolsCrossX = function parabolsCrossX(fa, fb, q) {\n  if (fa[1] === fb[1]) return [(fa[0] + fb[0]) / 2, (fa[0] + fb[0]) / 2];\n\n  var s1 = (fa[1] * fb[0] - fa[0] * fb[1] + fa[0] * q - fb[0] * q + Math.sqrt((fa[0] * fa[0] + fa[1] * fa[1] - 2 * fa[0] * fb[0] + fb[0] * fb[0] - 2 * fa[1] * fb[1] + fb[1] * fb[1]) * (fa[1] * fb[1] - fa[1] * q - fb[1] * q + q * q))) / (fa[1] - fb[1]);\n  var s2 = (fa[1] * fb[0] - fa[0] * fb[1] + fa[0] * q - fb[0] * q - Math.sqrt((fa[0] * fa[0] + fa[1] * fa[1] - 2 * fa[0] * fb[0] + fb[0] * fb[0] - 2 * fa[1] * fb[1] + fb[1] * fb[1]) * (fa[1] * fb[1] - fa[1] * q - fb[1] * q + q * q))) / (fa[1] - fb[1]);\n\n  return s1 < s2 ? [s1, s2] : [s2, s1];\n};\n\nvar doHalflinesCross = function doHalflinesCross(sa, sb) {\n  var approx = arguments.length <= 2 || arguments[2] === undefined ? 1e-10 : arguments[2];\n  //sa, sb are Segment instance\n  var dx = sb.ps[0] - sa.ps[0];\n  var dy = sb.ps[1] - sa.ps[1];\n\n  if (sa.m == Infinity) return sa.hp * (sb.m * dx - dy) <= approx && sb.vec[0] * dx <= approx;\n  if (sb.m == Infinity) return sb.hp * (sa.m * dx - dy) >= -approx && sa.vec[0] * dx >= -approx;\n\n  var det = sb.vec[0] * sa.vec[1] - sb.vec[1] * sa.vec[0];\n\n  if (det === 0) return false;\n\n  var u = (dy * sb.vec[0] - dx * sb.vec[1]) / det;\n  var v = (dy * sa.vec[0] - dx * sa.vec[1]) / det;\n\n  return u >= -approx && v >= approx || u >= approx && v >= -approx;\n};\n\nvar matrixTransform = function matrixTransform(points, matrix) {\n  return points.map(function (point) {\n    return {\n      x: point.x * matrix[0] + point.y * matrix[2] + matrix[4],\n      y: point.x * matrix[1] + point.y * matrix[3] + matrix[5]\n    };\n  });\n};\n\nvar transformEllipse = function transformEllipse(rx, ry, ax, m) {\n  var torad = Math.PI / 180;\n  var epsilon = 0.0000000001;\n\n  var c = Math.cos(ax * torad),\n      s = Math.sin(ax * torad);\n  var ma = [rx * (m[0] * c + m[2] * s), rx * (m[1] * c + m[3] * s), ry * (-m[0] * s + m[2] * c), ry * (-m[1] * s + m[3] * c)];\n\n  var J = ma[0] * ma[0] + ma[2] * ma[2],\n      K = ma[1] * ma[1] + ma[3] * ma[3];\n\n  var D = ((ma[0] - ma[3]) * (ma[0] - ma[3]) + (ma[2] + ma[1]) * (ma[2] + ma[1])) * ((ma[0] + ma[3]) * (ma[0] + ma[3]) + (ma[2] - ma[1]) * (ma[2] - ma[1]));\n\n  var JK = (J + K) / 2;\n\n  if (D < epsilon * JK) {\n    return {\n      rx: Math.sqrt(JK),\n      ry: Math.sqrt(JK),\n      ax: 0,\n      isDegenerate: false\n    };\n  }\n\n  var L = ma[0] * ma[1] + ma[2] * ma[3];\n  D = Math.sqrt(D);\n\n  var l1 = JK + D / 2,\n      l2 = JK - D / 2;\n\n  var newAx = undefined,\n      newRx = undefined,\n      newRy = undefined;\n  newAx = Math.abs(L) < epsilon && Math.abs(l1 - K) < epsilon ? 90 : Math.atan(Math.abs(L) > Math.abs(l1 - K) ? (l1 - J) / L : L / (l1 - K)) * 180 / Math.PI;\n\n  if (newAx >= 0) {\n    newRx = Math.sqrt(l1);\n    newRy = Math.sqrt(l2);\n  } else {\n    newAx += 90;\n    newRx = Math.sqrt(l2);\n    newRy = Math.sqrt(l1);\n  }\n\n  return {\n    rx: newRx,\n    ry: newRy,\n    ax: newAx,\n    isDegenerate: newRx < epsilon * newRy || newRy < epsilon * newRx\n  };\n};\n\nexports[\"default\"] = { distPointToPoint: distPointToPoint, distPointToParabol: distPointToParabol, circumCenter: circumCenter,\n  parabolsCrossX: parabolsCrossX, doHalflinesCross: doHalflinesCross, matrixTransform: matrixTransform, transformEllipse: transformEllipse };\nmodule.exports = exports[\"default\"];","import { BaseEntity, BaseListener } from \"./BaseEntity\";\nimport { DiagramModel } from \"./models/DiagramModel\";\nimport * as _ from \"lodash\";\nimport { BaseModel, BaseModelListener } from \"./models/BaseModel\";\nimport { NodeModel } from \"./models/NodeModel\";\nimport { PointModel } from \"./models/PointModel\";\nimport { PortModel } from \"./models/PortModel\";\nimport { LinkModel } from \"./models/LinkModel\";\nimport { AbstractLabelFactory } from \"./factories/AbstractLabelFactory\";\nimport { AbstractLinkFactory } from \"./factories/AbstractLinkFactory\";\nimport { AbstractNodeFactory } from \"./factories/AbstractNodeFactory\";\nimport { AbstractPortFactory } from \"./factories/AbstractPortFactory\";\nimport { DefaultLinkFactory, DefaultNodeFactory } from \"./main\";\nimport { ROUTING_SCALING_FACTOR } from \"./routing/PathFinding\";\nimport { DefaultPortFactory } from \"./defaults/factories/DefaultPortFactory\";\nimport { LabelModel } from \"./models/LabelModel\";\nimport { DefaultLabelFactory } from \"./defaults/factories/DefaultLabelFactory\";\nimport { Toolkit } from \"./Toolkit\";\n/**\n * @author Dylan Vorster\n */\nexport interface DiagramEngineListener extends BaseListener {\n\tportFactoriesUpdated?(): void;\n\n\tnodeFactoriesUpdated?(): void;\n\n\tlinkFactoriesUpdated?(): void;\n\n\tlabelFactoriesUpdated?(): void;\n\n\trepaintCanvas?(): void;\n}\n\n/**\n * Passed as a parameter to the DiagramWidget\n */\nexport class DiagramEngine extends BaseEntity<DiagramEngineListener> {\n\tnodeFactories: { [s: string]: AbstractNodeFactory };\n\tlinkFactories: { [s: string]: AbstractLinkFactory };\n\tportFactories: { [s: string]: AbstractPortFactory };\n\tlabelFactories: { [s: string]: AbstractLabelFactory };\n\n\tdiagramModel: DiagramModel;\n\tcanvas: Element;\n\tpaintableWidgets: {};\n\tlinksThatHaveInitiallyRendered: {};\n\tnodesRendered: boolean;\n\tmaxNumberPointsPerLink: number;\n\tsmartRouting: boolean;\n\n\t// calculated only when smart routing is active\n\tcanvasMatrix: number[][] = [];\n\troutingMatrix: number[][] = [];\n\t// used when at least one element has negative coordinates\n\thAdjustmentFactor: number = 0;\n\tvAdjustmentFactor: number = 0;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.diagramModel = new DiagramModel();\n\t\tthis.nodeFactories = {};\n\t\tthis.linkFactories = {};\n\t\tthis.portFactories = {};\n\t\tthis.labelFactories = {};\n\t\tthis.canvas = null;\n\t\tthis.paintableWidgets = null;\n\t\tthis.linksThatHaveInitiallyRendered = {};\n\n\t\tif (Toolkit.TESTING) {\n\t\t\tToolkit.TESTING_UID = 0;\n\n\t\t\t//pop it onto the window so our E2E helpers can find it\n\t\t\tif (window) {\n\t\t\t\t(window as any)[\"diagram_instance\"] = this;\n\t\t\t}\n\t\t}\n\t}\n\n\tinstallDefaultFactories() {\n\t\tthis.registerNodeFactory(new DefaultNodeFactory());\n\t\tthis.registerLinkFactory(new DefaultLinkFactory());\n\t\tthis.registerPortFactory(new DefaultPortFactory());\n\t\tthis.registerLabelFactory(new DefaultLabelFactory());\n\t}\n\n\trepaintCanvas() {\n\t\tthis.iterateListeners(listener => {\n\t\t\tif (listener.repaintCanvas) {\n\t\t\t\tlistener.repaintCanvas();\n\t\t\t}\n\t\t});\n\t}\n\n\tclearRepaintEntities() {\n\t\tthis.paintableWidgets = null;\n\t}\n\n\tenableRepaintEntities(entities: BaseModel<BaseEntity, BaseModelListener>[]) {\n\t\tthis.paintableWidgets = {};\n\t\tentities.forEach(entity => {\n\t\t\t//if a node is requested to repaint, add all of its links\n\t\t\tif (entity instanceof NodeModel) {\n\t\t\t\t_.forEach(entity.getPorts(), port => {\n\t\t\t\t\t_.forEach(port.getLinks(), link => {\n\t\t\t\t\t\tthis.paintableWidgets[link.getID()] = true;\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (entity instanceof PointModel) {\n\t\t\t\tthis.paintableWidgets[entity.getLink().getID()] = true;\n\t\t\t}\n\n\t\t\tthis.paintableWidgets[entity.getID()] = true;\n\t\t});\n\t}\n\n\t/**\n\t * Checks to see if a model is locked by running through\n\t * its parents to see if they are locked first\n\t */\n\tisModelLocked(model: BaseEntity<BaseListener>) {\n\t\t//always check the diagram model\n\t\tif (this.diagramModel.isLocked()) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn model.isLocked();\n\t}\n\n\trecalculatePortsVisually() {\n\t\tthis.nodesRendered = false;\n\t\tthis.linksThatHaveInitiallyRendered = {};\n\t}\n\n\tcanEntityRepaint(baseModel: BaseModel<BaseEntity, BaseModelListener>) {\n\t\t//no rules applied, allow repaint\n\t\tif (this.paintableWidgets === null) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn this.paintableWidgets[baseModel.getID()] !== undefined;\n\t}\n\n\tsetCanvas(canvas: Element | null) {\n\t\tthis.canvas = canvas;\n\t}\n\n\tsetDiagramModel(model: DiagramModel) {\n\t\tthis.diagramModel = model;\n\t\tthis.recalculatePortsVisually();\n\t}\n\n\tgetDiagramModel(): DiagramModel {\n\t\treturn this.diagramModel;\n\t}\n\n\t//!-------------- FACTORIES ------------\n\n\tgetNodeFactories(): { [s: string]: AbstractNodeFactory } {\n\t\treturn this.nodeFactories;\n\t}\n\n\tgetLinkFactories(): { [s: string]: AbstractLinkFactory } {\n\t\treturn this.linkFactories;\n\t}\n\n\tgetLabelFactories(): { [s: string]: AbstractLabelFactory } {\n\t\treturn this.labelFactories;\n\t}\n\n\tregisterLabelFactory(factory: AbstractLabelFactory) {\n\t\tthis.labelFactories[factory.getType()] = factory;\n\t\tthis.iterateListeners(listener => {\n\t\t\tif (listener.labelFactoriesUpdated) {\n\t\t\t\tlistener.labelFactoriesUpdated();\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterPortFactory(factory: AbstractPortFactory) {\n\t\tthis.portFactories[factory.getType()] = factory;\n\t\tthis.iterateListeners(listener => {\n\t\t\tif (listener.portFactoriesUpdated) {\n\t\t\t\tlistener.portFactoriesUpdated();\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterNodeFactory(factory: AbstractNodeFactory) {\n\t\tthis.nodeFactories[factory.getType()] = factory;\n\t\tthis.iterateListeners(listener => {\n\t\t\tif (listener.nodeFactoriesUpdated) {\n\t\t\t\tlistener.nodeFactoriesUpdated();\n\t\t\t}\n\t\t});\n\t}\n\n\tregisterLinkFactory(factory: AbstractLinkFactory) {\n\t\tthis.linkFactories[factory.getType()] = factory;\n\t\tthis.iterateListeners(listener => {\n\t\t\tif (listener.linkFactoriesUpdated) {\n\t\t\t\tlistener.linkFactoriesUpdated();\n\t\t\t}\n\t\t});\n\t}\n\n\tgetPortFactory(type: string): AbstractPortFactory {\n\t\tif (this.portFactories[type]) {\n\t\t\treturn this.portFactories[type];\n\t\t}\n\t\tthrow new Error(`cannot find factory for port of type: [${type}]`);\n\t}\n\n\tgetNodeFactory(type: string): AbstractNodeFactory {\n\t\tif (this.nodeFactories[type]) {\n\t\t\treturn this.nodeFactories[type];\n\t\t}\n\t\tthrow new Error(`cannot find factory for node of type: [${type}]`);\n\t}\n\n\tgetLinkFactory(type: string): AbstractLinkFactory {\n\t\tif (this.linkFactories[type]) {\n\t\t\treturn this.linkFactories[type];\n\t\t}\n\t\tthrow new Error(`cannot find factory for link of type: [${type}]`);\n\t}\n\n\tgetLabelFactory(type: string): AbstractLabelFactory {\n\t\tif (this.labelFactories[type]) {\n\t\t\treturn this.labelFactories[type];\n\t\t}\n\t\tthrow new Error(`cannot find factory for label of type: [${type}]`);\n\t}\n\n\tgetFactoryForNode(node: NodeModel): AbstractNodeFactory | null {\n\t\treturn this.getNodeFactory(node.getType());\n\t}\n\n\tgetFactoryForLink(link: LinkModel): AbstractLinkFactory | null {\n\t\treturn this.getLinkFactory(link.getType());\n\t}\n\n\tgetFactoryForLabel(label: LabelModel): AbstractLabelFactory | null {\n\t\treturn this.getLabelFactory(label.getType());\n\t}\n\n\tgenerateWidgetForLink(link: LinkModel): JSX.Element | null {\n\t\tvar linkFactory = this.getFactoryForLink(link);\n\t\tif (!linkFactory) {\n\t\t\tthrow new Error(\"Cannot find link factory for link: \" + link.getType());\n\t\t}\n\t\treturn linkFactory.generateReactWidget(this, link);\n\t}\n\n\tgenerateWidgetForNode(node: NodeModel): JSX.Element | null {\n\t\tvar nodeFactory = this.getFactoryForNode(node);\n\t\tif (!nodeFactory) {\n\t\t\tthrow new Error(\"Cannot find widget factory for node: \" + node.getType());\n\t\t}\n\t\treturn nodeFactory.generateReactWidget(this, node);\n\t}\n\n\tgetRelativeMousePoint(event): { x: number; y: number } {\n\t\tvar point = this.getRelativePoint(event.clientX, event.clientY);\n\t\treturn {\n\t\t\tx: (point.x - this.diagramModel.getOffsetX()) / (this.diagramModel.getZoomLevel() / 100.0),\n\t\t\ty: (point.y - this.diagramModel.getOffsetY()) / (this.diagramModel.getZoomLevel() / 100.0)\n\t\t};\n\t}\n\n\tgetRelativePoint(x, y) {\n\t\tvar canvasRect = this.canvas.getBoundingClientRect();\n\t\treturn { x: x - canvasRect.left, y: y - canvasRect.top };\n\t}\n\n\tgetNodeElement(node: NodeModel): Element {\n\t\tconst selector = this.canvas.querySelector(`.node[data-nodeid=\"${node.getID()}\"]`);\n\t\tif (selector === null) {\n\t\t\tthrow new Error(\"Cannot find Node element with nodeID: [\" + node.getID() + \"]\");\n\t\t}\n\t\treturn selector;\n\t}\n\n\tgetNodePortElement(port: PortModel): any {\n\t\tvar selector = this.canvas.querySelector(\n\t\t\t`.port[data-name=\"${port.getName()}\"][data-nodeid=\"${port.getParent().getID()}\"]`\n\t\t);\n\t\tif (selector === null) {\n\t\t\tthrow new Error(\n\t\t\t\t\"Cannot find Node Port element with nodeID: [\" +\n\t\t\t\t\tport.getParent().getID() +\n\t\t\t\t\t\"] and name: [\" +\n\t\t\t\t\tport.getName() +\n\t\t\t\t\t\"]\"\n\t\t\t);\n\t\t}\n\t\treturn selector;\n\t}\n\n\tgetPortCenter(port: PortModel) {\n\t\tvar sourceElement = this.getNodePortElement(port);\n\t\tvar sourceRect = sourceElement.getBoundingClientRect();\n\n\t\tvar rel = this.getRelativePoint(sourceRect.left, sourceRect.top);\n\n\t\treturn {\n\t\t\tx:\n\t\t\t\tsourceElement.offsetWidth / 2 +\n\t\t\t\t(rel.x - this.diagramModel.getOffsetX()) / (this.diagramModel.getZoomLevel() / 100.0),\n\t\t\ty:\n\t\t\t\tsourceElement.offsetHeight / 2 +\n\t\t\t\t(rel.y - this.diagramModel.getOffsetY()) / (this.diagramModel.getZoomLevel() / 100.0)\n\t\t};\n\t}\n\n\t/**\n\t * Calculate rectangular coordinates of the port passed in.\n\t */\n\tgetPortCoords(\n\t\tport: PortModel\n\t): {\n\t\tx: number;\n\t\ty: number;\n\t\twidth: number;\n\t\theight: number;\n\t} {\n\t\tconst sourceElement = this.getNodePortElement(port);\n\t\tconst sourceRect = sourceElement.getBoundingClientRect();\n\t\tconst canvasRect = this.canvas.getBoundingClientRect() as ClientRect;\n\n\t\treturn {\n\t\t\tx:\n\t\t\t\t(sourceRect.x - this.diagramModel.getOffsetX()) / (this.diagramModel.getZoomLevel() / 100.0) -\n\t\t\t\tcanvasRect.left,\n\t\t\ty:\n\t\t\t\t(sourceRect.y - this.diagramModel.getOffsetY()) / (this.diagramModel.getZoomLevel() / 100.0) -\n\t\t\t\tcanvasRect.top,\n\t\t\twidth: sourceRect.width,\n\t\t\theight: sourceRect.height\n\t\t};\n\t}\n\n\t/**\n\t * Determine the width and height of the node passed in.\n\t * It currently assumes nodes have a rectangular shape, can be overriden for customised shapes.\n\t */\n\tgetNodeDimensions(node: NodeModel): { width: number; height: number } {\n\t\tif (!this.canvas) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0\n\t\t\t};\n\t\t}\n\n\t\tconst nodeElement = this.getNodeElement(node);\n\t\tconst nodeRect = nodeElement.getBoundingClientRect();\n\n\t\treturn {\n\t\t\twidth: nodeRect.width,\n\t\t\theight: nodeRect.height\n\t\t};\n\t}\n\n\tgetMaxNumberPointsPerLink(): number {\n\t\treturn this.maxNumberPointsPerLink;\n\t}\n\n\tsetMaxNumberPointsPerLink(max: number) {\n\t\tthis.maxNumberPointsPerLink = max;\n\t}\n\n\tisSmartRoutingEnabled() {\n\t\treturn !!this.smartRouting;\n\t}\n\tsetSmartRoutingStatus(status: boolean) {\n\t\tthis.smartRouting = status;\n\t}\n\n\t/**\n\t * A representation of the canvas in the following format:\n\t *\n\t * +-----------------+\n\t * | 0 0 0 0 0 0 0 0 |\n\t * | 0 0 0 0 0 0 0 0 |\n\t * | 0 0 0 0 0 0 0 0 |\n\t * | 0 0 0 0 0 0 0 0 |\n\t * | 0 0 0 0 0 0 0 0 |\n\t * +-----------------+\n\t *\n\t * In which all walkable points are marked by zeros.\n\t * It uses @link{#ROUTING_SCALING_FACTOR} to reduce the matrix dimensions and improve performance.\n\t */\n\tgetCanvasMatrix(): number[][] {\n\t\tif (this.canvasMatrix.length === 0) {\n\t\t\tthis.calculateCanvasMatrix();\n\t\t}\n\n\t\treturn this.canvasMatrix;\n\t}\n\tcalculateCanvasMatrix() {\n\t\tconst {\n\t\t\twidth: canvasWidth,\n\t\t\thAdjustmentFactor,\n\t\t\theight: canvasHeight,\n\t\t\tvAdjustmentFactor\n\t\t} = this.calculateMatrixDimensions();\n\n\t\tthis.hAdjustmentFactor = hAdjustmentFactor;\n\t\tthis.vAdjustmentFactor = vAdjustmentFactor;\n\n\t\tconst matrixWidth = Math.ceil(canvasWidth / ROUTING_SCALING_FACTOR);\n\t\tconst matrixHeight = Math.ceil(canvasHeight / ROUTING_SCALING_FACTOR);\n\n\t\tthis.canvasMatrix = _.range(0, matrixHeight).map(() => {\n\t\t\treturn new Array(matrixWidth).fill(0);\n\t\t});\n\t}\n\n\t/**\n\t * A representation of the canvas in the following format:\n\t *\n\t * +-----------------+\n\t * | 0 0 1 1 0 0 0 0 |\n\t * | 0 0 1 1 0 0 1 1 |\n\t * | 0 0 0 0 0 0 1 1 |\n\t * | 1 1 0 0 0 0 0 0 |\n\t * | 1 1 0 0 0 0 0 0 |\n\t * +-----------------+\n\t *\n\t * In which all points blocked by a node (and its ports) are\n\t * marked as 1; points were there is nothing (ie, free) receive 0.\n\t */\n\tgetRoutingMatrix(): number[][] {\n\t\tif (this.routingMatrix.length === 0) {\n\t\t\tthis.calculateRoutingMatrix();\n\t\t}\n\n\t\treturn this.routingMatrix;\n\t}\n\tcalculateRoutingMatrix(): void {\n\t\tconst matrix = _.cloneDeep(this.getCanvasMatrix());\n\n\t\t// nodes need to be marked as blocked points\n\t\tthis.markNodes(matrix);\n\t\t// same thing for ports\n\t\tthis.markPorts(matrix);\n\n\t\tthis.routingMatrix = matrix;\n\t}\n\n\t/**\n\t * The routing matrix does not have negative indexes, but elements could be negatively positioned.\n\t * We use the functions below to translate back and forth between these coordinates, relying on the\n\t * calculated values of hAdjustmentFactor and vAdjustmentFactor.\n\t */\n\ttranslateRoutingX(x: number, reverse: boolean = false) {\n\t\treturn x + this.hAdjustmentFactor * (reverse ? -1 : 1);\n\t}\n\ttranslateRoutingY(y: number, reverse: boolean = false) {\n\t\treturn y + this.vAdjustmentFactor * (reverse ? -1 : 1);\n\t}\n\n\t/**\n\t * Despite being a long method, we simply iterate over all three collections (nodes, ports and points)\n\t * to find the highest X and Y dimensions, so we can build the matrix large enough to contain all elements.\n\t */\n\tcalculateMatrixDimensions = (): {\n\t\twidth: number;\n\t\thAdjustmentFactor: number;\n\t\theight: number;\n\t\tvAdjustmentFactor: number;\n\t} => {\n\t\tconst allNodesCoords = _.values(this.diagramModel.nodes).map(item => ({\n\t\t\tx: item.x,\n\t\t\twidth: item.width,\n\t\t\ty: item.y,\n\t\t\theight: item.height\n\t\t}));\n\n\t\tconst allLinks = _.values(this.diagramModel.links);\n\t\tconst allPortsCoords = _.flatMap(allLinks.map(link => [link.sourcePort, link.targetPort]))\n\t\t\t.filter(port => port !== null)\n\t\t\t.map(item => ({\n\t\t\t\tx: item.x,\n\t\t\t\twidth: item.width,\n\t\t\t\ty: item.y,\n\t\t\t\theight: item.height\n\t\t\t}));\n\t\tconst allPointsCoords = _.flatMap(allLinks.map(link => link.points)).map(item => ({\n\t\t\t// points don't have width/height, so let's just use 0\n\t\t\tx: item.x,\n\t\t\twidth: 0,\n\t\t\ty: item.y,\n\t\t\theight: 0\n\t\t}));\n\n\t\tconst canvas = this.canvas as HTMLDivElement;\n\t\tconst minX =\n\t\t\tMath.floor(\n\t\t\t\tMath.min(_.minBy(_.concat(allNodesCoords, allPortsCoords, allPointsCoords), item => item.x).x, 0) /\n\t\t\t\t\tROUTING_SCALING_FACTOR\n\t\t\t) * ROUTING_SCALING_FACTOR;\n\t\tconst maxXElement = _.maxBy(\n\t\t\t_.concat(allNodesCoords, allPortsCoords, allPointsCoords),\n\t\t\titem => item.x + item.width\n\t\t);\n\t\tconst maxX = Math.max(maxXElement.x + maxXElement.width, canvas.offsetWidth);\n\n\t\tconst minY =\n\t\t\tMath.floor(\n\t\t\t\tMath.min(_.minBy(_.concat(allNodesCoords, allPortsCoords, allPointsCoords), item => item.y).y, 0) /\n\t\t\t\t\tROUTING_SCALING_FACTOR\n\t\t\t) * ROUTING_SCALING_FACTOR;\n\t\tconst maxYElement = _.maxBy(\n\t\t\t_.concat(allNodesCoords, allPortsCoords, allPointsCoords),\n\t\t\titem => item.y + item.height\n\t\t);\n\t\tconst maxY = Math.max(maxYElement.y + maxYElement.height, canvas.offsetHeight);\n\n\t\treturn {\n\t\t\twidth: Math.ceil(Math.abs(minX) + maxX),\n\t\t\thAdjustmentFactor: Math.abs(minX) / ROUTING_SCALING_FACTOR + 1,\n\t\t\theight: Math.ceil(Math.abs(minY) + maxY),\n\t\t\tvAdjustmentFactor: Math.abs(minY) / ROUTING_SCALING_FACTOR + 1\n\t\t};\n\t};\n\n\t/**\n\t * Updates (by reference) where nodes will be drawn on the matrix passed in.\n\t */\n\tmarkNodes = (matrix: number[][]): void => {\n\t\t_.values(this.diagramModel.nodes).forEach(node => {\n\t\t\tconst startX = Math.floor(node.x / ROUTING_SCALING_FACTOR);\n\t\t\tconst endX = Math.ceil((node.x + node.width) / ROUTING_SCALING_FACTOR);\n\t\t\tconst startY = Math.floor(node.y / ROUTING_SCALING_FACTOR);\n\t\t\tconst endY = Math.ceil((node.y + node.height) / ROUTING_SCALING_FACTOR);\n\n\t\t\tfor (let x = startX - 1; x <= endX + 1; x++) {\n\t\t\t\tfor (let y = startY - 1; y < endY + 1; y++) {\n\t\t\t\t\tthis.markMatrixPoint(matrix, this.translateRoutingX(x), this.translateRoutingY(y));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\t/**\n\t * Updates (by reference) where ports will be drawn on the matrix passed in.\n\t */\n\tmarkPorts = (matrix: number[][]): void => {\n\t\tconst allElements = _.flatMap(\n\t\t\t_.values(this.diagramModel.links).map(link => [].concat(link.sourcePort, link.targetPort))\n\t\t);\n\t\tallElements.filter(port => port !== null).forEach(port => {\n\t\t\tconst startX = Math.floor(port.x / ROUTING_SCALING_FACTOR);\n\t\t\tconst endX = Math.ceil((port.x + port.width) / ROUTING_SCALING_FACTOR);\n\t\t\tconst startY = Math.floor(port.y / ROUTING_SCALING_FACTOR);\n\t\t\tconst endY = Math.ceil((port.y + port.height) / ROUTING_SCALING_FACTOR);\n\n\t\t\tfor (let x = startX - 1; x <= endX + 1; x++) {\n\t\t\t\tfor (let y = startY - 1; y < endY + 1; y++) {\n\t\t\t\t\tthis.markMatrixPoint(matrix, this.translateRoutingX(x), this.translateRoutingY(y));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\tmarkMatrixPoint = (matrix: number[][], x: number, y: number) => {\n\t\tif (matrix[y] !== undefined && matrix[y][x] !== undefined) {\n\t\t\tmatrix[y][x] = 1;\n\t\t}\n\t};\n\n\tzoomToFit() {\n\t\tconst xFactor = this.canvas.clientWidth / this.canvas.scrollWidth;\n\t\tconst yFactor = this.canvas.clientHeight / this.canvas.scrollHeight;\n\t\tconst zoomFactor = xFactor < yFactor ? xFactor : yFactor;\n\n\t\tthis.diagramModel.setZoomLevel(this.diagramModel.getZoomLevel() * zoomFactor);\n\t\tthis.diagramModel.setOffset(0, 0);\n\t\tthis.repaintCanvas();\n\t}\n}\n","import * as React from \"react\";\nimport { DefaultLinkWidget } from \"../widgets/DefaultLinkWidget\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { AbstractLinkFactory } from \"../../factories/AbstractLinkFactory\";\nimport { DefaultLinkModel } from \"../models/DefaultLinkModel\";\n\n/**\n * @author Dylan Vorster\n */\nexport class DefaultLinkFactory extends AbstractLinkFactory<DefaultLinkModel> {\n\tconstructor() {\n\t\tsuper(\"default\");\n\t}\n\n\tgenerateReactWidget(diagramEngine: DiagramEngine, link: DefaultLinkModel): JSX.Element {\n\t\treturn React.createElement(DefaultLinkWidget, {\n\t\t\tlink: link,\n\t\t\tdiagramEngine: diagramEngine\n\t\t});\n\t}\n\n\tgetNewInstance(initialConfig?: any): DefaultLinkModel {\n\t\treturn new DefaultLinkModel();\n\t}\n\n\tgenerateLinkSegment(model: DefaultLinkModel, widget: DefaultLinkWidget, selected: boolean, path: string) {\n\t\treturn (\n\t\t\t<path\n\t\t\t\tclassName={selected ? widget.bem(\"--path-selected\") : \"\"}\n\t\t\t\tstrokeWidth={model.width}\n\t\t\t\tstroke={model.color}\n\t\t\t\td={path}\n\t\t\t/>\n\t\t);\n\t}\n}\n","import { DefaultNodeModel } from \"../models/DefaultNodeModel\";\nimport * as React from \"react\";\nimport { DefaultNodeWidget } from \"../widgets/DefaultNodeWidget\";\nimport { DiagramEngine } from \"../../DiagramEngine\";\nimport { AbstractNodeFactory } from \"../../factories/AbstractNodeFactory\";\n/**\n * @author Dylan Vorster\n */\nexport class DefaultNodeFactory extends AbstractNodeFactory<DefaultNodeModel> {\n\tconstructor() {\n\t\tsuper(\"default\");\n\t}\n\n\tgenerateReactWidget(diagramEngine: DiagramEngine, node: DefaultNodeModel): JSX.Element {\n\t\treturn React.createElement(DefaultNodeWidget, {\n\t\t\tnode: node,\n\t\t\tdiagramEngine: diagramEngine\n\t\t});\n\t}\n\n\tgetNewInstance(initialConfig?: any): DefaultNodeModel {\n\t\treturn new DefaultNodeModel();\n\t}\n}\n","import * as React from \"react\";\nimport { DiagramEngine } from \"../DiagramEngine\";\nimport * as _ from \"lodash\";\nimport { LinkLayerWidget } from \"./layers/LinkLayerWidget\";\nimport { NodeLayerWidget } from \"./layers/NodeLayerWidget\";\nimport { Toolkit } from \"../Toolkit\";\nimport { BaseAction } from \"../actions/BaseAction\";\nimport { MoveCanvasAction } from \"../actions/MoveCanvasAction\";\nimport { MoveItemsAction } from \"../actions/MoveItemsAction\";\nimport { SelectingAction } from \"../actions/SelectingAction\";\nimport { NodeModel } from \"../models/NodeModel\";\nimport { PointModel } from \"../models/PointModel\";\nimport { PortModel } from \"../models/PortModel\";\nimport { LinkModel } from \"../models/LinkModel\";\nimport { SelectionModel } from \"../models/SelectionModel\";\nimport { BaseModel, BaseModelListener } from \"../models/BaseModel\";\nimport { BaseEntity } from \"../BaseEntity\";\nimport { BaseWidget, BaseWidgetProps } from \"./BaseWidget\";\n\nexport interface DiagramProps extends BaseWidgetProps {\n\tdiagramEngine: DiagramEngine;\n\n\tallowLooseLinks?: boolean;\n\tallowCanvasTranslation?: boolean;\n\tallowCanvasZoom?: boolean;\n\tinverseZoom?: boolean;\n\tmaxNumberPointsPerLink?: number;\n\tsmartRouting?: boolean;\n\n\tonContextMenu?: any;\n\tactionStartedFiring?: (action: BaseAction) => boolean;\n\tactionStillFiring?: (action: BaseAction) => void;\n\tactionStoppedFiring?: (action: BaseAction) => void;\n\n\tdeleteKeys?: number[];\n}\n\nexport interface DiagramState {\n\taction: BaseAction | null;\n\twasMoved: boolean;\n\trenderedNodes: boolean;\n\twindowListener: any;\n\tdiagramEngineListener: any;\n\tdocument: any;\n}\n\n/**\n * @author Dylan Vorster\n */\nexport class DiagramWidget extends BaseWidget<DiagramProps, DiagramState> {\n\tpublic static defaultProps: DiagramProps = {\n\t\tdiagramEngine: null,\n\t\tallowLooseLinks: true,\n\t\tallowCanvasTranslation: true,\n\t\tallowCanvasZoom: true,\n\t\tinverseZoom: false,\n\t\tmaxNumberPointsPerLink: Infinity, // backwards compatible default\n\t\tsmartRouting: false,\n\t\tdeleteKeys: [46, 8]\n\t};\n\n\tonKeyUpPointer: (this: Window, ev: KeyboardEvent) => void = null;\n\n\tconstructor(props: DiagramProps) {\n\t\tsuper(\"srd-diagram\", props);\n\t\tthis.onMouseMove = this.onMouseMove.bind(this);\n\t\tthis.onMouseUp = this.onMouseUp.bind(this);\n\t\tthis.state = {\n\t\t\taction: null,\n\t\t\twasMoved: false,\n\t\t\trenderedNodes: false,\n\t\t\twindowListener: null,\n\t\t\tdiagramEngineListener: null,\n\t\t\tdocument: null\n\t\t};\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis.props.diagramEngine.removeListener(\n\t\t\tthis.state.diagramEngineListener\n\t\t);\n\t\tthis.props.diagramEngine.setCanvas(null);\n\t\twindow.removeEventListener(\"keyup\", this.onKeyUpPointer);\n\t\twindow.removeEventListener(\"mouseUp\", this.onMouseUp);\n\t\twindow.removeEventListener(\"mouseMove\", this.onMouseMove);\n\t}\n\n\tcomponentWillReceiveProps(nextProps: DiagramProps) {\n\t\tif (this.props.diagramEngine !== nextProps.diagramEngine) {\n\t\t\tthis.props.diagramEngine.removeListener(\n\t\t\t\tthis.state.diagramEngineListener\n\t\t\t);\n\t\t\tconst diagramEngineListener = nextProps.diagramEngine.addListener({\n\t\t\t\trepaintCanvas: () => this.forceUpdate()\n\t\t\t});\n\t\t\tthis.setState({ diagramEngineListener });\n\t\t}\n\t}\n\n\tcomponentWillUpdate(nextProps: DiagramProps) {\n\t\tif (\n\t\t\tthis.props.diagramEngine.diagramModel.id !==\n\t\t\tnextProps.diagramEngine.diagramModel.id\n\t\t) {\n\t\t\tthis.setState({ renderedNodes: false });\n\t\t\tnextProps.diagramEngine.diagramModel.rendered = true;\n\t\t}\n\t\tif (!nextProps.diagramEngine.diagramModel.rendered) {\n\t\t\tthis.setState({ renderedNodes: false });\n\t\t\tnextProps.diagramEngine.diagramModel.rendered = true;\n\t\t}\n\t}\n\n\tcomponentDidUpdate() {\n\t\tif (!this.state.renderedNodes) {\n\t\t\tthis.setState({\n\t\t\t\trenderedNodes: true\n\t\t\t});\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.onKeyUpPointer = this.onKeyUp.bind(this);\n\n\t\t//add a keyboard listener\n\t\tthis.setState({\n\t\t\tdocument: document,\n\t\t\trenderedNodes: true,\n\t\t\tdiagramEngineListener: this.props.diagramEngine.addListener({\n\t\t\t\trepaintCanvas: () => {\n\t\t\t\t\tthis.forceUpdate();\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\twindow.addEventListener(\"keyup\", this.onKeyUpPointer, false);\n\n\t\t// dont focus the window when in test mode - jsdom fails\n\t\tif (process.env.NODE_ENV !== \"test\") {\n\t\t\twindow.focus();\n\t\t}\n\t}\n\n\t/**\n\t * Gets a model and element under the mouse cursor\n\t */\n\tgetMouseElement(\n\t\tevent\n\t): { model: BaseModel<BaseEntity, BaseModelListener>; element: Element } {\n\t\tvar target = event.target as Element;\n\t\tvar diagramModel = this.props.diagramEngine.diagramModel;\n\n\t\t//is it a port\n\t\tvar element = Toolkit.closest(target, \".port[data-name]\");\n\t\tif (element) {\n\t\t\tvar nodeElement = Toolkit.closest(\n\t\t\t\ttarget,\n\t\t\t\t\".node[data-nodeid]\"\n\t\t\t) as HTMLElement;\n\t\t\treturn {\n\t\t\t\tmodel: diagramModel\n\t\t\t\t\t.getNode(nodeElement.getAttribute(\"data-nodeid\"))\n\t\t\t\t\t.getPort(element.getAttribute(\"data-name\")),\n\t\t\t\telement: element\n\t\t\t};\n\t\t}\n\n\t\t//look for a point\n\t\telement = Toolkit.closest(target, \".point[data-id]\");\n\t\tif (element) {\n\t\t\treturn {\n\t\t\t\tmodel: diagramModel\n\t\t\t\t\t.getLink(element.getAttribute(\"data-linkid\"))\n\t\t\t\t\t.getPointModel(element.getAttribute(\"data-id\")),\n\t\t\t\telement: element\n\t\t\t};\n\t\t}\n\n\t\t//look for a link\n\t\telement = Toolkit.closest(target, \"[data-linkid]\");\n\t\tif (element) {\n\t\t\treturn {\n\t\t\t\tmodel: diagramModel.getLink(\n\t\t\t\t\telement.getAttribute(\"data-linkid\")\n\t\t\t\t),\n\t\t\t\telement: element\n\t\t\t};\n\t\t}\n\n\t\t//look for a node\n\t\telement = Toolkit.closest(target, \".node[data-nodeid]\");\n\t\tif (element) {\n\t\t\treturn {\n\t\t\t\tmodel: diagramModel.getNode(\n\t\t\t\t\telement.getAttribute(\"data-nodeid\")\n\t\t\t\t),\n\t\t\t\telement: element\n\t\t\t};\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfireAction() {\n\t\tif (this.state.action && this.props.actionStillFiring) {\n\t\t\tthis.props.actionStillFiring(this.state.action);\n\t\t}\n\t}\n\n\tstopFiringAction(shouldSkipEvent?: boolean) {\n\t\tif (this.props.actionStoppedFiring && !shouldSkipEvent) {\n\t\t\tthis.props.actionStoppedFiring(this.state.action);\n\t\t}\n\t\tthis.setState({ action: null });\n\t}\n\n\tstartFiringAction(action: BaseAction) {\n\t\tvar setState = true;\n\t\tif (this.props.actionStartedFiring) {\n\t\t\tsetState = this.props.actionStartedFiring(action);\n\t\t}\n\t\tif (setState) {\n\t\t\tthis.setState({ action: action });\n\t\t}\n\t}\n\n\tonMouseMove(event) {\n\t\tvar diagramEngine = this.props.diagramEngine;\n\t\tvar diagramModel = diagramEngine.getDiagramModel();\n\t\t//select items so draw a bounding box\n\t\tif (this.state.action instanceof SelectingAction) {\n\t\t\tvar relative = diagramEngine.getRelativePoint(\n\t\t\t\tevent.clientX,\n\t\t\t\tevent.clientY\n\t\t\t);\n\n\t\t\t_.forEach(diagramModel.getNodes(), node => {\n\t\t\t\tif (\n\t\t\t\t\t(this.state.action as SelectingAction).containsElement(\n\t\t\t\t\t\tnode.x,\n\t\t\t\t\t\tnode.y,\n\t\t\t\t\t\tdiagramModel\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tnode.setSelected(true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t_.forEach(diagramModel.getLinks(), link => {\n\t\t\t\tvar allSelected = true;\n\t\t\t\t_.forEach(link.points, point => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(this.state.action as SelectingAction).containsElement(\n\t\t\t\t\t\t\tpoint.x,\n\t\t\t\t\t\t\tpoint.y,\n\t\t\t\t\t\t\tdiagramModel\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\tpoint.setSelected(true);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tallSelected = false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tif (allSelected) {\n\t\t\t\t\tlink.setSelected(true);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.state.action.mouseX2 = relative.x;\n\t\t\tthis.state.action.mouseY2 = relative.y;\n\n\t\t\tthis.fireAction();\n\t\t\tthis.setState({ action: this.state.action });\n\t\t\treturn;\n\t\t} else if (this.state.action instanceof MoveItemsAction) {\n\t\t\tlet amountX = event.clientX - this.state.action.mouseX;\n\t\t\tlet amountY = event.clientY - this.state.action.mouseY;\n\t\t\tlet amountZoom = diagramModel.getZoomLevel() / 100;\n\n\t\t\t_.forEach(this.state.action.selectionModels, model => {\n\t\t\t\t// in this case we need to also work out the relative grid position\n\t\t\t\tif (\n\t\t\t\t\tmodel.model instanceof NodeModel ||\n\t\t\t\t\t(model.model instanceof PointModel &&\n\t\t\t\t\t\t!model.model.isConnectedToPort())\n\t\t\t\t) {\n\t\t\t\t\tmodel.model.x = diagramModel.getGridPosition(\n\t\t\t\t\t\tmodel.initialX + amountX / amountZoom\n\t\t\t\t\t);\n\t\t\t\t\tmodel.model.y = diagramModel.getGridPosition(\n\t\t\t\t\t\tmodel.initialY + amountY / amountZoom\n\t\t\t\t\t);\n\n\t\t\t\t\t// update port coordinates as well\n\t\t\t\t\tif (model.model instanceof NodeModel) {\n\t\t\t\t\t\t_.forEach(model.model.getPorts(), port => {\n\t\t\t\t\t\t\tconst portCoords = this.props.diagramEngine.getPortCoords(\n\t\t\t\t\t\t\t\tport\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tport.updateCoords(portCoords);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (diagramEngine.isSmartRoutingEnabled()) {\n\t\t\t\t\t\tdiagramEngine.calculateRoutingMatrix();\n\t\t\t\t\t}\n\t\t\t\t} else if (model.model instanceof PointModel) {\n\t\t\t\t\t// we want points that are connected to ports, to not necessarily snap to grid\n\t\t\t\t\t// this stuff needs to be pixel perfect, dont touch it\n\t\t\t\t\tmodel.model.x =\n\t\t\t\t\t\tmodel.initialX +\n\t\t\t\t\t\tdiagramModel.getGridPosition(amountX / amountZoom);\n\t\t\t\t\tmodel.model.y =\n\t\t\t\t\t\tmodel.initialY +\n\t\t\t\t\t\tdiagramModel.getGridPosition(amountY / amountZoom);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (diagramEngine.isSmartRoutingEnabled()) {\n\t\t\t\tdiagramEngine.calculateCanvasMatrix();\n\t\t\t}\n\n\t\t\tthis.fireAction();\n\t\t\tif (!this.state.wasMoved) {\n\t\t\t\tthis.setState({ wasMoved: true });\n\t\t\t} else {\n\t\t\t\tthis.forceUpdate();\n\t\t\t}\n\t\t} else if (this.state.action instanceof MoveCanvasAction) {\n\t\t\t//translate the actual canvas\n\t\t\tif (this.props.allowCanvasTranslation) {\n\t\t\t\tdiagramModel.setOffset(\n\t\t\t\t\tthis.state.action.initialOffsetX +\n\t\t\t\t\t\t(event.clientX - this.state.action.mouseX),\n\t\t\t\t\tthis.state.action.initialOffsetY +\n\t\t\t\t\t\t(event.clientY - this.state.action.mouseY)\n\t\t\t\t);\n\t\t\t\tthis.fireAction();\n\t\t\t\tthis.forceUpdate();\n\t\t\t}\n\t\t}\n\t}\n\n\tonKeyUp(event) {\n\t\t//delete all selected\n\t\tif (this.props.deleteKeys.indexOf(event.keyCode) !== -1) {\n\t\t\t_.forEach(\n\t\t\t\tthis.props.diagramEngine.getDiagramModel().getSelectedItems(),\n\t\t\t\telement => {\n\t\t\t\t\t//only delete items which are not locked\n\t\t\t\t\tif (!this.props.diagramEngine.isModelLocked(element)) {\n\t\t\t\t\t\telement.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\t\tthis.forceUpdate();\n\t\t}\n\t}\n\n\tonMouseUp(event) {\n\t\tvar diagramEngine = this.props.diagramEngine;\n\t\t//are we going to connect a link to something?\n\t\tif (this.state.action instanceof MoveItemsAction) {\n\t\t\tvar element = this.getMouseElement(event);\n\t\t\t_.forEach(this.state.action.selectionModels, model => {\n\t\t\t\t//only care about points connecting to things\n\t\t\t\tif (!(model.model instanceof PointModel)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\telement &&\n\t\t\t\t\telement.model instanceof PortModel &&\n\t\t\t\t\t!diagramEngine.isModelLocked(element.model)\n\t\t\t\t) {\n\t\t\t\t\tlet link = model.model.getLink();\n\t\t\t\t\tif (link.getTargetPort() !== null) {\n\t\t\t\t\t\t//if this was a valid link already and we are adding a node in the middle, create 2 links from the original\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tlink.getTargetPort() !== element.model &&\n\t\t\t\t\t\t\tlink.getSourcePort() !== element.model\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tconst targetPort = link.getTargetPort();\n\t\t\t\t\t\t\tlet newLink = link.clone({});\n\t\t\t\t\t\t\tnewLink.setSourcePort(element.model);\n\t\t\t\t\t\t\tnewLink.setTargetPort(targetPort);\n\t\t\t\t\t\t\tlink.setTargetPort(element.model);\n\t\t\t\t\t\t\ttargetPort.removeLink(link);\n\t\t\t\t\t\t\tnewLink.removePointsBefore(\n\t\t\t\t\t\t\t\tnewLink.getPoints()[\n\t\t\t\t\t\t\t\t\tlink.getPointIndex(model.model)\n\t\t\t\t\t\t\t\t]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tlink.removePointsAfter(model.model);\n\t\t\t\t\t\t\tdiagramEngine.getDiagramModel().addLink(newLink);\n\t\t\t\t\t\t\t//if we are connecting to the same target or source, remove tweener points\n\t\t\t\t\t\t} else if (link.getTargetPort() === element.model) {\n\t\t\t\t\t\t\tlink.removePointsAfter(model.model);\n\t\t\t\t\t\t} else if (link.getSourcePort() === element.model) {\n\t\t\t\t\t\t\tlink.removePointsBefore(model.model);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlink.setTargetPort(element.model);\n\t\t\t\t\t}\n\t\t\t\t\tdelete this.props.diagramEngine\n\t\t\t\t\t\t.linksThatHaveInitiallyRendered[link.getID()];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t//check for / remove any loose links in any models which have been moved\n\t\t\tif (!this.props.allowLooseLinks && this.state.wasMoved) {\n\t\t\t\t_.forEach(this.state.action.selectionModels, model => {\n\t\t\t\t\t//only care about points connecting to things\n\t\t\t\t\tif (!(model.model instanceof PointModel)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tlet selectedPoint: PointModel = model.model;\n\t\t\t\t\tlet link: LinkModel = selectedPoint.getLink();\n\t\t\t\t\tif (\n\t\t\t\t\t\tlink.getSourcePort() === null ||\n\t\t\t\t\t\tlink.getTargetPort() === null\n\t\t\t\t\t) {\n\t\t\t\t\t\tlink.remove();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t//remove any invalid links\n\t\t\t_.forEach(this.state.action.selectionModels, model => {\n\t\t\t\t//only care about points connecting to things\n\t\t\t\tif (!(model.model instanceof PointModel)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tlet link: LinkModel = model.model.getLink();\n\t\t\t\tlet sourcePort: PortModel = link.getSourcePort();\n\t\t\t\tlet targetPort: PortModel = link.getTargetPort();\n\t\t\t\tif (sourcePort !== null && targetPort !== null) {\n\t\t\t\t\tif (!sourcePort.canLinkToPort(targetPort)) {\n\t\t\t\t\t\t//link not allowed\n\t\t\t\t\t\tlink.remove();\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t_.some(\n\t\t\t\t\t\t\t_.values(targetPort.getLinks()),\n\t\t\t\t\t\t\t(l: LinkModel) =>\n\t\t\t\t\t\t\t\tl !== link &&\n\t\t\t\t\t\t\t\t(l.getSourcePort() === sourcePort ||\n\t\t\t\t\t\t\t\t\tl.getTargetPort() === sourcePort)\n\t\t\t\t\t\t)\n\t\t\t\t\t) {\n\t\t\t\t\t\t//link is a duplicate\n\t\t\t\t\t\tlink.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tdiagramEngine.clearRepaintEntities();\n\t\t\tthis.stopFiringAction(!this.state.wasMoved);\n\t\t} else {\n\t\t\tdiagramEngine.clearRepaintEntities();\n\t\t\tthis.stopFiringAction();\n\t\t}\n\t\tthis.state.document.removeEventListener(\"mousemove\", this.onMouseMove);\n\t\tthis.state.document.removeEventListener(\"mouseup\", this.onMouseUp);\n\t}\n\n\tdrawSelectionBox() {\n\t\tlet dimensions = (this.state\n\t\t\t.action as SelectingAction).getBoxDimensions();\n\t\treturn (\n\t\t\t<div\n\t\t\t\tclassName={this.bem(\"__selector\")}\n\t\t\t\tstyle={{\n\t\t\t\t\ttop: dimensions.top,\n\t\t\t\t\tleft: dimensions.left,\n\t\t\t\t\twidth: dimensions.width,\n\t\t\t\t\theight: dimensions.height\n\t\t\t\t}}\n\t\t\t/>\n\t\t);\n\t}\n\n\trender() {\n\t\tvar diagramEngine = this.props.diagramEngine;\n\t\tdiagramEngine.setMaxNumberPointsPerLink(\n\t\t\tthis.props.maxNumberPointsPerLink\n\t\t);\n\t\tdiagramEngine.setSmartRoutingStatus(this.props.smartRouting);\n\t\tvar diagramModel = diagramEngine.getDiagramModel();\n\n\t\treturn (\n\t\t\t<div\n\t\t\t\t{...this.getProps()}\n\t\t\t\tref={ref => {\n\t\t\t\t\tif (ref) {\n\t\t\t\t\t\tthis.props.diagramEngine.setCanvas(ref);\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonWheel={event => {\n\t\t\t\t\tif (this.props.allowCanvasZoom) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\tconst oldZoomFactor = diagramModel.getZoomLevel() / 100;\n\t\t\t\t\t\tlet scrollDelta = this.props.inverseZoom\n\t\t\t\t\t\t\t? -event.deltaY\n\t\t\t\t\t\t\t: event.deltaY;\n\t\t\t\t\t\t//check if it is pinch gesture\n\t\t\t\t\t\tif (event.ctrlKey && scrollDelta % 1 !== 0) {\n\t\t\t\t\t\t\t/*Chrome and Firefox sends wheel event with deltaY that\n                have fractional part, also `ctrlKey` prop of the event is true\n                though ctrl isn't pressed\n              */\n\t\t\t\t\t\t\tscrollDelta /= 3;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tscrollDelta /= 60;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (diagramModel.getZoomLevel() + scrollDelta > 10) {\n\t\t\t\t\t\t\tdiagramModel.setZoomLevel(\n\t\t\t\t\t\t\t\tdiagramModel.getZoomLevel() + scrollDelta\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst zoomFactor = diagramModel.getZoomLevel() / 100;\n\n\t\t\t\t\t\tconst boundingRect = event.currentTarget.getBoundingClientRect();\n\t\t\t\t\t\tconst clientWidth = boundingRect.width;\n\t\t\t\t\t\tconst clientHeight = boundingRect.height;\n\t\t\t\t\t\t// compute difference between rect before and after scroll\n\t\t\t\t\t\tconst widthDiff =\n\t\t\t\t\t\t\tclientWidth * zoomFactor -\n\t\t\t\t\t\t\tclientWidth * oldZoomFactor;\n\t\t\t\t\t\tconst heightDiff =\n\t\t\t\t\t\t\tclientHeight * zoomFactor -\n\t\t\t\t\t\t\tclientHeight * oldZoomFactor;\n\t\t\t\t\t\t// compute mouse coords relative to canvas\n\t\t\t\t\t\tconst clientX = event.clientX - boundingRect.left;\n\t\t\t\t\t\tconst clientY = event.clientY - boundingRect.top;\n\n\t\t\t\t\t\t// compute width and height increment factor\n\t\t\t\t\t\tconst xFactor =\n\t\t\t\t\t\t\t(clientX - diagramModel.getOffsetX()) /\n\t\t\t\t\t\t\toldZoomFactor /\n\t\t\t\t\t\t\tclientWidth;\n\t\t\t\t\t\tconst yFactor =\n\t\t\t\t\t\t\t(clientY - diagramModel.getOffsetY()) /\n\t\t\t\t\t\t\toldZoomFactor /\n\t\t\t\t\t\t\tclientHeight;\n\n\t\t\t\t\t\tdiagramModel.setOffset(\n\t\t\t\t\t\t\tdiagramModel.getOffsetX() - widthDiff * xFactor,\n\t\t\t\t\t\t\tdiagramModel.getOffsetY() - heightDiff * yFactor\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tdiagramEngine.enableRepaintEntities([]);\n\t\t\t\t\t\tthis.forceUpdate();\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonContextMenu={event => {\n\t\t\t\t\tif (!this.props.onContextMenu) return false;\n\t\t\t\t\tvar model = this.getMouseElement(event);\n\t\t\t\t\tthis.props.onContextMenu(event, model);\n\t\t\t\t\treturn false;\n\t\t\t\t}}\n\t\t\t\tonMouseDown={event => {\n\t\t\t\t\tif (event.nativeEvent.which === 3) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.setState({ ...this.state, wasMoved: false });\n\n\t\t\t\t\tdiagramEngine.clearRepaintEntities();\n\t\t\t\t\tvar model = this.getMouseElement(event);\n\t\t\t\t\t//the canvas was selected\n\t\t\t\t\tif (model === null) {\n\t\t\t\t\t\t//is it a multiple selection\n\t\t\t\t\t\tif (event.shiftKey) {\n\t\t\t\t\t\t\tvar relative = diagramEngine.getRelativePoint(\n\t\t\t\t\t\t\t\tevent.clientX,\n\t\t\t\t\t\t\t\tevent.clientY\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.startFiringAction(\n\t\t\t\t\t\t\t\tnew SelectingAction(relative.x, relative.y)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//its a drag the canvas event\n\t\t\t\t\t\t\tdiagramModel.clearSelection();\n\t\t\t\t\t\t\tthis.startFiringAction(\n\t\t\t\t\t\t\t\tnew MoveCanvasAction(\n\t\t\t\t\t\t\t\t\tevent.clientX,\n\t\t\t\t\t\t\t\t\tevent.clientY,\n\t\t\t\t\t\t\t\t\tdiagramModel\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (model.model instanceof PortModel) {\n\t\t\t\t\t\t//its a port element, we want to drag a link\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!this.props.diagramEngine.isModelLocked(model.model)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tvar relative = diagramEngine.getRelativeMousePoint(\n\t\t\t\t\t\t\t\tevent\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tvar sourcePort = model.model;\n\t\t\t\t\t\t\tvar link = sourcePort.createLinkModel();\n\t\t\t\t\t\t\tif (link) {\n\t\t\t\t\t\t\t\tlink.setSourcePort(sourcePort);\n\t\t\t\t\t\t\t\tlink.removeMiddlePoints();\n\t\t\t\t\t\t\t\tif (link.getSourcePort() !== sourcePort) {\n\t\t\t\t\t\t\t\t\tlink.setSourcePort(sourcePort);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tlink.setTargetPort(null);\n\n\t\t\t\t\t\t\t\tlink.getFirstPoint().updateLocation(relative);\n\t\t\t\t\t\t\t\tlink.getLastPoint().updateLocation(relative);\n\n\t\t\t\t\t\t\t\tdiagramModel.clearSelection();\n\t\t\t\t\t\t\t\tlink.getLastPoint().setSelected(true);\n\t\t\t\t\t\t\t\tdiagramModel.addLink(link);\n\n\t\t\t\t\t\t\t\tthis.startFiringAction(\n\t\t\t\t\t\t\t\t\tnew MoveItemsAction(\n\t\t\t\t\t\t\t\t\t\tevent.clientX,\n\t\t\t\t\t\t\t\t\t\tevent.clientY,\n\t\t\t\t\t\t\t\t\t\tdiagramEngine\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tdiagramModel.clearSelection();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t//its some or other element, probably want to move it\n\t\t\t\t\t\tif (!event.shiftKey && !model.model.isSelected()) {\n\t\t\t\t\t\t\tdiagramModel.clearSelection();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmodel.model.setSelected(true);\n\n\t\t\t\t\t\tthis.startFiringAction(\n\t\t\t\t\t\t\tnew MoveItemsAction(\n\t\t\t\t\t\t\t\tevent.clientX,\n\t\t\t\t\t\t\t\tevent.clientY,\n\t\t\t\t\t\t\t\tdiagramEngine\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tthis.state.document.addEventListener(\n\t\t\t\t\t\t\"mousemove\",\n\t\t\t\t\t\tthis.onMouseMove\n\t\t\t\t\t);\n\t\t\t\t\tthis.state.document.addEventListener(\n\t\t\t\t\t\t\"mouseup\",\n\t\t\t\t\t\tthis.onMouseUp\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{this.state.renderedNodes && (\n\t\t\t\t\t<LinkLayerWidget\n\t\t\t\t\t\tdiagramEngine={diagramEngine}\n\t\t\t\t\t\tpointAdded={(point: PointModel, event) => {\n\t\t\t\t\t\t\tthis.state.document.addEventListener(\n\t\t\t\t\t\t\t\t\"mousemove\",\n\t\t\t\t\t\t\t\tthis.onMouseMove\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis.state.document.addEventListener(\n\t\t\t\t\t\t\t\t\"mouseup\",\n\t\t\t\t\t\t\t\tthis.onMouseUp\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\tdiagramModel.clearSelection(point);\n\t\t\t\t\t\t\tthis.setState({\n\t\t\t\t\t\t\t\taction: new MoveItemsAction(\n\t\t\t\t\t\t\t\t\tevent.clientX,\n\t\t\t\t\t\t\t\t\tevent.clientY,\n\t\t\t\t\t\t\t\t\tdiagramEngine\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t<NodeLayerWidget diagramEngine={diagramEngine} />\n\t\t\t\t{this.state.action instanceof SelectingAction &&\n\t\t\t\t\tthis.drawSelectionBox()}\n\t\t\t</div>\n\t\t);\n\t}\n}\n"],"sourceRoot":""}